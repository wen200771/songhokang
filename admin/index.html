<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>送齁康管理後台 - 系統管理</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8f7f6 0%, #e8e6e3 100%);
            min-height: 100vh;
            color: #1f2937;
            line-height: 1.6;
        }

        /* 頭部導航 */
        .header {
            background: rgba(248, 247, 246, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(252, 163, 17, 0.2);
            padding: 0 24px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(252, 163, 17, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 700;
            color: #1f2937;
        }

        .logo span {
            font-size: 24px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .switch-info {
            background: rgba(252, 163, 17, 0.1);
            border: 1px solid rgba(252, 163, 17, 0.3);
            border-radius: 12px;
            padding: 8px 16px;
            font-size: 14px;
            color: #92400e;
            display: none;
        }

        /* 主要布局 */
        .layout {
            display: flex;
            min-height: calc(100vh - 64px);
        }

        /* 側邊欄 */
        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(252, 163, 17, 0.2);
            padding: 24px 0;
            overflow-y: auto;
        }

        .nav-menu {
            list-style: none;
            padding: 0 16px;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 12px;
            text-decoration: none;
            color: #6b7280;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 16px;
        }

        .nav-link:hover {
            background: rgba(252, 163, 17, 0.1);
            color: #FCA311;
        }

        .nav-link.active {
            background: linear-gradient(135deg, #FCA311 0%, #f59e0b 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(252, 163, 17, 0.3);
        }

        .nav-icon {
            font-size: 18px;
            width: 20px;
            text-align: center;
        }

        /* 主內容區域 */
        .main-content {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
        }

        .content {
            max-width: 1400px;
            margin: 0 auto;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* 卡片樣式 */
        .card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(252, 163, 17, 0.2);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            padding: 24px 32px;
            border-bottom: 1px solid rgba(252, 163, 17, 0.1);
            background: linear-gradient(135deg, rgba(252, 163, 17, 0.05) 0%, rgba(248, 247, 246, 0.8) 100%);
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-body {
            padding: 32px;
        }

        /* 統計卡片網格 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: linear-gradient(135deg, #fff 0%, #f8fafc 100%);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(252, 163, 17, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(252, 163, 17, 0.2);
        }

        .stat-icon {
            font-size: 32px;
            margin-bottom: 12px;
            display: block;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            color: #6b7280;
            font-weight: 500;
        }

        .stat-change {
            font-size: 12px;
            margin-top: 8px;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 500;
        }

        .stat-change.positive {
            background: #d1fae5;
            color: #065f46;
        }

        .stat-change.negative {
            background: #fee2e2;
            color: #991b1b;
        }

        /* 按鈕樣式 */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 12px;
            font-weight: 500;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn.primary {
            background: linear-gradient(135deg, #FCA311 0%, #f59e0b 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(252, 163, 17, 0.3);
        }

        .btn.primary:hover:not(:disabled) {
            box-shadow: 0 6px 20px rgba(252, 163, 17, 0.4);
        }

        .btn.secondary {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(252, 163, 17, 0.3);
            color: #FCA311;
        }

        .btn.secondary:hover {
            background: rgba(252, 163, 17, 0.1);
        }

        .btn.danger {
            background: #ef4444;
            color: white;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .btn.danger:hover:not(:disabled) {
            background: #dc2626;
        }

        /* 表格樣式 */
        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid rgba(252, 163, 17, 0.2);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .table th {
            background: linear-gradient(135deg, rgba(252, 163, 17, 0.1) 0%, rgba(248, 247, 246, 0.8) 100%);
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 1px solid rgba(252, 163, 17, 0.2);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .table td {
            padding: 16px;
            border-bottom: 1px solid rgba(252, 163, 17, 0.1);
            vertical-align: middle;
        }

        .table tbody tr:hover {
            background: rgba(252, 163, 17, 0.05);
        }

        /* 狀態徽章 */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge.status-pending {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #f59e0b;
        }

        .badge.status-approved {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }

        .badge.status-active {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #3b82f6;
        }

        .badge.status-rejected {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }

        .badge.status-expired {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #9ca3af;
        }

        .badge.status-inactive {
            background: #fecaca;
            color: #dc2626;
            border: 1px solid #f87171;
        }

        .badge.status-suspended {
            background: #fde68a;
            color: #d97706;
            border: 1px solid #f59e0b;
        }

        .badge.role-admin {
            background: #e0e7ff;
            color: #3730a3;
            border: 1px solid #6366f1;
        }

        .badge.role-vendor {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #f59e0b;
        }

        .badge.role-customer {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }

        /* 搜索和篩選 */
        .search-filter-bar {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 48px;
            border: 1px solid rgba(252, 163, 17, 0.3);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #FCA311;
            box-shadow: 0 0 0 3px rgba(252, 163, 17, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            font-size: 16px;
        }

        .filter-select {
            padding: 12px 16px;
            border: 1px solid rgba(252, 163, 17, 0.3);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            font-size: 14px;
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: #FCA311;
            box-shadow: 0 0 0 3px rgba(252, 163, 17, 0.1);
        }

        /* 載入動畫 */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-radius: 50%;
            border-top-color: #FCA311;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* 空狀態 */
        .empty-state {
            text-align: center;
            padding: 64px 32px;
            color: #6b7280;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #374151;
        }

        /* 圖表容器樣式 */
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
            background: rgba(248, 250, 252, 0.5);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chart-container canvas {
            max-width: 100%;
            max-height: 100%;
        }

        /* 表單樣式 */
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            padding: 12px 16px;
            border: 1px solid rgba(252, 163, 17, 0.3);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #FCA311;
            box-shadow: 0 0 0 3px rgba(252, 163, 17, 0.1);
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        /* 響應式設計 */
        @media (max-width: 1024px) {
            .sidebar {
                width: 260px;
            }

            .main-content {
                padding: 24px;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 16px;
            }
        }

        @media (max-width: 768px) {
            .layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                padding: 16px 0;
            }

            .nav-menu {
                display: flex;
                overflow-x: auto;
                padding: 0 16px;
                gap: 8px;
            }

            .nav-item {
                margin-bottom: 0;
                flex-shrink: 0;
            }

            .main-content {
                padding: 16px;
            }

            .search-filter-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                min-width: auto;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* 新增功能模塊樣式 */

        /* 區段標題樣式 */
        .section-header {
            margin-bottom: 32px;
            text-align: center;
        }

        .section-header h2 {
            font-size: 28px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .section-header p {
            color: #6b7280;
            font-size: 16px;
        }

        /* 輪播圖管理樣式 */
        .banner-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
        }

        .banner-placeholder {
            border: 2px dashed rgba(252, 163, 17, 0.3);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: rgba(252, 163, 17, 0.05);
        }

        .banner-placeholder-content span {
            font-size: 48px;
            display: block;
            margin-bottom: 16px;
        }

        .banner-placeholder-content p {
            color: #6b7280;
            margin-bottom: 16px;
        }

        /* FAQ 管理樣式 */
        .faq-list {
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .faq-placeholder {
            text-align: center;
            color: #6b7280;
        }

        .faq-placeholder span {
            font-size: 48px;
            display: block;
            margin-bottom: 16px;
        }

        /* 幫助文檔樣式 */
        .help-docs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        .help-doc-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid rgba(252, 163, 17, 0.2);
            text-align: center;
            transition: all 0.3s ease;
        }

        .help-doc-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(252, 163, 17, 0.2);
        }

        .help-doc-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .help-doc-card h4 {
            margin-bottom: 8px;
            color: #1f2937;
        }

        .help-doc-card p {
            color: #6b7280;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .help-doc-actions {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        /* 安全管理樣式 */
        .security-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .security-stat-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(252, 163, 17, 0.2);
        }

        .security-stat-number {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .security-stat-label {
            font-size: 12px;
            color: #6b7280;
            font-weight: 500;
        }

        /* IP 白名單樣式 */
        .ip-whitelist-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .ip-rule {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            border: 1px solid rgba(252, 163, 17, 0.2);
        }

        .ip-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .ip-address {
            font-weight: 600;
            color: #1f2937;
        }

        .ip-label {
            font-size: 12px;
            color: #6b7280;
        }

        .ip-actions {
            display: flex;
            gap: 8px;
        }

        /* 兩步驟驗證樣式 */
        .two-factor-settings {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            border: 1px solid rgba(252, 163, 17, 0.2);
        }

        .setting-info h4 {
            margin-bottom: 4px;
            color: #1f2937;
        }

        .setting-info p {
            font-size: 14px;
            color: #6b7280;
        }

        /* 開關樣式 */
        .switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: #FCA311;
        }

        input:checked+.slider:before {
            transform: translateX(24px);
        }

        /* 通知管理樣式 */
        .notification-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .notification-stat-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(252, 163, 17, 0.2);
        }

        .notification-stat-number {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .notification-stat-label {
            font-size: 12px;
            color: #6b7280;
            font-weight: 500;
        }

        .recent-notifications {
            margin-top: 24px;
        }

        .recent-notifications h4 {
            margin-bottom: 16px;
            color: #1f2937;
        }

        .notification-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            border: 1px solid rgba(252, 163, 17, 0.2);
            margin-bottom: 8px;
        }

        .notification-icon {
            font-size: 20px;
            margin-right: 12px;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 2px;
        }

        .notification-time {
            font-size: 12px;
            color: #6b7280;
        }

        .notification-status {
            font-size: 12px;
            padding: 4px 8px;
            background: #d1fae5;
            color: #065f46;
            border-radius: 6px;
        }

        /* 郵件模板樣式 */
        .email-templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        .email-template-card {
            display: flex;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(252, 163, 17, 0.2);
            transition: all 0.3s ease;
        }

        .email-template-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(252, 163, 17, 0.2);
        }

        .email-template-preview {
            margin-right: 16px;
            display: flex;
            align-items: center;
        }

        .email-template-icon {
            font-size: 32px;
        }

        .email-template-info {
            flex: 1;
        }

        .email-template-info h4 {
            margin-bottom: 4px;
            color: #1f2937;
        }

        .email-template-info p {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 12px;
        }

        .email-template-actions {
            display: flex;
            gap: 8px;
        }

        /* 通知設定樣式 */
        .notification-settings {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .setting-group {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(252, 163, 17, 0.2);
        }

        .setting-group h4 {
            margin-bottom: 16px;
            color: #1f2937;
            font-size: 16px;
        }

        .setting-group .setting-item {
            margin-bottom: 12px;
        }

        .setting-group .setting-item:last-child {
            margin-bottom: 0;
        }

        .setting-info span {
            font-weight: 500;
            color: #1f2937;
        }

        .setting-info small {
            display: block;
            color: #6b7280;
            font-size: 12px;
            margin-top: 2px;
        }

        /* 外觀設定樣式 */
        .theme-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .theme-option {
            cursor: pointer;
            border-radius: 12px;
            padding: 16px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            text-align: center;
        }

        .theme-option:hover {
            border-color: rgba(252, 163, 17, 0.3);
        }

        .theme-option.active {
            border-color: #FCA311;
            background: rgba(252, 163, 17, 0.05);
        }

        .theme-preview {
            width: 100%;
            height: 120px;
            border-radius: 8px;
            margin-bottom: 12px;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .light-theme {
            background: #ffffff;
        }

        .dark-theme {
            background: #1f2937;
        }

        .auto-theme {
            background: linear-gradient(45deg, #ffffff 50%, #1f2937 50%);
        }

        .theme-header {
            height: 20px;
            background: #FCA311;
        }

        .theme-content {
            display: flex;
            height: 100px;
        }

        .theme-sidebar {
            width: 30%;
            background: rgba(0, 0, 0, 0.05);
        }

        .theme-main {
            flex: 1;
            background: rgba(0, 0, 0, 0.02);
        }

        .theme-name {
            font-weight: 500;
            color: #1f2937;
        }

        /* Logo 管理樣式 */
        .logo-management {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            align-items: start;
        }

        .logo-upload-section {
            text-align: center;
        }

        .logo-preview {
            width: 120px;
            height: 120px;
            border-radius: 12px;
            border: 2px dashed rgba(252, 163, 17, 0.3);
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(252, 163, 17, 0.05);
        }

        .logo-preview img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 8px;
        }

        .logo-controls {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .logo-settings {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .logo-settings .setting-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .logo-settings label {
            font-weight: 500;
            color: #1f2937;
        }

        .logo-settings select {
            padding: 8px 12px;
            border: 1px solid rgba(252, 163, 17, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.8);
        }

        /* 色彩方案樣式 */
        .color-scheme-settings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .color-setting {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .color-setting label {
            font-weight: 500;
            color: #1f2937;
        }

        .color-input-group {
            display: flex;
            gap: 8px;
        }

        .color-input-group input[type="color"] {
            width: 50px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .color-input-group input[type="text"] {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid rgba(252, 163, 17, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.8);
            font-family: monospace;
        }

        .color-preview {
            margin: 24px 0;
        }

        .color-preview h4 {
            margin-bottom: 16px;
            color: #1f2937;
        }

        .color-preview-card {
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .preview-header {
            padding: 16px;
            font-weight: 600;
        }

        .preview-content {
            padding: 16px;
        }

        .preview-content button {
            margin-top: 8px;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .color-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        /* 卡片動作區域 */
        .card-actions {
            display: flex;
            gap: 8px;
        }

        /* 優惠券表格專用樣式 */
        .coupon-table {
            table-layout: fixed;
            min-width: 1080px;
        }

        .coupon-table td {
            vertical-align: top;
            padding: 18px 16px;
            word-wrap: break-word;
        }

        .coupon-table th {
            padding: 18px 16px;
            font-size: 14px;
            font-weight: 600;
        }

        /* 廠商表格專用樣式 */
        .vendor-table {
            table-layout: fixed;
            min-width: 1080px;
        }

        .vendor-table td {
            vertical-align: top;
            padding: 12px 8px;
            word-wrap: break-word;
            font-size: 13px;
        }

        .vendor-table th {
            padding: 12px 8px;
            font-size: 13px;
            font-weight: 600;
        }

        /* 通用表格樣式改進 */
        .table-container table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            table-layout: fixed;
            min-width: 1140px;
        }

        .table-container th {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 16px 14px;
            text-align: left;
            font-weight: 700;
            font-size: 14px;
            color: #1f2937;
            border-bottom: 2px solid #e5e7eb;
            white-space: nowrap;
        }

        .table-container td {
            padding: 16px 14px;
            border-bottom: 1px solid #f3f4f6;
            font-size: 14px;
            vertical-align: top;
            line-height: 1.6;
        }

        .table-container tr:hover {
            background: #f9fafb;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transition: all 0.2s ease;
        }

        .table-container tr:last-child td {
            border-bottom: none;
        }

        /* 響應式設計 */
        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .logo-management {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            .color-scheme-settings {
                grid-template-columns: 1fr;
            }

            .theme-options {
                grid-template-columns: 1fr;
            }

            .coupon-table,
            .vendor-table {
                min-width: auto;
                table-layout: auto;
            }

            .coupon-table td,
            .coupon-table th,
            .vendor-table td,
            .vendor-table th {
                padding: 12px 8px;
                font-size: 12px;
            }

            /* 內容管理樣式 */
            .banner-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 20px;
                margin-top: 16px;
            }

            .banner-item {
                border: 1px solid #e5e7eb;
                border-radius: 8px;
                overflow: hidden;
                position: relative;
            }

            .banner-item img {
                width: 100%;
                height: 200px;
                object-fit: cover;
            }

            .banner-item-info {
                padding: 12px;
                background: white;
            }

            .banner-item-actions {
                display: flex;
                gap: 8px;
                margin-top: 8px;
            }

            .banner-placeholder {
                border: 2px dashed #d1d5db;
                border-radius: 8px;
                padding: 40px;
                text-align: center;
                color: #6b7280;
            }

            .banner-placeholder-content span {
                font-size: 48px;
                display: block;
                margin-bottom: 16px;
            }

            .faq-list {
                display: flex;
                flex-direction: column;
                gap: 16px;
            }

            .faq-item {
                border: 1px solid #e5e7eb;
                border-radius: 8px;
                overflow: hidden;
            }

            .faq-question {
                padding: 16px;
                background: #f9fafb;
                font-weight: 500;
                cursor: pointer;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .faq-question:hover {
                background: #f3f4f6;
            }

            .faq-answer {
                padding: 16px;
                border-top: 1px solid #e5e7eb;
                background: white;
            }

            .faq-placeholder {
                text-align: center;
                padding: 40px;
                color: #6b7280;
            }

            .faq-placeholder span {
                font-size: 48px;
                display: block;
                margin-bottom: 16px;
            }

            .modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 1000;
            }

            .modal.active {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .modal-content {
                background: white;
                border-radius: 12px;
                padding: 24px;
                width: 90%;
                max-width: 600px;
                max-height: 80vh;
                overflow-y: auto;
            }

            .modal-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
                padding-bottom: 16px;
                border-bottom: 1px solid #e5e7eb;
            }

            .modal-title {
                font-size: 18px;
                font-weight: 600;
                color: #111827;
            }

            .modal-close {
                background: none;
                border: none;
                font-size: 24px;
                cursor: pointer;
                color: #6b7280;
                padding: 0;
                width: 32px;
                height: 32px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 50%;
            }

            .modal-close:hover {
                background: #f3f4f6;
            }

            .form-group {
                margin-bottom: 16px;
            }

            .form-label {
                display: block;
                margin-bottom: 6px;
                font-weight: 500;
                color: #374151;
            }

            .form-input,
            .form-select,
            .form-textarea {
                width: 100%;
                padding: 8px 12px;
                border: 1px solid #d1d5db;
                border-radius: 6px;
                font-size: 14px;
                transition: border-color 0.2s;
            }

            .form-input:focus,
            .form-select:focus,
            .form-textarea:focus {
                outline: none;
                border-color: #FCA311;
                box-shadow: 0 0 0 3px rgba(252, 163, 17, 0.1);
            }

            .form-textarea {
                min-height: 100px;
                resize: vertical;
            }

            .modal-footer {
                display: flex;
                justify-content: flex-end;
                gap: 12px;
                margin-top: 24px;
                padding-top: 16px;
                border-top: 1px solid #e5e7eb;
            }

            /* 安全管理樣式 */
            .risk-high {
                background-color: rgba(251, 191, 36, 0.1);
            }

            .risk-critical {
                background-color: rgba(239, 68, 68, 0.1);
            }

            .security-stat-card {
                text-align: center;
                padding: 20px;
                background: white;
                border-radius: 8px;
                border: 1px solid #e5e7eb;
            }

            .security-stat-number {
                font-size: 32px;
                font-weight: 700;
                color: #111827;
                margin-bottom: 8px;
            }

            .security-stat-label {
                font-size: 14px;
                color: #6b7280;
            }

            .ip-whitelist-item:hover {
                background-color: #f9fafb;
            }
    </style>
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon"
        href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiByeD0iMTAiIGZpbGw9IiNGQ0EzMTEiLz4KPHRleHQgeD0iNTAiIHk9IjU1IiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMzAiIGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+U0g8L3RleHQ+Cjwvc3ZnPg==">
</head>

<body>
    <!-- 頭部導航 -->
    <div class="header">
        <div class="logo">
            <span>🎯</span>
            <span>送齁康管理後台</span>
        </div>
        <div class="header-actions">
            <div class="switch-info" id="switchInfo">
                <span>👤 當前查看：<strong id="currentUser">-</strong></span>
                <span>👨‍💼 管理員：<strong id="adminUser">-</strong></span>
            </div>
            <button class="btn secondary" id="switchBackBtn" style="display: none;" onclick="switchBackToAdmin()">
                ↩️ 切換回管理員
            </button>
            <button class="btn danger" onclick="logout()">
                🚪 登出
            </button>
        </div>
    </div>

    <!-- 主要布局 -->
    <div class="layout">
        <!-- 側邊欄 -->
        <div class="sidebar">
            <ul class="nav-menu">
                <li class="nav-item">
                    <a class="nav-link active" data-section="dashboard">
                        <span class="nav-icon">📊</span>
                        <span>儀表板</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="users">
                        <span class="nav-icon">👥</span>
                        <span>用戶管理</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="coupons">
                        <span class="nav-icon">🎫</span>
                        <span>優惠券管理</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="vendors">
                        <span class="nav-icon">🏪</span>
                        <span>廠商管理</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="analytics">
                        <span class="nav-icon">📈</span>
                        <span>數據分析</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="content">
                        <span class="nav-icon">📝</span>
                        <span>內容管理</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="security">
                        <span class="nav-icon">🛡️</span>
                        <span>安全管理</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="notifications">
                        <span class="nav-icon">🔔</span>
                        <span>通知管理</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="appearance">
                        <span class="nav-icon">🎨</span>
                        <span>外觀設定</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="system">
                        <span class="nav-icon">⚙️</span>
                        <span>系統設定</span>
                    </a>
                </li>

            </ul>
        </div>

        <!-- 主內容區域 -->
        <div class="main-content">
            <div class="content">
                <!-- 儀表板 -->
                <div class="section active" id="dashboard-section">
                    <!-- KPI 統計 -->
                    <div class="stats-grid" id="statsGrid">
                        <!-- 統計卡片將通過 JavaScript 動態生成 -->
                    </div>

                    <!-- 最新活動 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span>🔥</span>
                                <span>最新活動</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="recentActivities">
                                <div class="loading" style="margin: 20px auto;"></div>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- 用戶管理 -->
                <div class="section" id="users-section">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span>👥</span>
                                <span>用戶管理</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- 搜索和篩選 -->
                            <div class="search-filter-bar">
                                <div class="search-box">
                                    <span class="search-icon">🔍</span>
                                    <input type="text" class="search-input" id="userSearch" placeholder="搜索用戶名稱、郵箱...">
                                </div>
                                <select class="filter-select" id="roleFilter">
                                    <option value="">所有角色</option>
                                    <option value="customer">一般會員</option>
                                    <option value="vendor">廠商</option>
                                    <option value="admin">管理員</option>
                                </select>
                                <select class="filter-select" id="statusFilter">
                                    <option value="">所有狀態</option>
                                    <option value="active">已啟用</option>
                                    <option value="pending">待審核</option>
                                    <option value="inactive">已停用</option>
                                </select>
                            </div>

                            <!-- 用戶表格 -->
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th style="width:260px">用戶資訊</th>
                                            <th style="width:100px">角色</th>
                                            <th style="width:100px">狀態</th>
                                            <th style="width:120px">註冊時間</th>
                                            <th style="width:140px">最後登入</th>
                                            <th style="width:320px">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="usersTable">
                                        <tr>
                                            <td colspan="6" style="text-align: center; padding: 40px;">
                                                <div class="loading"></div>
                                                <div style="margin-top: 12px;">載入中...</div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 優惠券管理 -->
                <div class="section" id="coupons-section">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span>🎫</span>
                                <span>優惠券管理</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- 搜索和篩選 -->
                            <div class="search-filter-bar">
                                <div class="search-box">
                                    <span class="search-icon">🔍</span>
                                    <input type="text" class="search-input" id="couponSearch"
                                        placeholder="搜索優惠券標題、廠商...">
                                </div>
                                <select class="filter-select" id="categoryFilter">
                                    <option value="">所有分類</option>
                                    <option value="美食餐飲">美食餐飲</option>
                                    <option value="購物商城">購物商城</option>
                                    <option value="美容保養">美容保養</option>
                                    <option value="休閒娛樂">休閒娛樂</option>
                                    <option value="旅遊住宿">旅遊住宿</option>
                                    <option value="健康醫療">健康醫療</option>
                                    <option value="3C電子">3C電子</option>
                                    <option value="生活服務">生活服務</option>
                                    <option value="其他">其他</option>
                                </select>
                                <select class="filter-select" id="couponStatusFilter">
                                    <option value="">所有狀態</option>
                                    <option value="pending">待審核</option>
                                    <option value="approved">已核准</option>
                                    <option value="active">上線中</option>
                                    <option value="expired">已過期</option>
                                    <option value="rejected">已駁回</option>
                                </select>
                            </div>

                            <!-- 優惠券表格 -->
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th style="width:60px">ID</th>
                                            <th style="width:280px">標題</th>
                                            <th style="width:130px">廠商</th>
                                            <th style="width:90px">分類</th>
                                            <th style="width:90px">狀態</th>
                                            <th style="width:110px">數據</th>
                                            <th style="width:110px">到期日</th>
                                            <th style="width:200px">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="couponsTable">
                                        <tr>
                                            <td colspan="8" style="text-align: center; padding: 40px;">
                                                <div class="loading"></div>
                                                <div style="margin-top: 12px;">載入中...</div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 廠商管理 -->
                <div class="section" id="vendors-section">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span>🏪</span>
                                <span>廠商管理</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- 搜索和篩選 -->
                            <div class="search-filter-bar">
                                <div class="search-box">
                                    <span class="search-icon">🔍</span>
                                    <input type="text" class="search-input" id="vendorSearch"
                                        placeholder="搜索廠商名稱、聯絡人...">
                                </div>
                                <select class="filter-select" id="vendorStatusFilter">
                                    <option value="">所有狀態</option>
                                    <option value="pending">待審核</option>
                                    <option value="approved">已核准</option>
                                    <option value="rejected">已駁回</option>
                                </select>
                                <select class="filter-select" id="vendorCategoryFilter">
                                    <option value="">所有分類</option>
                                    <option value="美食餐飲">美食餐飲</option>
                                    <option value="購物商城">購物商城</option>
                                    <option value="美容保養">美容保養</option>
                                    <option value="休閒娛樂">休閒娛樂</option>
                                    <option value="旅遊住宿">旅遊住宿</option>
                                    <option value="健康醫療">健康醫療</option>
                                    <option value="其他">其他</option>
                                </select>
                            </div>

                            <!-- 廠商表格 -->
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th style="width:60px">ID</th>
                                            <th style="width:230px">公司名稱</th>
                                            <th style="width:110px">聯絡人</th>
                                            <th style="width:180px">聯絡資訊</th>
                                            <th style="width:90px">狀態</th>
                                            <th style="width:80px">優惠券</th>
                                            <th style="width:110px">申請時間</th>
                                            <th style="width:200px">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="vendorsTable">
                                        <tr>
                                            <td style="font-weight: 600; font-size: 15px; color: #1f2937;">1</td>
                                            <td>
                                                <div
                                                    style="font-weight: 600; margin-bottom: 4px; font-size: 15px; color: #1f2937;">
                                                    美味餐廳股份有限公司</div>
                                                <div style="font-size: 13px; color: #6b7280;">統編: 12345678</div>
                                            </td>
                                            <td style="font-size: 14px; font-weight: 500; color: #374151;">張經理</td>
                                            <td style="font-size: 13px; color: #6b7280; line-height: 1.6;">
                                                <div style="margin-bottom: 3px;">📧 manager@delicious.com.tw</div>
                                                <div>📱 02-1234-5678</div>
                                            </td>
                                            <td>
                                                <span
                                                    style="padding: 6px 12px; border-radius: 16px; font-size: 12px; font-weight: 600; background: #d1fae5; color: #059669; display: inline-block;">已核准</span>
                                            </td>
                                            <td
                                                style="text-align: center; font-weight: 700; color: #f97316; font-size: 16px;">
                                                8</td>
                                            <td style="font-size: 13px; color: #6b7280; font-weight: 500;">2024/1/10
                                            </td>
                                            <td>
                                                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f8fafc; color: #374151; border: 1px solid #e5e7eb; border-radius: 6px; font-weight: 500;">👁️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f59e0b; color: white; border-radius: 6px; font-weight: 500;">✏️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #10b981; color: white; border-radius: 6px; font-weight: 500;">🔄</button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 600; font-size: 15px; color: #1f2937;">2</td>
                                            <td>
                                                <div
                                                    style="font-weight: 600; margin-bottom: 4px; font-size: 15px; color: #1f2937;">
                                                    時尚服飾有限公司</div>
                                                <div style="font-size: 13px; color: #6b7280;">統編: 87654321</div>
                                            </td>
                                            <td style="font-size: 14px; font-weight: 500; color: #374151;">李小姐</td>
                                            <td style="font-size: 13px; color: #6b7280; line-height: 1.6;">
                                                <div style="margin-bottom: 3px;">📧 service@fashion.com.tw</div>
                                                <div>📱 02-9876-5432</div>
                                            </td>
                                            <td>
                                                <span
                                                    style="padding: 6px 12px; border-radius: 16px; font-size: 12px; font-weight: 600; background: #fef3c7; color: #d97706; display: inline-block;">待審核</span>
                                            </td>
                                            <td
                                                style="text-align: center; font-weight: 700; color: #6b7280; font-size: 16px;">
                                                0</td>
                                            <td style="font-size: 13px; color: #6b7280; font-weight: 500;">2024/1/12
                                            </td>
                                            <td>
                                                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f8fafc; color: #374151; border: 1px solid #e5e7eb; border-radius: 6px; font-weight: 500;">👁️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f59e0b; color: white; border-radius: 6px; font-weight: 500;">✏️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #10b981; color: white; border-radius: 6px; font-weight: 500;">🔄</button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 600; font-size: 15px; color: #1f2937;">3</td>
                                            <td>
                                                <div
                                                    style="font-weight: 600; margin-bottom: 4px; font-size: 15px; color: #1f2937;">
                                                    健康生活館</div>
                                                <div style="font-size: 13px; color: #6b7280;">統編: 11223344</div>
                                            </td>
                                            <td style="font-size: 14px; font-weight: 500; color: #374151;">王先生</td>
                                            <td style="font-size: 13px; color: #6b7280; line-height: 1.6;">
                                                <div style="margin-bottom: 3px;">📧 info@health.com.tw</div>
                                                <div>📱 02-5555-6666</div>
                                            </td>
                                            <td>
                                                <span
                                                    style="padding: 6px 12px; border-radius: 16px; font-size: 12px; font-weight: 600; background: #d1fae5; color: #059669; display: inline-block;">已核准</span>
                                            </td>
                                            <td
                                                style="text-align: center; font-weight: 700; color: #f97316; font-size: 16px;">
                                                12</td>
                                            <td style="font-size: 13px; color: #6b7280; font-weight: 500;">2024/1/8</td>
                                            <td>
                                                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f8fafc; color: #374151; border: 1px solid #e5e7eb; border-radius: 6px; font-weight: 500;">👁️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f59e0b; color: white; border-radius: 6px; font-weight: 500;">✏️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #10b981; color: white; border-radius: 6px; font-weight: 500;">🔄</button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 600; font-size: 15px; color: #1f2937;">4</td>
                                            <td>
                                                <div
                                                    style="font-weight: 600; margin-bottom: 4px; font-size: 15px; color: #1f2937;">
                                                    快樂旅遊社</div>
                                                <div style="font-size: 13px; color: #6b7280;">統編: 99887766</div>
                                            </td>
                                            <td style="font-size: 14px; font-weight: 500; color: #374151;">陳小姐</td>
                                            <td style="font-size: 13px; color: #6b7280; line-height: 1.6;">
                                                <div style="margin-bottom: 3px;">📧 travel@happy.com.tw</div>
                                                <div>📱 07-8888-9999</div>
                                            </td>
                                            <td>
                                                <span
                                                    style="padding: 6px 12px; border-radius: 16px; font-size: 12px; font-weight: 600; background: #fecaca; color: #dc2626; display: inline-block;">已駁回</span>
                                            </td>
                                            <td
                                                style="text-align: center; font-weight: 700; color: #6b7280; font-size: 16px;">
                                                3</td>
                                            <td style="font-size: 13px; color: #6b7280; font-weight: 500;">2024/1/5</td>
                                            <td>
                                                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f8fafc; color: #374151; border: 1px solid #e5e7eb; border-radius: 6px; font-weight: 500;">👁️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f59e0b; color: white; border-radius: 6px; font-weight: 500;">✏️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #10b981; color: white; border-radius: 6px; font-weight: 500;">🔄</button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 600; font-size: 15px; color: #1f2937;">5</td>
                                            <td>
                                                <div
                                                    style="font-weight: 600; margin-bottom: 4px; font-size: 15px; color: #1f2937;">
                                                    科技數位有限公司</div>
                                                <div style="font-size: 13px; color: #6b7280;">統編: 55443322</div>
                                            </td>
                                            <td style="font-size: 14px; font-weight: 500; color: #374151;">林經理</td>
                                            <td style="font-size: 13px; color: #6b7280; line-height: 1.6;">
                                                <div style="margin-bottom: 3px;">📧 tech@digital.com.tw</div>
                                                <div>📱 03-1111-2222</div>
                                            </td>
                                            <td>
                                                <span
                                                    style="padding: 6px 12px; border-radius: 16px; font-size: 12px; font-weight: 600; background: #fef3c7; color: #d97706; display: inline-block;">待審核</span>
                                            </td>
                                            <td
                                                style="text-align: center; font-weight: 700; color: #f97316; font-size: 16px;">
                                                5</td>
                                            <td style="font-size: 13px; color: #6b7280; font-weight: 500;">2024/1/14
                                            </td>
                                            <td>
                                                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f8fafc; color: #374151; border: 1px solid #e5e7eb; border-radius: 6px; font-weight: 500;">👁️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f59e0b; color: white; border-radius: 6px; font-weight: 500;">✏️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #10b981; color: white; border-radius: 6px; font-weight: 500;">🔄</button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 600; font-size: 15px; color: #1f2937;">6</td>
                                            <td>
                                                <div
                                                    style="font-weight: 600; margin-bottom: 4px; font-size: 15px; color: #1f2937;">
                                                    咖啡香濃坊</div>
                                                <div style="font-size: 13px; color: #6b7280;">統編: 33445566</div>
                                            </td>
                                            <td style="font-size: 14px; font-weight: 500; color: #374151;">劉老闆</td>
                                            <td style="font-size: 13px; color: #6b7280; line-height: 1.6;">
                                                <div style="margin-bottom: 3px;">📧 coffee@aroma.com.tw</div>
                                                <div>📱 04-2222-3333</div>
                                            </td>
                                            <td>
                                                <span
                                                    style="padding: 6px 12px; border-radius: 16px; font-size: 12px; font-weight: 600; background: #d1fae5; color: #059669; display: inline-block;">已核准</span>
                                            </td>
                                            <td
                                                style="text-align: center; font-weight: 700; color: #f97316; font-size: 16px;">
                                                7</td>
                                            <td style="font-size: 13px; color: #6b7280; font-weight: 500;">2024/1/15
                                            </td>
                                            <td>
                                                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f8fafc; color: #374151; border: 1px solid #e5e7eb; border-radius: 6px; font-weight: 500;">👁️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f59e0b; color: white; border-radius: 6px; font-weight: 500;">✏️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #10b981; color: white; border-radius: 6px; font-weight: 500;">🔄</button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 600; font-size: 15px; color: #1f2937;">7</td>
                                            <td>
                                                <div
                                                    style="font-weight: 600; margin-bottom: 4px; font-size: 15px; color: #1f2937;">
                                                    星光健身中心</div>
                                                <div style="font-size: 13px; color: #6b7280;">統編: 77889900</div>
                                            </td>
                                            <td style="font-size: 14px; font-weight: 500; color: #374151;">周教練</td>
                                            <td style="font-size: 13px; color: #6b7280; line-height: 1.6;">
                                                <div style="margin-bottom: 3px;">📧 fitness@star.com.tw</div>
                                                <div>📱 02-7777-8888</div>
                                            </td>
                                            <td>
                                                <span
                                                    style="padding: 6px 12px; border-radius: 16px; font-size: 12px; font-weight: 600; background: #fef3c7; color: #d97706; display: inline-block;">待審核</span>
                                            </td>
                                            <td
                                                style="text-align: center; font-weight: 700; color: #f97316; font-size: 16px;">
                                                2</td>
                                            <td style="font-size: 13px; color: #6b7280; font-weight: 500;">2024/1/16
                                            </td>
                                            <td>
                                                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f8fafc; color: #374151; border: 1px solid #e5e7eb; border-radius: 6px; font-weight: 500;">👁️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f59e0b; color: white; border-radius: 6px; font-weight: 500;">✏️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #10b981; color: white; border-radius: 6px; font-weight: 500;">🔄</button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 600; font-size: 15px; color: #1f2937;">8</td>
                                            <td>
                                                <div
                                                    style="font-weight: 600; margin-bottom: 4px; font-size: 15px; color: #1f2937;">
                                                    精品花藝工作室</div>
                                                <div style="font-size: 13px; color: #6b7280;">統編: 11998877</div>
                                            </td>
                                            <td style="font-size: 14px; font-weight: 500; color: #374151;">花花小姐</td>
                                            <td style="font-size: 13px; color: #6b7280; line-height: 1.6;">
                                                <div style="margin-bottom: 3px;">📧 flowers@boutique.tw</div>
                                                <div>📱 05-3333-4444</div>
                                            </td>
                                            <td>
                                                <span
                                                    style="padding: 6px 12px; border-radius: 16px; font-size: 12px; font-weight: 600; background: #d1fae5; color: #059669; display: inline-block;">已核准</span>
                                            </td>
                                            <td
                                                style="text-align: center; font-weight: 700; color: #f97316; font-size: 16px;">
                                                9</td>
                                            <td style="font-size: 13px; color: #6b7280; font-weight: 500;">2024/1/17
                                            </td>
                                            <td>
                                                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f8fafc; color: #374151; border: 1px solid #e5e7eb; border-radius: 6px; font-weight: 500;">👁️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f59e0b; color: white; border-radius: 6px; font-weight: 500;">✏️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #10b981; color: white; border-radius: 6px; font-weight: 500;">🔄</button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 600; font-size: 15px; color: #1f2937;">9</td>
                                            <td>
                                                <div
                                                    style="font-weight: 600; margin-bottom: 4px; font-size: 15px; color: #1f2937;">
                                                    夢想書店</div>
                                                <div style="font-size: 13px; color: #6b7280;">統編: 44556677</div>
                                            </td>
                                            <td style="font-size: 14px; font-weight: 500; color: #374151;">書香姐</td>
                                            <td style="font-size: 13px; color: #6b7280; line-height: 1.6;">
                                                <div style="margin-bottom: 3px;">📧 books@dream.com.tw</div>
                                                <div>📱 06-5555-6666</div>
                                            </td>
                                            <td>
                                                <span
                                                    style="padding: 6px 12px; border-radius: 16px; font-size: 12px; font-weight: 600; background: #fef3c7; color: #d97706; display: inline-block;">待審核</span>
                                            </td>
                                            <td
                                                style="text-align: center; font-weight: 700; color: #f97316; font-size: 16px;">
                                                4</td>
                                            <td style="font-size: 13px; color: #6b7280; font-weight: 500;">2024/1/18
                                            </td>
                                            <td>
                                                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f8fafc; color: #374151; border: 1px solid #e5e7eb; border-radius: 6px; font-weight: 500;">👁️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f59e0b; color: white; border-radius: 6px; font-weight: 500;">✏️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #10b981; color: white; border-radius: 6px; font-weight: 500;">🔄</button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 600; font-size: 15px; color: #1f2937;">10</td>
                                            <td>
                                                <div
                                                    style="font-weight: 600; margin-bottom: 4px; font-size: 15px; color: #1f2937;">
                                                    極速汽車維修</div>
                                                <div style="font-size: 13px; color: #6b7280;">統編: 88776655</div>
                                            </td>
                                            <td style="font-size: 14px; font-weight: 500; color: #374151;">阿修師傅</td>
                                            <td style="font-size: 13px; color: #6b7280; line-height: 1.6;">
                                                <div style="margin-bottom: 3px;">📧 repair@speed.com.tw</div>
                                                <div>📱 03-9999-0000</div>
                                            </td>
                                            <td>
                                                <span
                                                    style="padding: 6px 12px; border-radius: 16px; font-size: 12px; font-weight: 600; background: #d1fae5; color: #059669; display: inline-block;">已核准</span>
                                            </td>
                                            <td
                                                style="text-align: center; font-weight: 700; color: #f97316; font-size: 16px;">
                                                6</td>
                                            <td style="font-size: 13px; color: #6b7280; font-weight: 500;">2024/1/19
                                            </td>
                                            <td>
                                                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f8fafc; color: #374151; border: 1px solid #e5e7eb; border-radius: 6px; font-weight: 500;">👁️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #f59e0b; color: white; border-radius: 6px; font-weight: 500;">✏️</button>
                                                    <button class="btn"
                                                        style="padding: 7px 12px; font-size: 12px; background: #10b981; color: white; border-radius: 6px; font-weight: 500;">🔄</button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 數據分析 -->
                <div class="section" id="analytics-section">
                    <!-- 數據總覽 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span>📊</span>
                                <span>數據總覽</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="stats-grid" id="analyticsStats">
                                <!-- 統計數據將通過 JavaScript 動態生成 -->
                            </div>
                        </div>
                    </div>

                    <!-- 趨勢圖表 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span>📈</span>
                                <span>用戶註冊趨勢 (最近30天)</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="userTrendChart" width="800" height="300"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- 優惠券分析 -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <span>🎫</span>
                                    <span>優惠券狀態分布</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="couponStatusChart" width="400" height="300"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <span>📂</span>
                                    <span>熱門分類排行</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="categoryChart" width="400" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 詳細數據表 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span>📋</span>
                                <span>熱門優惠券排行</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>排名</th>
                                            <th>優惠券</th>
                                            <th>廠商</th>
                                            <th>瀏覽數</th>
                                            <th>收藏數</th>
                                            <th>使用數</th>
                                            <th>轉換率</th>
                                        </tr>
                                    </thead>
                                    <tbody id="popularCouponsTable">
                                        <tr>
                                            <td colspan="7" style="text-align: center; padding: 40px;">
                                                <div class="loading"></div>
                                                <div style="margin-top: 12px;">載入中...</div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 內容管理 -->
                <div class="section" id="content-section">

                    <!-- 網站公告管理 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span>📢</span>
                                <span>網站公告</span>
                            </div>
                            <button class="btn primary" onclick="addAnnouncement()">
                                ➕ 新增公告
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>標題</th>
                                            <th>類型</th>
                                            <th>狀態</th>
                                            <th>開始時間</th>
                                            <th>結束時間</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="announcementList">
                                        <tr>
                                            <td colspan="6" style="text-align: center; color: #6b7280; padding: 40px;">
                                                暫無公告資料
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 輪播圖管理 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span>🖼️</span>
                                <span>輪播圖管理</span>
                            </div>
                            <button class="btn primary" onclick="addBanner()">
                                ➕ 新增輪播圖
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="bannerGrid" class="banner-grid">
                                <div class="banner-placeholder">
                                    <div class="banner-placeholder-content">
                                        <span>📷</span>
                                        <p>暫無輪播圖</p>
                                        <button class="btn primary" onclick="addBanner()">上傳圖片</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- FAQ 管理 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span>❓</span>
                                <span>常見問題</span>
                            </div>
                            <button class="btn primary" onclick="addFAQ()">
                                ➕ 新增問題
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="faqList" class="faq-list">
                                <div class="faq-placeholder">
                                    <span>❓</span>
                                    <p>暫無常見問題</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 幫助文檔 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span>📚</span>
                                <span>幫助文檔</span>
                            </div>
                            <button class="btn primary" onclick="addHelpDoc()">
                                ➕ 新增文檔
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="help-docs-grid">
                                <div class="help-doc-card">
                                    <div class="help-doc-icon">📖</div>
                                    <h4>用戶指南</h4>
                                    <p>如何使用平台的基本功能</p>
                                    <div class="help-doc-actions">
                                        <button class="btn secondary" onclick="editHelpDoc('user-guide')">編輯</button>
                                        <button class="btn secondary" onclick="previewHelpDoc('user-guide')">預覽</button>
                                    </div>
                                </div>
                                <div class="help-doc-card">
                                    <div class="help-doc-icon">🏪</div>
                                    <h4>廠商手冊</h4>
                                    <p>廠商如何發布和管理優惠券</p>
                                    <div class="help-doc-actions">
                                        <button class="btn secondary" onclick="editHelpDoc('vendor-guide')">編輯</button>
                                        <button class="btn secondary"
                                            onclick="previewHelpDoc('vendor-guide')">預覽</button>
                                    </div>
                                </div>
                                <div class="help-doc-card">
                                    <div class="help-doc-icon">❓</div>
                                    <h4>常見問題解答</h4>
                                    <p>用戶最常遇到的問題及解決方案</p>
                                    <div class="help-doc-actions">
                                        <button class="btn secondary" onclick="editHelpDoc('faq-guide')">編輯</button>
                                        <button class="btn secondary" onclick="previewHelpDoc('faq-guide')">預覽</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 安全管理 -->
                <div class="section" id="security-section">

                    <!-- 登入日誌 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span>📊</span>
                                <span>登入日誌</span>
                            </div>
                            <div class="card-actions">
                                <button class="btn secondary" onclick="exportLoginLogs()">📥 匯出日誌</button>
                                <button class="btn secondary" onclick="clearOldLogs()">🗑️ 清理舊日誌</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="security-stats">
                                <div class="security-stat-card">
                                    <div class="security-stat-number">127</div>
                                    <div class="security-stat-label">今日登入</div>
                                </div>
                                <div class="security-stat-card">
                                    <div class="security-stat-number">3</div>
                                    <div class="security-stat-label">失敗嘗試</div>
                                </div>
                                <div class="security-stat-card">
                                    <div class="security-stat-number">12</div>
                                    <div class="security-stat-label">異常IP</div>
                                </div>
                                <div class="security-stat-card">
                                    <div class="security-stat-number">95%</div>
                                    <div class="security-stat-label">安全評分</div>
                                </div>
                            </div>
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>時間</th>
                                            <th>用戶</th>
                                            <th>IP地址</th>
                                            <th>地區</th>
                                            <th>裝置</th>
                                            <th>狀態</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="loginLogsList">
                                        <tr>
                                            <td colspan="7" style="text-align: center; color: #6b7280; padding: 40px;">
                                                載入中...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- IP 白名單 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span>🌐</span>
                                <span>IP 白名單</span>
                            </div>
                            <button class="btn primary" onclick="addIPWhitelist()">
                                ➕ 新增IP
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="ip-whitelist-container">
                                <div class="ip-rule">
                                    <div class="ip-info">
                                        <span class="ip-address">192.168.1.100</span>
                                        <span class="ip-label">管理員辦公室</span>
                                    </div>
                                    <div class="ip-actions">
                                        <button class="btn secondary" onclick="editIPRule('192.168.1.100')">編輯</button>
                                        <button class="btn danger" onclick="deleteIPRule('192.168.1.100')">刪除</button>
                                    </div>
                                </div>
                                <div class="ip-rule">
                                    <div class="ip-info">
                                        <span class="ip-address">203.74.*.* </span>
                                        <span class="ip-label">公司網段</span>
                                    </div>
                                    <div class="ip-actions">
                                        <button class="btn secondary" onclick="editIPRule('203.74.*.*')">編輯</button>
                                        <button class="btn danger" onclick="deleteIPRule('203.74.*.*')">刪除</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 兩步驟驗證 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span>🔐</span>
                                <span>兩步驟驗證</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="two-factor-settings">
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>管理員帳號 2FA</h4>
                                        <p>為管理員帳號啟用兩步驟驗證</p>
                                    </div>
                                    <div class="setting-control">
                                        <label class="switch">
                                            <input type="checkbox" id="admin2FA" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>廠商帳號 2FA</h4>
                                        <p>建議廠商啟用兩步驟驗證</p>
                                    </div>
                                    <div class="setting-control">
                                        <label class="switch">
                                            <input type="checkbox" id="vendor2FA">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>強制 2FA</h4>
                                        <p>強制所有管理員使用兩步驟驗證</p>
                                    </div>
                                    <div class="setting-control">
                                        <label class="switch">
                                            <input type="checkbox" id="force2FA">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 通知管理 -->
                <div class="section" id="notifications-section">

                    <!-- 即時通知 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span>⚡</span>
                                <span>即時通知</span>
                            </div>
                            <button class="btn primary" onclick="sendBroadcast()">
                                📢 發送廣播
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="notification-stats">
                                <div class="notification-stat-card">
                                    <div class="notification-stat-number">24</div>
                                    <div class="notification-stat-label">今日通知</div>
                                </div>
                                <div class="notification-stat-card">
                                    <div class="notification-stat-number">156</div>
                                    <div class="notification-stat-label">待處理</div>
                                </div>
                                <div class="notification-stat-card">
                                    <div class="notification-stat-number">89%</div>
                                    <div class="notification-stat-label">送達率</div>
                                </div>
                            </div>
                            <div class="recent-notifications">
                                <h4>最近通知</h4>
                                <div class="notification-item">
                                    <div class="notification-icon">🎫</div>
                                    <div class="notification-content">
                                        <div class="notification-title">新優惠券待審核</div>
                                        <div class="notification-time">2 分鐘前</div>
                                    </div>
                                    <div class="notification-status">已送達</div>
                                </div>
                                <div class="notification-item">
                                    <div class="notification-icon">👤</div>
                                    <div class="notification-content">
                                        <div class="notification-title">新用戶註冊</div>
                                        <div class="notification-time">5 分鐘前</div>
                                    </div>
                                    <div class="notification-status">已送達</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 郵件模板 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span>✉️</span>
                                <span>郵件模板</span>
                            </div>
                            <button class="btn primary" onclick="createEmailTemplate()">
                                ➕ 新增模板
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="email-templates-grid">
                                <div class="email-template-card">
                                    <div class="email-template-preview">
                                        <div class="email-template-icon">👋</div>
                                    </div>
                                    <div class="email-template-info">
                                        <h4>歡迎郵件</h4>
                                        <p>新用戶註冊歡迎郵件</p>
                                        <div class="email-template-actions">
                                            <button class="btn secondary"
                                                onclick="editEmailTemplate('welcome')">編輯</button>
                                            <button class="btn secondary" onclick="previewEmail('welcome')">預覽</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="email-template-card">
                                    <div class="email-template-preview">
                                        <div class="email-template-icon">🔐</div>
                                    </div>
                                    <div class="email-template-info">
                                        <h4>密碼重置</h4>
                                        <p>密碼重置確認郵件</p>
                                        <div class="email-template-actions">
                                            <button class="btn secondary"
                                                onclick="editEmailTemplate('password-reset')">編輯</button>
                                            <button class="btn secondary"
                                                onclick="previewEmail('password-reset')">預覽</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="email-template-card">
                                    <div class="email-template-preview">
                                        <div class="email-template-icon">🎫</div>
                                    </div>
                                    <div class="email-template-info">
                                        <h4>優惠券通知</h4>
                                        <p>新優惠券發布通知</p>
                                        <div class="email-template-actions">
                                            <button class="btn secondary"
                                                onclick="editEmailTemplate('coupon-notify')">編輯</button>
                                            <button class="btn secondary"
                                                onclick="previewEmail('coupon-notify')">預覽</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 通知設定 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span>⚙️</span>
                                <span>通知設定</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="notification-settings">
                                <div class="setting-group">
                                    <h4>系統通知</h4>
                                    <div class="setting-item">
                                        <div class="setting-info">
                                            <span>新用戶註冊</span>
                                            <small>有新用戶註冊時通知</small>
                                        </div>
                                        <label class="switch">
                                            <input type="checkbox" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="setting-item">
                                        <div class="setting-info">
                                            <span>優惠券審核</span>
                                            <small>有優惠券待審核時通知</small>
                                        </div>
                                        <label class="switch">
                                            <input type="checkbox" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="setting-item">
                                        <div class="setting-info">
                                            <span>廠商申請</span>
                                            <small>有新廠商申請時通知</small>
                                        </div>
                                        <label class="switch">
                                            <input type="checkbox" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="setting-group">
                                    <h4>郵件通知</h4>
                                    <div class="setting-item">
                                        <div class="setting-info">
                                            <span>每日摘要</span>
                                            <small>每日系統運營摘要郵件</small>
                                        </div>
                                        <label class="switch">
                                            <input type="checkbox">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="setting-item">
                                        <div class="setting-info">
                                            <span>週報</span>
                                            <small>每週系統統計報告</small>
                                        </div>
                                        <label class="switch">
                                            <input type="checkbox" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 外觀設定 -->
                <div class="section" id="appearance-section">
                    <!-- 移除頁面標題（依需求不顯示頁內大標題） -->

                    <!-- 主題設定（移除卡片抬頭） -->
                    <div class="card">

                        <div class="card-body">
                            <div class="theme-options">
                                <div class="theme-option active" onclick="selectTheme('light')">
                                    <div class="theme-preview light-theme">
                                        <div class="theme-header"></div>
                                        <div class="theme-content">
                                            <div class="theme-sidebar"></div>
                                            <div class="theme-main"></div>
                                        </div>
                                    </div>
                                    <div class="theme-name">淺色主題</div>
                                </div>
                                <div class="theme-option" onclick="selectTheme('dark')">
                                    <div class="theme-preview dark-theme">
                                        <div class="theme-header"></div>
                                        <div class="theme-content">
                                            <div class="theme-sidebar"></div>
                                            <div class="theme-main"></div>
                                        </div>
                                    </div>
                                    <div class="theme-name">深色主題</div>
                                </div>
                                <div class="theme-option" onclick="selectTheme('auto')">
                                    <div class="theme-preview auto-theme">
                                        <div class="theme-header"></div>
                                        <div class="theme-content">
                                            <div class="theme-sidebar"></div>
                                            <div class="theme-main"></div>
                                        </div>
                                    </div>
                                    <div class="theme-name">自動切換</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Logo 管理（移除卡片抬頭） -->
                    <div class="card">

                        <div class="card-body">
                            <div class="logo-management">
                                <div class="logo-upload-section">
                                    <div class="logo-preview">
                                        <img id="logoPreview"
                                            src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiByeD0iMTAiIGZpbGw9IiNGQ0EzMTEiLz4KPHRleHQgeD0iNTAiIHk9IjU1IiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMzAiIGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+U0g8L3RleHQ+Cjwvc3ZnPg=="
                                            alt="網站Logo">
                                    </div>
                                    <div class="logo-controls">
                                        <input type="file" id="logoUpload" accept="image/*" style="display: none;"
                                            onchange="uploadLogo(this)">
                                        <button class="btn primary"
                                            onclick="document.getElementById('logoUpload').click()">
                                            📁 上傳Logo
                                        </button>
                                        <button class="btn primary" onclick="saveLogo()" style="margin-left: 8px;">
                                            💾 保存Logo
                                        </button>
                                        <button class="btn secondary" onclick="resetLogo()">
                                            🔄 重置為預設
                                        </button>
                                    </div>
                                </div>
                                <div class="logo-settings">
                                    <div class="setting-item">
                                        <label>Logo尺寸</label>
                                        <select id="logoSize">
                                            <option value="small">小 (32px)</option>
                                            <option value="medium" selected>中 (48px)</option>
                                            <option value="large">大 (64px)</option>
                                        </select>
                                    </div>
                                    <div class="setting-item">
                                        <label>顯示位置</label>
                                        <select id="logoPosition">
                                            <option value="left" selected>左側</option>
                                            <option value="center">中央</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 色彩方案（移除卡片抬頭） -->
                    <div class="card">

                        <div class="card-body">
                            <div class="color-scheme-settings">
                                <div class="color-setting">
                                    <label>主要色彩</label>
                                    <div class="color-input-group">
                                        <input type="color" id="primaryColor" value="#FCA311">
                                        <input type="text" value="#FCA311" readonly>
                                    </div>
                                </div>
                                <div class="color-setting">
                                    <label>次要色彩</label>
                                    <div class="color-input-group">
                                        <input type="color" id="secondaryColor" value="#14213D">
                                        <input type="text" value="#14213D" readonly>
                                    </div>
                                </div>
                                <div class="color-setting">
                                    <label>背景色彩</label>
                                    <div class="color-input-group">
                                        <input type="color" id="backgroundColor" value="#F8F7F6">
                                        <input type="text" value="#F8F7F6" readonly>
                                    </div>
                                </div>
                                <div class="color-setting">
                                    <label>文字色彩</label>
                                    <div class="color-input-group">
                                        <input type="color" id="textColor" value="#333333">
                                        <input type="text" value="#333333" readonly>
                                    </div>
                                </div>
                            </div>
                            <div class="color-preview">
                                <h4>預覽效果</h4>
                                <div class="color-preview-card">
                                    <div class="preview-header" style="background: #FCA311;">
                                        <span style="color: white;">網站標題</span>
                                    </div>
                                    <div class="preview-content" style="background: #F8F7F6;">
                                        <p style="color: #333333;">這是預覽文字內容</p>
                                        <button style="background: #14213D; color: white;">按鈕樣式</button>
                                    </div>
                                </div>
                            </div>
                            <div class="color-actions">
                                <button class="btn primary" onclick="applyColorScheme()">套用色彩方案</button>
                                <button class="btn secondary" onclick="resetColorScheme()">重置為預設</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 系統設定 -->
                <div class="section" id="system-section">
                    <!-- 基本設定 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span>🔧</span>
                                <span>基本設定</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px;">
                                <div>
                                    <h4 style="margin-bottom: 16px; color: #374151;">網站設定</h4>
                                    <div style="display: grid; gap: 16px;">
                                        <div class="form-group">
                                            <label class="form-label">網站名稱</label>
                                            <input type="text" class="form-input" id="siteName" value="送齁康優惠券平台">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">網站描述</label>
                                            <textarea class="form-input form-textarea"
                                                id="siteDescription">最好的優惠券平台，為您提供最優質的折扣資訊</textarea>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">聯絡郵箱</label>
                                            <input type="email" class="form-input" id="contactEmail"
                                                value="admin@songhokang.com">
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <h4 style="margin-bottom: 16px; color: #374151;">功能設定</h4>
                                    <div style="display: grid; gap: 16px;">
                                        <div class="form-group">
                                            <label class="form-label">用戶註冊</label>
                                            <select class="form-select" id="userRegistration">
                                                <option value="open">開放註冊</option>
                                                <option value="approval">需要審核</option>
                                                <option value="closed">關閉註冊</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">廠商申請</label>
                                            <select class="form-select" id="vendorApplication">
                                                <option value="open">開放申請</option>
                                                <option value="closed">關閉申請</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">優惠券審核</label>
                                            <select class="form-select" id="couponReview">
                                                <option value="auto">自動核准</option>
                                                <option value="manual">手動審核</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div
                                style="margin-top: 24px; padding-top: 24px; border-top: 1px solid rgba(252, 163, 17, 0.2);">
                                <button class="btn primary" onclick="saveSystemSettings()">
                                    💾 儲存設定
                                </button>
                                <button class="btn secondary" onclick="resetSystemSettings()">
                                    🔄 重置設定
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 系統資訊 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span>📊</span>
                                <span>系統資訊</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div
                                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px;">
                                <div class="stat-card">
                                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                        <span style="font-size: 24px;">🖥️</span>
                                        <span style="font-weight: 600; color: #374151;">系統版本</span>
                                    </div>
                                    <div style="font-size: 18px; font-weight: bold; color: #FCA311;">v1.0.0</div>
                                    <div style="font-size: 12px; color: #6b7280;">送齁康優惠券平台</div>
                                </div>

                                <div class="stat-card">
                                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                        <span style="font-size: 24px;">🔄</span>
                                        <span style="font-weight: 600; color: #374151;">運行狀態</span>
                                    </div>
                                    <div style="font-size: 18px; font-weight: bold; color: #10b981;">正常運行</div>
                                    <div style="font-size: 12px; color: #6b7280;" id="uptime">運行時間: 載入中...</div>
                                </div>

                                <div class="stat-card">
                                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                        <span style="font-size: 24px;">💾</span>
                                        <span style="font-weight: 600; color: #374151;">資料庫</span>
                                    </div>
                                    <div style="font-size: 18px; font-weight: bold; color: #3b82f6;">MySQL</div>
                                    <div style="font-size: 12px; color: #6b7280;">連線正常</div>
                                </div>

                                <div class="stat-card">
                                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                        <span style="font-size: 24px;">📈</span>
                                        <span style="font-weight: 600; color: #374151;">API 狀態</span>
                                    </div>
                                    <div style="font-size: 18px; font-weight: bold; color: #10b981;">正常</div>
                                    <div style="font-size: 12px; color: #6b7280;">回應時間: <50ms< /div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 操作日誌 -->
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <span>📝</span>
                                    <span>最近操作日誌</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-container">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>時間</th>
                                                <th>操作者</th>
                                                <th>操作類型</th>
                                                <th>詳細內容</th>
                                                <th>IP 地址</th>
                                            </tr>
                                        </thead>
                                        <tbody id="systemLogsTable">
                                            <tr>
                                                <td colspan="5" style="text-align: center; padding: 40px;">
                                                    <div class="loading"></div>
                                                    <div style="margin-top: 12px;">載入中...</div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- 快速操作 -->
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <span>⚡</span>
                                    <span>快速操作</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div
                                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                                    <button class="btn secondary" onclick="clearCache()">
                                        🗑️ 清除快取
                                    </button>
                                    <button class="btn secondary" onclick="exportData()">
                                        📤 匯出資料
                                    </button>
                                    <button class="btn secondary" onclick="backupDatabase()">
                                        💾 備份資料庫
                                    </button>
                                    <button class="btn secondary" onclick="checkSystemHealth()">
                                        🔍 系統檢查
                                    </button>
                                    <button class="btn danger" onclick="restartSystem()">
                                        🔄 重啟系統
                                    </button>
                                    <button class="btn secondary" onclick="viewErrorLogs()">
                                        📋 錯誤日誌
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // 全局變量 - 管理員後台使用獨立的 token key
            const LS_TOKEN = 'authToken_admin';
            let currentSection = 'dashboard';
            let currentUser = null;
            let users = [];
            let coupons = [];
            let vendors = [];

            // 認證相關
            function getAuthToken() {
                return localStorage.getItem(LS_TOKEN) || '';
            }

            function getAuthHeaders() {
                return {
                    'Authorization': `Bearer ${getAuthToken()}`,
                    'Content-Type': 'application/json'
                };
            }

            // 路徑工具：將相對圖片路徑轉成可在 /admin/ 下正確顯示
            function resolveImageUrl(url) {
                if (!url) return '';
                if (url.startsWith('http') || url.startsWith('data:')) return url;
                if (url.startsWith('/')) return url; // 例如 /uploads/...
                // 將 img/... 這類路徑轉為 ../img/...，使其從網站根目錄載入
                return '../' + url.replace(/^\.\//, '');
            }

            // 權限檢查
            async function checkAuth() {
                try {
                    const response = await fetch('../api/auth/me', {
                        headers: getAuthHeaders()
                    });

                    if (!response.ok) {
                        throw new Error('認證失敗');
                    }

                    const data = await response.json();

                    if (!data.success) {
                        throw new Error(data.message || '認證失敗');
                    }

                    currentUser = data.data;

                    // 檢查是否為管理員
                    if (currentUser.role !== 'admin') {
                        alert('此頁面僅限管理員訪問');
                        window.location.href = '../index.html';
                        return false;
                    }

                    return true;
                } catch (error) {
                    console.error('認證檢查失敗:', error);
                    alert('請先登入');
                    window.location.href = '../index.html';
                    return false;
                }
            }

            // 導航功能
            async function showSection(sectionName) {
                if (!sectionName) return; // 避免空值
                const target = document.getElementById(`${sectionName}-section`);
                if (!target) return; // 找不到對應區塊則不處理

                // 隱藏所有區段
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });

                // 顯示指定區段
                target.classList.add('active');

                // 更新導航狀態（僅針對具 data-section 的項目）
                document.querySelectorAll('.nav-link[data-section]').forEach(link => {
                    link.classList.toggle('active', link.getAttribute('data-section') === sectionName);
                });

                currentSection = sectionName;

                // 載入對應數據
                try {
                    switch (sectionName) {
                        case 'dashboard':
                            loadDashboardData();
                            break;
                        case 'users':
                            loadUsers();
                            break;
                        case 'coupons':
                            loadCoupons();
                            break;
                        case 'vendors':
                            loadVendors();
                            break;
                        case 'analytics':
                            loadAnalytics();
                            break;
                        case 'meta':
                            // 初次切換時載入基礎清單
                            if (!window.__metaLoaded) {
                                await loadMetaBaseInline();
                                window.__metaLoaded = true;
                            }
                            break;
                        case 'content':
                            loadContentManagement();
                            break;
                        case 'security':
                            loadSecurityManagement();
                            break;
                        case 'notifications':
                            loadNotifications();
                            break;
                        case 'appearance':
                            loadAppearanceSettings();
                            break;
                        case 'system':
                            loadSystemInfo();
                            loadSystemSettings();
                            break;
                    }
                } catch (error) {
                    console.error(`載入 ${sectionName} 區段時發生錯誤:`, error);
                }
            }

            // 載入儀表板數據
            async function loadDashboardData() {
                try {
                    // 載入統計數據
                    const response = await fetch('../api/stats/dashboard', {
                        headers: getAuthHeaders()
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            renderStats(data.data);
                        }
                    }

                    // 載入最新活動
                    loadRecentActivities();
                } catch (error) {
                    console.error('載入儀表板數據失敗:', error);
                }
            }

            // 渲染統計卡片
            function renderStats(stats) {
                const statsGrid = document.getElementById('statsGrid');

                const statCards = [
                    {
                        icon: '👥',
                        value: stats.total_users || 0,
                        label: '總用戶數',
                        change: stats.users_change || 0,
                        changeType: stats.users_change >= 0 ? 'positive' : 'negative'
                    },
                    {
                        icon: '🎫',
                        value: stats.total_coupons || 0,
                        label: '總優惠券數',
                        change: stats.coupons_change || 0,
                        changeType: stats.coupons_change >= 0 ? 'positive' : 'negative'
                    },
                    {
                        icon: '🏪',
                        value: stats.total_vendors || 0,
                        label: '活躍廠商',
                        change: stats.vendors_change || 0,
                        changeType: stats.vendors_change >= 0 ? 'positive' : 'negative'
                    },
                    {
                        icon: '📊',
                        value: stats.total_views || 0,
                        label: '總瀏覽數',
                        change: stats.views_change || 0,
                        changeType: stats.views_change >= 0 ? 'positive' : 'negative'
                    }
                ];

                statsGrid.innerHTML = statCards.map(card => `
                <div class="stat-card">
                    <span class="stat-icon">${card.icon}</span>
                    <div class="stat-value">${card.value.toLocaleString()}</div>
                    <div class="stat-label">${card.label}</div>
                    <div class="stat-change ${card.changeType}">
                        ${card.change >= 0 ? '+' : ''}${card.change}%
                    </div>
                </div>
            `).join('');
            }

            // 系統設定讀寫
            async function loadSystemSettings() {
                try {
                    const res = await fetch('../api/settings', { headers: getAuthHeaders() });
                    const data = await res.json();
                    if (data.success) {
                        const s = data.data || {};
                        // 映射到介面元素（若有）
                        const siteNameEl = document.getElementById('setting_site_name');
                        if (siteNameEl) siteNameEl.value = s.site_name || '';
                        const maxUploadEl = document.getElementById('setting_max_upload');
                        if (maxUploadEl) maxUploadEl.value = s.max_upload_size || 5242880;
                        const autoApproveCouponEl = document.getElementById('setting_coupon_auto');
                        if (autoApproveCouponEl) autoApproveCouponEl.checked = !!s.coupon_auto_approve;
                        const autoApproveVendorEl = document.getElementById('setting_vendor_auto');
                        if (autoApproveVendorEl) autoApproveVendorEl.checked = !!s.vendor_auto_approve;
                    }
                } catch (e) {
                    console.warn('載入系統設定失敗', e);
                }
            }

            async function saveSystemSettings() {
                try {
                    const payload = {};
                    const siteNameEl = document.getElementById('setting_site_name');
                    if (siteNameEl) payload.site_name = siteNameEl.value.trim();
                    const maxUploadEl = document.getElementById('setting_max_upload');
                    if (maxUploadEl) payload.max_upload_size = parseInt(maxUploadEl.value || '0', 10) || 0;
                    const autoApproveCouponEl = document.getElementById('setting_coupon_auto');
                    if (autoApproveCouponEl) payload.coupon_auto_approve = !!autoApproveCouponEl.checked;
                    const autoApproveVendorEl = document.getElementById('setting_vendor_auto');
                    if (autoApproveVendorEl) payload.vendor_auto_approve = !!autoApproveVendorEl.checked;

                    const res = await fetch('../api/settings', { method: 'PUT', headers: getAuthHeaders(), body: JSON.stringify(payload) });
                    const data = await res.json();
                    if (data.success) {
                        alert('系統設定已更新');
                    } else {
                        alert('更新失敗：' + (data.message || '未知錯誤'));
                    }
                } catch (e) {
                    alert('儲存失敗：' + e.message);
                }
            }

            // 載入最新活動
            async function loadRecentActivities() {
                const container = document.getElementById('recentActivities');

                try {
                    // 這裡可以調用實際的 API
                    // 暫時顯示模擬數據
                    setTimeout(() => {
                        container.innerHTML = `
                        <div style="display: flex; flex-direction: column; gap: 16px;">
                            <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(252, 163, 17, 0.05); border-radius: 8px;">
                                <span style="font-size: 20px;">🎫</span>
                                <div>
                                    <div style="font-weight: 600;">新優惠券待審核</div>
                                    <div style="font-size: 14px; color: #6b7280;">廠商 "美食天堂" 提交了新的優惠券</div>
                                </div>
                                <div style="margin-left: auto; font-size: 12px; color: #9ca3af;">2 分鐘前</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(16, 185, 129, 0.05); border-radius: 8px;">
                                <span style="font-size: 20px;">👤</span>
                                <div>
                                    <div style="font-weight: 600;">新用戶註冊</div>
                                    <div style="font-size: 14px; color: #6b7280;">用戶 "張小明" 完成註冊</div>
                                </div>
                                <div style="margin-left: auto; font-size: 12px; color: #9ca3af;">5 分鐘前</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(59, 130, 246, 0.05); border-radius: 8px;">
                                <span style="font-size: 20px;">🏪</span>
                                <div>
                                    <div style="font-weight: 600;">廠商申請</div>
                                    <div style="font-size: 14px; color: #6b7280;">新廠商 "時尚服飾店" 提交申請</div>
                                </div>
                                <div style="margin-left: auto; font-size: 12px; color: #9ca3af;">10 分鐘前</div>
                            </div>
                        </div>
                    `;
                    }, 1000);
                } catch (error) {
                    container.innerHTML = '<div style="text-align: center; color: #ef4444;">載入失敗</div>';
                }
            }

            // 載入用戶列表
            async function loadUsers() {
                try {
                    const q = (document.getElementById('userSearch')?.value || '').trim();
                    const role = document.getElementById('roleFilter')?.value || '';
                    const status = document.getElementById('statusFilter')?.value || '';
                    const params = new URLSearchParams();
                    params.set('page', '1');
                    params.set('pageSize', '1000');
                    if (q) params.set('search', q);
                    if (role) params.set('role', role);
                    if (status) params.set('status', status);
                    const response = await fetch('../api/users?' + params.toString(), {
                        headers: getAuthHeaders()
                    });

                    console.log('用戶 API 回應狀態:', response.status);

                    if (response.ok) {
                        const data = await response.json();
                        console.log('用戶 API 數據:', data);

                        if (data.success) {
                            // 嘗試多種可能的數據結構
                            users = data.data?.items || data.data?.users || data.data || [];
                            console.log('解析的用戶數據:', users);
                            renderUsers(users);
                        } else {
                            console.error('API 返回失敗:', data.message);
                            document.getElementById('usersTable').innerHTML = `
                                <tr>
                                    <td colspan="6" style="text-align: center; color: #ef4444;">API 錯誤: ${data.message || '未知錯誤'}</td>
                                </tr>
                            `;
                        }
                    } else {
                        const errorText = await response.text();
                        console.error('HTTP 錯誤:', response.status, errorText);
                        document.getElementById('usersTable').innerHTML = `
                            <tr>
                                <td colspan="6" style="text-align: center; color: #ef4444;">HTTP ${response.status}: ${errorText}</td>
                            </tr>
                        `;
                    }
                } catch (error) {
                    console.error('載入用戶失敗:', error);
                    document.getElementById('usersTable').innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; color: #ef4444;">網路錯誤: ${error.message}</td>
                        </tr>
                    `;
                }
            }

            // 渲染用戶表格
            function renderUsers(userList) {
                const tbody = document.getElementById('usersTable');

                console.log('渲染用戶列表:', userList);

                if (!userList || userList.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px;">
                                <div style="color: #6b7280;">暫無用戶資料</div>
                                <div style="color: #9ca3af; font-size: 12px; margin-top: 8px;">請檢查數據庫是否有用戶數據</div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = userList.map(user => `
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 40px; height: 40px; min-width: 40px; min-height: 40px; border-radius: 50%; background: linear-gradient(135deg, #FCA311, #f59e0b); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; flex-shrink: 0;">
                                ${user.username ? user.username.charAt(0).toUpperCase() : '?'}
                            </div>
                            <div>
                                <div style="font-weight: 600;">${user.username || '未設定'}</div>
                                <div style="font-size: 14px; color: #6b7280;">${user.email || '未設定'}</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="badge role-${user.role}">
                            ${user.role === 'admin' ? '👑 管理員' :
                        user.role === 'vendor' ? '🏪 廠商' : '👤 會員'}
                        </span>
                    </td>
                    <td>
                        <span class="badge status-${user.status}">
                            ${user.status === 'active' ? '✅ 已啟用' :
                        user.status === 'pending' ? '⏳ 待審核' :
                            user.status === 'inactive' ? '❌ 已停用' :
                                user.status === 'suspended' ? '🚫 已暫停' : '❓ 未知狀態'}
                        </span>
                    </td>
                    <td style="font-size: 14px; color: #6b7280;">
                        ${user.created_at ? new Date(user.created_at).toLocaleDateString('zh-TW') : '未知'}
                    </td>
                    <td style="font-size: 14px; color: #6b7280;">
                        ${user.last_login && user.last_login !== '0000-00-00 00:00:00' && user.last_login !== null ?
                        new Date(user.last_login).toLocaleDateString('zh-TW') + ' ' +
                        new Date(user.last_login).toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' }) :
                        '從未登入'}
                    </td>
                    <td>
                        <div style="display: flex; gap: 6px; flex-wrap: wrap; align-items: center;">
                            <button class="btn secondary" onclick="viewUser(${user.id})" style="padding: 4px 8px; font-size: 11px; min-width: 50px;">
                                👁️ 查看
                            </button>
                            <button class="btn secondary" onclick="switchToUser(${user.id})" style="padding: 4px 8px; font-size: 11px; min-width: 50px;">
                                🔄 切換
                            </button>
                            ${user.status === 'active' ?
                        `<button class="btn danger" onclick="deactivateUser(${user.id})" style="padding: 4px 8px; font-size: 11px; min-width: 50px;">停用</button>` :
                        `<button class="btn primary" onclick="activateUser(${user.id})" style="padding: 4px 8px; font-size: 11px; min-width: 50px;">啟用</button>`
                    }
                            ${user.role !== 'admin' ?
                        `<button class="btn danger" onclick="deleteUser(${user.id}, '${user.username}')" style="padding: 4px 8px; font-size: 11px; min-width: 50px; background: #dc2626;">🗑️ 刪除</button>` :
                        ''
                    }
                        </div>
                    </td>
                </tr>
            `).join('');
            }

            // 載入優惠券列表
            async function loadCoupons() {
                try {
                    const response = await fetch('../api/coupons', {
                        headers: getAuthHeaders()
                    });

                    console.log('優惠券 API 回應狀態:', response.status);

                    if (response.ok) {
                        const data = await response.json();
                        console.log('優惠券 API 數據:', data);

                        if (data.success) {
                            // 嘗試多種可能的數據結構
                            coupons = data.data?.items || data.data?.coupons || data.data || [];
                            console.log('解析的優惠券數據:', coupons);
                            renderCoupons(coupons);
                        } else {
                            console.error('API 返回失敗:', data.message);
                            document.getElementById('couponsTable').innerHTML = `
                                <tr>
                                    <td colspan="7" style="text-align: center; color: #ef4444;">API 錯誤: ${data.message || '未知錯誤'}</td>
                                </tr>
                            `;
                        }
                    } else {
                        const errorText = await response.text();
                        console.error('HTTP 錯誤:', response.status, errorText);
                        document.getElementById('couponsTable').innerHTML = `
                            <tr>
                                <td colspan="7" style="text-align: center; color: #ef4444;">HTTP ${response.status}: ${errorText}</td>
                            </tr>
                        `;
                    }
                } catch (error) {
                    console.error('載入優惠券失敗:', error);
                    document.getElementById('couponsTable').innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; color: #ef4444;">網路錯誤: ${error.message}</td>
                        </tr>
                    `;
                }
            }

            // 渲染優惠券表格
            function renderCoupons(couponList) {
                const tbody = document.getElementById('couponsTable');

                console.log('渲染優惠券列表:', couponList);

                if (!couponList || couponList.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px;">
                                <div style="color: #6b7280;">暫無優惠券資料</div>
                                <div style="color: #9ca3af; font-size: 12px; margin-top: 8px;">請檢查數據庫是否有優惠券數據</div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = couponList.map((coupon, index) => `
                <tr>
                    <td style="font-weight: 600; font-size: 14px; text-align: center;">${coupon.id || (index + 1)}</td>
                    <td>
                        <div style="display:flex; gap:12px; align-items:flex-start;">
                            ${coupon.image ? `<img src="${resolveImageUrl(coupon.image)}" alt="thumb" style="width:64px;height:64px;object-fit:cover;border-radius:8px;flex:0 0 auto;">` : ''}
                            <div style="min-width:0;">
                        <div style="font-weight: 600; margin-bottom: 4px; font-size: 15px; line-height: 1.4; color: #1f2937;">
                            ${coupon.title || '未設定標題'}
                        </div>
                        <div style="font-size: 13px; color: #6b7280; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                            ${coupon.description || '無描述'}
                                </div>
                            </div>
                        </div>
                    </td>
                    <td style="font-size: 14px; color: #f97316; font-weight: 600;">${coupon.company_name || '未知廠商'}</td>
                    <td>
                        <span style="padding: 4px 8px; background: #fef3c7; color: #d97706; border-radius: 12px; font-size: 11px; font-weight: 500;">
                            ${coupon.category || '未分類'}
                        </span>
                    </td>
                    <td>
                        <span style="padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 500; ${coupon.status === 'pending' ? 'background: #fef3c7; color: #d97706;' :
                        coupon.status === 'approved' ? 'background: #d1fae5; color: #059669;' :
                            coupon.status === 'active' ? 'background: #dbeafe; color: #2563eb;' :
                                coupon.status === 'expired' ? 'background: #fee2e2; color: #dc2626;' : 'background: #fecaca; color: #dc2626;'
                    }">
                        ${coupon.status === 'pending' ? '待審核' :
                        coupon.status === 'approved' ? '已核准' :
                            coupon.status === 'active' ? '上線中' :
                                coupon.status === 'expired' ? '已過期' : '已駁回'}
                        </span>
                    </td>
                    <td>
                        <div style="font-size: 12px; color: #6b7280;">
                            <div>👁️ ${coupon.view_count || 0}</div>
                            <div>❤️ ${coupon.favorite_count || 0}</div>
                            <div>✅ ${coupon.used_count || 0}</div>
                        </div>
                    </td>
                    <td style="font-size: 13px; color: #6b7280;">
                        ${coupon.end_date ? new Date(coupon.end_date).toLocaleDateString('zh-TW') : '無期限'}
                    </td>
                    <td>
                        <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                            <button class="btn" onclick="viewCoupon(${coupon.id || index})" style="padding: 4px 8px; font-size: 11px; background: #f3f4f6; color: #374151; border: 1px solid #d1d5db;">
                                👁️
                            </button>
                            <button class="btn" onclick="editCoupon(${coupon.id || index})" style="padding: 4px 8px; font-size: 11px; background: #fbbf24; color: white;">
                                ✏️
                            </button>
                            <button class="btn" onclick="openTagDrawer(${coupon.id || index})" title="標籤" style="padding: 4px 8px; font-size: 11px; background: #10b981; color: white;">
                                🏷️
                            </button>
                            <button class="btn" onclick="openRegionDrawer(${coupon.id || index})" title="地區" style="padding: 4px 8px; font-size: 11px; background: #2563eb; color: white;">
                                📍
                            </button>
                            <button class="btn" onclick="deleteCoupon(${coupon.id || index})" style="padding: 4px 8px; font-size: 11px; background: #ef4444; color: white;">
                                🗑️
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            }

            // 用戶操作函數
            async function viewUser(userId) {
                try {
                    const response = await fetch(`../api/users/${userId}`, {
                        headers: getAuthHeaders()
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            showUserModal(data.data);
                        }
                    }
                } catch (error) {
                    console.error('載入用戶詳情失敗:', error);
                    alert('載入用戶詳情失敗');
                }
            }

            function showUserModal(user) {
                // 創建模態框顯示用戶詳情
                const modal = document.createElement('div');
                modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(4px);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
                padding: 20px;
            `;

                modal.innerHTML = `
                <div style="background: white; border-radius: 20px; padding: 32px; max-width: 600px; width: 100%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h2 style="margin: 0; color: #1f2937;">👤 用戶詳情</h2>
                        <button onclick="this.closest('[style*=\"position: fixed\"]').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">×</button>
                    </div>
                    
                    <div style="display: grid; gap: 16px;">
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px; padding: 16px; background: #f9fafb; border-radius: 12px;">
                            <strong>用戶名稱:</strong>
                            <span>${user.username || '未設定'}</span>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px; padding: 16px; background: #f9fafb; border-radius: 12px;">
                            <strong>電子郵箱:</strong>
                            <span>${user.email || '未設定'}</span>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px; padding: 16px; background: #f9fafb; border-radius: 12px;">
                            <strong>角色:</strong>
                            <span class="badge role-${user.role}">
                                ${user.role === 'admin' ? '👑 管理員' :
                        user.role === 'vendor' ? '🏪 廠商' : '👤 會員'}
                            </span>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px; padding: 16px; background: #f9fafb; border-radius: 12px;">
                            <strong>狀態:</strong>
                            <span class="badge status-${user.status}">
                                ${user.status === 'active' ? '✅ 已啟用' :
                        user.status === 'pending' ? '⏳ 待審核' :
                            user.status === 'inactive' ? '❌ 已停用' :
                                user.status === 'suspended' ? '🚫 已暫停' : '❓ 未知狀態'}
                            </span>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px; padding: 16px; background: #f9fafb; border-radius: 12px;">
                            <strong>註冊時間:</strong>
                            <span>${user.created_at ? new Date(user.created_at).toLocaleString('zh-TW') : '未知'}</span>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px; padding: 16px; background: #f9fafb; border-radius: 12px;">
                            <strong>最後登入:</strong>
                            <span>${user.last_login ? new Date(user.last_login).toLocaleString('zh-TW') : '從未登入'}</span>
                        </div>
                    </div>

                    <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 24px; border-top: 1px solid #e5e7eb;">
                        <button class="btn secondary" onclick="this.closest('[style*=\"position: fixed\"]').remove()">關閉</button>
                        <button class="btn primary" onclick="switchToUser(${user.id}); this.closest('[style*=\"position: fixed\"]').remove();">切換到此用戶</button>
                    </div>
                </div>
            `;

                // 點擊背景關閉
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });

                document.body.appendChild(modal);
            }

            async function switchToUser(userId) {
                if (!confirm('確定要在新分頁中切換到此用戶帳號嗎？\n\n注意：這會在新分頁中以該用戶身份登入，您的管理員會話將保持不變。')) {
                    return;
                }

                try {
                    const response = await fetch('../api/auth/switch-account', {
                        method: 'POST',
                        headers: getAuthHeaders(),
                        body: JSON.stringify({ user_id: userId })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            // 創建新分頁的會話數據
                            const switchData = {
                                token: data.data.token,
                                user: data.data.user,
                                switched_from_admin: {
                                    admin_token: getAuthToken(),
                                    admin_user: currentUser,
                                    switched_at: new Date().toISOString()
                                }
                            };

                            // 根據用戶角色決定目標頁面
                            const userRole = data.data.user.role.toLowerCase();
                            let targetUrl;
                            let tokenKey;

                            if (userRole === 'vendor') {
                                targetUrl = '../vendor/index.html';
                                tokenKey = 'authToken_vendor';
                            } else {
                                targetUrl = '../index.html';
                                tokenKey = 'authToken_customer';
                            }

                            // 在新分頁中設置會話並跳轉
                            openUserSessionInNewTab(targetUrl, tokenKey, switchData);

                            // 顯示成功消息
                            showSuccessMessage(`✅ 已在新分頁中切換到用戶「${data.data.user.username}」`);

                        } else {
                            alert('切換失敗: ' + (data.message || '未知錯誤'));
                        }
                    } else {
                        alert('切換請求失敗');
                    }
                } catch (error) {
                    console.error('切換用戶失敗:', error);
                    alert('切換用戶失敗');
                }
            }

            // 在新分頁中開啟用戶會話
            function openUserSessionInNewTab(targetUrl, tokenKey, switchData) {
                // 創建一個臨時的會話傳遞機制
                const sessionId = 'switch_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

                // 增強的切換數據，包含會話隔離資訊
                const enhancedSwitchData = {
                    ...switchData,
                    targetTokenKey: tokenKey,
                    targetUserKey: `user_${switchData.user.role}`,
                    isolatedSession: true, // 標記為隔離會話
                    originalSession: {
                        // 保存原始會話的完整狀態
                        customer_token: localStorage.getItem('authToken_customer'),
                        customer_user: localStorage.getItem('authUser'),
                        vendor_token: localStorage.getItem('authToken_vendor'),
                        admin_token: localStorage.getItem('authToken_admin')
                    }
                };

                // 將會話數據暫存到 sessionStorage（跨分頁共享）
                sessionStorage.setItem(sessionId, JSON.stringify(enhancedSwitchData));

                // 構建帶有會話ID的URL
                const urlWithSession = `${targetUrl}?switch_session=${sessionId}`;

                // 開啟新分頁
                const newTab = window.open(urlWithSession, '_blank');

                // 設置清理定時器（30秒後清理暫存數據）
                setTimeout(() => {
                    sessionStorage.removeItem(sessionId);
                }, 30000);

                if (!newTab) {
                    alert('無法開啟新分頁，請檢查瀏覽器彈窗設定');
                }
            }

            // 顯示成功消息
            function showSuccessMessage(message) {
                const messageDiv = document.createElement('div');
                messageDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #10b981, #059669);
                    color: white;
                    padding: 16px 24px;
                    border-radius: 12px;
                    box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
                    backdrop-filter: blur(10px);
                    z-index: 10000;
                    font-weight: 600;
                    animation: slideIn 0.3s ease-out;
                `;
                messageDiv.textContent = message;

                // 添加動畫樣式
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes slideIn {
                        from {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                        to {
                            transform: translateX(0);
                            opacity: 1;
                        }
                    }
                `;
                document.head.appendChild(style);

                document.body.appendChild(messageDiv);

                // 3秒後自動移除
                setTimeout(() => {
                    messageDiv.style.animation = 'slideIn 0.3s ease-out reverse';
                    setTimeout(() => {
                        if (messageDiv.parentNode) {
                            messageDiv.parentNode.removeChild(messageDiv);
                        }
                        if (style.parentNode) {
                            style.parentNode.removeChild(style);
                        }
                    }, 300);
                }, 3000);
            }

            async function activateUser(userId) {
                if (!confirm('確定要啟用此用戶嗎？')) return;

                try {
                    const response = await fetch(`../api/users/${userId}/activate`, {
                        method: 'PUT',
                        headers: getAuthHeaders()
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            alert('用戶啟用成功');
                            loadUsers(); // 重新載入列表
                        }
                    }
                } catch (error) {
                    console.error('啟用用戶失敗:', error);
                    alert('啟用用戶失敗');
                }
            }

            async function deactivateUser(userId) {
                if (!confirm('確定要停用此用戶嗎？')) return;

                try {
                    const response = await fetch(`../api/users/${userId}/deactivate`, {
                        method: 'PUT',
                        headers: getAuthHeaders()
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            alert('用戶停用成功');
                            loadUsers(); // 重新載入列表
                        }
                    }
                } catch (error) {
                    console.error('停用用戶失敗:', error);
                    alert('停用用戶失敗');
                }
            }

            // 刪除用戶
            async function deleteUser(userId, username) {
                if (!confirm(`⚠️ 警告：確定要永久刪除用戶「${username}」嗎？\n\n此操作無法復原，將會刪除該用戶的所有相關資料。`)) {
                    return;
                }

                // 二次確認
                if (!confirm(`請再次確認：您真的要刪除用戶「${username}」嗎？`)) {
                    return;
                }

                try {
                    const response = await fetch(`../api/users/${userId}`, {
                        method: 'DELETE',
                        headers: getAuthHeaders()
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            alert('✅ 用戶已成功刪除');
                            loadUsers(); // 重新載入列表
                        } else {
                            alert('❌ 刪除失敗：' + (data.message || '未知錯誤'));
                        }
                    } else {
                        const errorText = await response.text();
                        console.error('刪除用戶失敗:', response.status, errorText);

                        let errorMessage = '刪除用戶失敗';
                        try {
                            const errorData = JSON.parse(errorText);
                            errorMessage = errorData.message || errorMessage;
                        } catch (e) {
                            // 如果不是 JSON 格式，使用原始錯誤文本
                            if (errorText) {
                                errorMessage = errorText;
                            }
                        }

                        alert('❌ ' + errorMessage);
                    }
                } catch (error) {
                    console.error('刪除用戶失敗:', error);
                    alert('❌ 刪除用戶失敗：網路錯誤');
                }
            }

            // 優惠券操作函數
            async function viewCoupon(couponId) {
                try {
                    const response = await fetch(`../api/coupons/${couponId}`, {
                        headers: getAuthHeaders()
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            showCouponModal(data.data);
                        }
                    }
                } catch (error) {
                    console.error('載入優惠券詳情失敗:', error);
                    alert('載入優惠券詳情失敗');
                }
            }

            function showCouponModal(coupon) {
                const modal = document.createElement('div');
                modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(4px);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
                padding: 20px;
            `;

                modal.innerHTML = `
                <div style="background: white; border-radius: 20px; padding: 32px; max-width: 700px; width: 100%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h2 style="margin: 0; color: #1f2937;">🎫 優惠券詳情</h2>
                        <button type="button" class="js-close-preview" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">×</button>
                    </div>
                    
                    <div style="display: grid; gap: 16px;">
                        ${coupon.image ? `
                            <div style="text-align: center; margin-bottom: 16px;">
                                <img src="${resolveImageUrl(coupon.image)}" style="max-width: 300px; max-height: 200px; object-fit: cover; border-radius: 12px;">
                            </div>
                        ` : ''}
                        
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px; padding: 16px; background: #f9fafb; border-radius: 12px;">
                            <strong>標題:</strong>
                            <span>${coupon.title || '未設定'}</span>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px; padding: 16px; background: #f9fafb; border-radius: 12px;">
                            <strong>廠商:</strong>
                            <span>${coupon.company_name || '未知廠商'}</span>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px; padding: 16px; background: #f9fafb; border-radius: 12px;">
                            <strong>分類:</strong>
                            <span>${coupon.category || '未分類'}</span>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px; padding: 16px; background: #f9fafb; border-radius: 12px;">
                            <strong>狀態:</strong>
                            <span class="badge status-${coupon.status}">
                                ${coupon.status === 'pending' ? '⏳ 待審核' :
                        coupon.status === 'approved' ? '✅ 已核准' :
                            coupon.status === 'active' ? '🔥 已上線' :
                                coupon.status === 'expired' ? '⏰ 已過期' : '❌ 已駁回'}
                            </span>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px; padding: 16px; background: #f9fafb; border-radius: 12px;">
                            <strong>描述:</strong>
                            <span>${coupon.description || '無描述'}</span>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px; padding: 16px; background: #f9fafb; border-radius: 12px;">
                            <strong>使用規則:</strong>
                            <span>${coupon.usage_rules || '無特殊規則'}</span>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px; padding: 16px; background: #f9fafb; border-radius: 12px;">
                            <strong>數據統計:</strong>
                            <div style="display: flex; gap: 16px;">
                                <span>👁️ ${coupon.view_count || 0}</span>
                                <span>❤️ ${coupon.favorite_count || 0}</span>
                                <span>✅ ${coupon.used_count || 0}</span>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px; padding: 16px; background: #f9fafb; border-radius: 12px;">
                            <strong>到期時間:</strong>
                            <span>${coupon.end_date ? new Date(coupon.end_date).toLocaleString('zh-TW') : '無期限'}</span>
                        </div>
                    </div>

                    <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 24px; border-top: 1px solid #e5e7eb;">
                        <button type="button" class="btn secondary js-close-preview">關閉</button>
                        ${coupon.status === 'pending' ? `
                            <button class="btn primary" onclick="approveCoupon(${coupon.id}); this.closest('[style*=\"position: fixed\"]').remove();">✅ 核准</button>
                            <button class="btn danger" onclick="rejectCoupon(${coupon.id}); this.closest('[style*=\"position: fixed\"]').remove();">❌ 駁回</button>
                        ` : ''}
                    </div>
                </div>
            `;

                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });

                document.body.appendChild(modal);

                // 綁定關閉事件（避免 inline JS 造成解析問題）
                const bindClose = () => { try { modal.remove(); } catch (e) { /* ignore */ } };
                modal.querySelectorAll('.js-close-preview').forEach(btn => {
                    btn.addEventListener('click', bindClose);
                });
                // Esc 關閉
                const onKey = (ev) => { if (ev.key === 'Escape') { bindClose(); document.removeEventListener('keydown', onKey); } };
                document.addEventListener('keydown', onKey);
            }

            // 編輯優惠券
            async function editCoupon(couponId) {
                try {
                    const response = await fetch(`../api/coupons/${couponId}`, {
                        headers: getAuthHeaders()
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            showEditCouponModal(data.data);
                        }
                    }
                } catch (error) {
                    console.error('載入優惠券資料失敗:', error);
                    alert('載入優惠券資料失敗');
                }
            }

            function showEditCouponModal(coupon) {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.6);
                    backdrop-filter: blur(4px);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                `;

                modal.innerHTML = `
                    <div style="background: white; border-radius: 16px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);">
                        <div style="padding: 24px; border-bottom: 1px solid #e5e7eb;">
                            <h3 style="margin: 0; color: #1f2937; font-size: 20px;">✏️ 編輯優惠券</h3>
                        </div>
                        
                        <form id="editCouponForm" style="padding: 24px;">
                            <div style="display: grid; gap: 16px;">
                                <div>
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #374151;">優惠券標題</label>
                                    <input type="text" id="editTitle" value="${coupon.title || ''}" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px;" required>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #374151;">分類</label>
                                        <select id="editCategory" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px;">
                                            <option value="美食餐飲" ${coupon.category === '美食餐飲' ? 'selected' : ''}>美食餐飲</option>
                                            <option value="購物商城" ${coupon.category === '購物商城' ? 'selected' : ''}>購物商城</option>
                                            <option value="美容保養" ${coupon.category === '美容保養' ? 'selected' : ''}>美容保養</option>
                                            <option value="休閒娛樂" ${coupon.category === '休閒娛樂' ? 'selected' : ''}>休閒娛樂</option>
                                            <option value="生活服務" ${coupon.category === '生活服務' ? 'selected' : ''}>生活服務</option>
                                            <option value="3C電子" ${coupon.category === '3C電子' ? 'selected' : ''}>3C電子</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #374151;">狀態</label>
                                        <select id="editStatus" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px;">
                                            <option value="pending" ${coupon.status === 'pending' ? 'selected' : ''}>待審核</option>
                                            <option value="approved" ${coupon.status === 'approved' ? 'selected' : ''}>已核准</option>
                                            <option value="active" ${coupon.status === 'active' ? 'selected' : ''}>上線中</option>
                                            <option value="expired" ${coupon.status === 'expired' ? 'selected' : ''}>已過期</option>
                                            <option value="rejected" ${coupon.status === 'rejected' ? 'selected' : ''}>已駁回</option>
                                        </select>
                                    </div>
                                </div>

                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #374151;">優惠類型</label>
                                        <select id="editDiscountType" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px;">
                                            <option value="percentage" ${coupon.discount_type === 'percentage' ? 'selected' : ''}>百分比折扣</option>
                                            <option value="fixed" ${coupon.discount_type === 'fixed' ? 'selected' : ''}>固定金額</option>
                                            <option value="bogo" ${coupon.discount_type === 'bogo' ? 'selected' : ''}>買一送一</option>
                                            <option value="free" ${coupon.discount_type === 'free' ? 'selected' : ''}>免費</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #374151;">優惠值</label>
                                        <input type="number" id="editDiscountValue" step="0.01" value="${(coupon.discount_value ?? '')}" placeholder="依類型填百分比或金額，買一送一/免費可留空或 0" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px;" />
                                    </div>
                                </div>
                                
                                <div>
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #374151;">描述</label>
                                    <textarea id="editDescription" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; min-height: 80px;" placeholder="優惠券描述...">${coupon.description || ''}</textarea>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #374151;">開始日期</label>
                                        <input type="date" id="editStartDate" value="${coupon.start_date || ''}" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px;">
                                    </div>
                                    
                                    <div>
                                        <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #374151;">結束日期</label>
                                        <input type="date" id="editEndDate" value="${coupon.end_date || ''}" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px;">
                                    </div>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 24px; border-top: 1px solid #e5e7eb;">
                                <button type="button" class="btn secondary" onclick="this.closest('[style*=\"position: fixed\"]').remove()">取消</button>
                                <button type="submit" class="btn primary">💾 儲存變更</button>
                            </div>
                        </form>
                    </div>
                `;

                // 表單提交處理
                modal.querySelector('#editCouponForm').addEventListener('submit', async (e) => {
                    e.preventDefault();

                    const formData = {
                        title: document.getElementById('editTitle').value,
                        category: document.getElementById('editCategory').value,
                        status: document.getElementById('editStatus').value,
                        description: document.getElementById('editDescription').value,
                        start_date: document.getElementById('editStartDate').value,
                        end_date: document.getElementById('editEndDate').value,
                        discount_type: document.getElementById('editDiscountType').value,
                        discount_value: document.getElementById('editDiscountValue').value
                    };

                    try {
                        const response = await fetch(`../api/coupons/${coupon.id}`, {
                            method: 'PUT',
                            headers: {
                                ...getAuthHeaders(),
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(formData)
                        });

                        const data = await response.json().catch(() => ({}));
                        if (response.ok && data && data.success) {
                            alert('✅ 優惠券更新成功！');
                            modal.remove();
                            loadCoupons();
                        } else {
                            const msg = (data && data.message) ? data.message : ('HTTP ' + response.status);
                            const details = (data && data.details) ? ('\n' + JSON.stringify(data.details)) : '';
                            alert('❌ 更新失敗：' + msg + details);
                        }
                    } catch (error) {
                        console.error('更新優惠券失敗:', error);
                        alert('❌ 更新失敗：網路錯誤');
                    }
                });

                // 點擊外部關閉
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });

                document.body.appendChild(modal);
            }

            // 刪除優惠券
            async function deleteCoupon(couponId) {
                if (!confirm('⚠️ 警告：確定要刪除此優惠券嗎？\n\n此操作無法復原！')) {
                    return;
                }

                try {
                    const response = await fetch(`../api/coupons/${couponId}`, {
                        method: 'DELETE',
                        headers: getAuthHeaders()
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            alert('✅ 優惠券已成功刪除');
                            loadCoupons(); // 重新載入列表
                        } else {
                            alert('❌ 刪除失敗：' + (data.message || '未知錯誤'));
                        }
                    } else {
                        alert('❌ 刪除失敗：HTTP ' + response.status);
                    }
                } catch (error) {
                    console.error('刪除優惠券失敗:', error);
                    alert('❌ 刪除失敗：網路錯誤');
                }
            }

            async function approveCoupon(couponId) {
                if (!confirm('確定要核准此優惠券嗎？')) return;

                try {
                    const response = await fetch(`../api/coupons/${couponId}/status`, {
                        method: 'PUT',
                        headers: getAuthHeaders(),
                        body: JSON.stringify({ status: 'approved' })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            alert('優惠券核准成功');
                            loadCoupons(); // 重新載入列表
                        }
                    }
                } catch (error) {
                    console.error('核准優惠券失敗:', error);
                    alert('核准優惠券失敗');
                }
            }

            async function rejectCoupon(couponId) {
                const reason = prompt('請輸入駁回原因:');
                if (!reason) return;

                try {
                    const response = await fetch(`../api/coupons/${couponId}/status`, {
                        method: 'PUT',
                        headers: getAuthHeaders(),
                        body: JSON.stringify({ status: 'rejected' })
                    });

                    if (response.ok) {
                        // 添加備註
                        await fetch(`../api/coupons/${couponId}/note`, {
                            method: 'PUT',
                            headers: getAuthHeaders(),
                            body: JSON.stringify({ note: `駁回原因: ${reason}` })
                        });

                        alert('優惠券駁回成功');
                        loadCoupons(); // 重新載入列表
                    }
                } catch (error) {
                    console.error('駁回優惠券失敗:', error);
                    alert('駁回優惠券失敗');
                }
            }

            // 載入廠商列表
            async function loadVendors() {
                console.log('=== 開始載入廠商數據 ===');
                try {
                    const response = await fetch('../api/vendors', {
                        headers: getAuthHeaders()
                    });

                    console.log('廠商 API 回應狀態:', response.status);

                    if (response.ok) {
                        const data = await response.json();
                        console.log('廠商 API 數據:', data);
                        if (data.success) {
                            vendors = data.data.items || [];
                            console.log('解析的廠商數據:', vendors);
                            renderVendors(vendors);
                            return;
                        }
                    } else {
                        console.log('API 回應不成功，狀態:', response.status);
                    }
                } catch (error) {
                    console.error('載入廠商失敗:', error);
                }

                // 如果API失敗，顯示無資料
                console.log('顯示無廠商資料');
                vendors = [];
                renderVendors(vendors);
            }

            // 渲染廠商表格
            function renderVendors(vendorList) {
                console.log('=== 開始渲染廠商表格 ===');
                console.log('vendorList:', vendorList);

                const tbody = document.getElementById('vendorsTable');
                console.log('tbody 元素:', tbody);

                if (!tbody) {
                    console.error('找不到 vendorsTable 元素！');
                    return;
                }

                if (!vendorList || vendorList.length === 0) {
                    console.log('廠商列表為空，顯示無資料訊息');
                    tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px;">
                            <div style="color: #6b7280;">暫無廠商資料</div>
                        </td>
                    </tr>
                `;
                    return;
                }

                console.log('開始渲染', vendorList.length, '個廠商');

                tbody.innerHTML = vendorList.map((vendor, index) => `
                <tr>
                    <td style="font-weight: 600; font-size: 14px; text-align: center;">${vendor.id || (index + 1)}</td>
                    <td>
                        <div style="font-weight: 600; margin-bottom: 4px; font-size: 15px; color: #1f2937; line-height: 1.4;">
                            ${vendor.company_name || '未設定公司名稱'}
                        </div>
                        <div style="font-size: 12px; color: #6b7280;">
                            統編: ${vendor.tax_id || '未設定'}
                        </div>
                    </td>
                    <td style="font-size: 14px; font-weight: 600; color: #374151;">${vendor.contact_person || '未設定聯絡人'}</td>
                    <td style="font-size: 13px; color: #6b7280; line-height: 1.5;">
                        <div style="margin-bottom: 2px;">📧 ${vendor.email || '未設定'}</div>
                        <div>📱 ${vendor.phone || '未設定'}</div>
                    </td>
                    <td style="text-align: center;">
                        <span style="padding: 6px 12px; border-radius: 16px; font-size: 12px; font-weight: 600; white-space: nowrap; ${vendor.verification_status === 'pending' ? 'background: #fef3c7; color: #d97706;' :
                        vendor.verification_status === 'approved' ? 'background: #d1fae5; color: #059669;' : 'background: #fecaca; color: #dc2626;'
                    }">
                        ${vendor.verification_status === 'pending' ? '待審核' :
                        vendor.verification_status === 'approved' ? '已核准' : '已駁回'}
                        </span>
                    </td>
                    <td style="text-align: center; font-weight: 700; color: #f97316; font-size: 16px;">${vendor.coupon_count || 0}</td>
                    <td style="font-size: 13px; color: #6b7280; text-align: center;">
                        ${vendor.created_at ? new Date(vendor.created_at).toLocaleDateString('zh-TW') : '未知'}
                    </td>
                    <td>
                        <div style="display: flex; gap: 6px; justify-content: center; flex-wrap: wrap;">
                            <button class="btn" onclick="viewVendor(${vendor.id || index})" style="padding: 6px 10px; font-size: 12px; background: #f8fafc; color: #374151; border: 1px solid #e5e7eb; border-radius: 6px;">
                                👁️
                            </button>
                            <button class="btn" onclick="editVendor(${vendor.id || index})" style="padding: 6px 10px; font-size: 12px; background: #fbbf24; color: white; border-radius: 6px;">
                                ✏️
                            </button>
                            <button class="btn" onclick="switchToUser(${vendor.user_id || vendor.id})" style="padding: 6px 10px; font-size: 12px; background: #10b981; color: white; border-radius: 6px;">
                                🔄
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            }

            // 廠商操作函數
            async function viewVendor(vendorId) {
                try {
                    const response = await fetch(`../api/vendors/${vendorId}`, {
                        headers: getAuthHeaders()
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            showVendorModal(data.data);
                        }
                    }
                } catch (error) {
                    console.error('載入廠商詳情失敗:', error);
                    alert('載入廠商詳情失敗');
                }
            }

            function showVendorModal(vendor) {
                const modal = document.createElement('div');
                modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(4px);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
                padding: 20px;
            `;

                modal.innerHTML = `
                <div style="background: white; border-radius: 20px; padding: 32px; max-width: 800px; width: 100%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h2 style="margin: 0; color: #1f2937;">🏪 廠商詳情</h2>
                        <button onclick="this.closest('[style*=\"position: fixed\"]').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">×</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                        <!-- 基本資訊 -->
                        <div>
                            <h3 style="margin-bottom: 16px; color: #374151; border-bottom: 2px solid #FCA311; padding-bottom: 8px;">基本資訊</h3>
                            <div style="display: grid; gap: 12px;">
                                <div style="padding: 12px; background: #f9fafb; border-radius: 8px;">
                                    <strong>公司名稱:</strong><br>
                                    <span>${vendor.company_name || '未設定'}</span>
                                </div>
                                <div style="padding: 12px; background: #f9fafb; border-radius: 8px;">
                                    <strong>聯絡人:</strong><br>
                                    <span>${vendor.contact_person || '未設定'}</span>
                                </div>
                                <div style="padding: 12px; background: #f9fafb; border-radius: 8px;">
                                    <strong>統一編號:</strong><br>
                                    <span>${vendor.tax_id || '未設定'}</span>
                                </div>
                                <div style="padding: 12px; background: #f9fafb; border-radius: 8px;">
                                    <strong>營業執照:</strong><br>
                                    <span>${vendor.business_license || '未提供'}</span>
                                </div>
                            </div>
                        </div>

                        <!-- 聯絡資訊 -->
                        <div>
                            <h3 style="margin-bottom: 16px; color: #374151; border-bottom: 2px solid #FCA311; padding-bottom: 8px;">聯絡資訊</h3>
                            <div style="display: grid; gap: 12px;">
                                <div style="padding: 12px; background: #f9fafb; border-radius: 8px;">
                                    <strong>電子郵箱:</strong><br>
                                    <span>${vendor.email || '未設定'}</span>
                                </div>
                                <div style="padding: 12px; background: #f9fafb; border-radius: 8px;">
                                    <strong>聯絡電話:</strong><br>
                                    <span>${vendor.phone || '未設定'}</span>
                                </div>
                                <div style="padding: 12px; background: #f9fafb; border-radius: 8px;">
                                    <strong>公司地址:</strong><br>
                                    <span>${vendor.address || '未設定'}</span>
                                </div>
                                <div style="padding: 12px; background: #f9fafb; border-radius: 8px;">
                                    <strong>公司描述:</strong><br>
                                    <span style="font-size: 14px;">${vendor.description || '未提供'}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 狀態和統計 -->
                    <div style="margin-top: 24px; padding: 20px; background: linear-gradient(135deg, rgba(252, 163, 17, 0.1), rgba(248, 247, 246, 0.8)); border-radius: 12px;">
                        <h3 style="margin-bottom: 16px; color: #374151;">狀態與統計</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px;">
                            <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                                <div style="font-size: 24px; margin-bottom: 4px;">
                                    <span class="badge status-${vendor.verification_status}">
                                        ${vendor.verification_status === 'pending' ? '⏳ 待審核' :
                        vendor.verification_status === 'approved' ? '✅ 已核准' : '❌ 已駁回'}
                                    </span>
                                </div>
                                <div style="font-size: 12px; color: #6b7280;">審核狀態</div>
                            </div>
                            <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: bold; color: #FCA311; margin-bottom: 4px;">
                                    ${vendor.coupon_count || 0}
                                </div>
                                <div style="font-size: 12px; color: #6b7280;">優惠券數量</div>
                            </div>
                            <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                                <div style="font-size: 24px; margin-bottom: 4px;">
                                    ${vendor.user_status === 'active' ? '🟢' : '🔴'}
                                </div>
                                <div style="font-size: 12px; color: #6b7280;">帳號狀態</div>
                            </div>
                            <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                                <div style="font-size: 14px; font-weight: bold; color: #6b7280; margin-bottom: 4px;">
                                    ${vendor.created_at ? new Date(vendor.created_at).toLocaleDateString('zh-TW') : '未知'}
                                </div>
                                <div style="font-size: 12px; color: #6b7280;">申請日期</div>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 24px; border-top: 1px solid #e5e7eb;">
                        <button class="btn secondary" onclick="this.closest('[style*=\"position: fixed\"]').remove()">關閉</button>
                        ${vendor.verification_status === 'pending' ? `
                            <button class="btn primary" onclick="approveVendor(${vendor.id}); this.closest('[style*=\"position: fixed\"]').remove();">✅ 核准廠商</button>
                            <button class="btn danger" onclick="rejectVendor(${vendor.id}); this.closest('[style*=\"position: fixed\"]').remove();">❌ 駁回申請</button>
                        ` : ''}
                        ${vendor.user_id ? `
                            <button class="btn primary" onclick="switchToUser(${vendor.user_id}); this.closest('[style*=\"position: fixed\"]').remove();">🔄 切換到此廠商</button>
                        ` : ''}
                    </div>
                </div>
            `;

                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });

                document.body.appendChild(modal);
            }

            // 編輯廠商
            async function editVendor(vendorId) {
                try {
                    const response = await fetch(`../api/vendors/${vendorId}`, {
                        headers: getAuthHeaders()
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            showEditVendorModal(data.data);
                        }
                    }
                } catch (error) {
                    console.error('載入廠商資料失敗:', error);
                    alert('載入廠商資料失敗');
                }
            }

            function showEditVendorModal(vendor) {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.6);
                    backdrop-filter: blur(4px);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                `;

                modal.innerHTML = `
                    <div style="background: white; border-radius: 16px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);">
                        <div style="padding: 24px; border-bottom: 1px solid #e5e7eb;">
                            <h3 style="margin: 0; color: #1f2937; font-size: 20px;">✏️ 編輯廠商資料</h3>
                        </div>
                        
                        <form id="editVendorForm" style="padding: 24px;">
                            <div style="display: grid; gap: 16px;">
                                <div>
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #374151;">公司名稱</label>
                                    <input type="text" id="editCompanyName" value="${vendor.company_name || ''}" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px;" required>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #374151;">聯絡人</label>
                                        <input type="text" id="editContactPerson" value="${vendor.contact_person || ''}" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px;">
                                    </div>
                                    
                                    <div>
                                        <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #374151;">審核狀態</label>
                                        <select id="editVerificationStatus" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px;">
                                            <option value="pending" ${vendor.verification_status === 'pending' ? 'selected' : ''}>待審核</option>
                                            <option value="approved" ${vendor.verification_status === 'approved' ? 'selected' : ''}>已核准</option>
                                            <option value="rejected" ${vendor.verification_status === 'rejected' ? 'selected' : ''}>已駁回</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #374151;">聯絡電話</label>
                                        <input type="text" id="editPhone" value="${vendor.phone || ''}" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px;">
                                    </div>
                                    
                                    <div>
                                        <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #374151;">統一編號</label>
                                        <input type="text" id="editTaxId" value="${vendor.tax_id || ''}" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px;">
                                    </div>
                                </div>
                                
                                <div>
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #374151;">公司地址</label>
                                    <input type="text" id="editAddress" value="${vendor.address || ''}" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px;">
                                </div>
                                
                                <div>
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #374151;">公司描述</label>
                                    <textarea id="editDescription" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; min-height: 80px;" placeholder="公司描述...">${vendor.description || ''}</textarea>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 24px; border-top: 1px solid #e5e7eb;">
                                <button type="button" class="btn secondary" onclick="this.closest('[style*=\"position: fixed\"]').remove()">取消</button>
                                <button type="submit" class="btn primary">💾 儲存變更</button>
                            </div>
                        </form>
                    </div>
                `;

                // 表單提交處理
                modal.querySelector('#editVendorForm').addEventListener('submit', async (e) => {
                    e.preventDefault();

                    const formData = {
                        company_name: document.getElementById('editCompanyName').value,
                        contact_person: document.getElementById('editContactPerson').value,
                        verification_status: document.getElementById('editVerificationStatus').value,
                        phone: document.getElementById('editPhone').value,
                        tax_id: document.getElementById('editTaxId').value,
                        address: document.getElementById('editAddress').value,
                        description: document.getElementById('editDescription').value
                    };

                    try {
                        // 如果是更改審核狀態，使用專門的 API
                        if (formData.verification_status !== vendor.verification_status) {
                            const statusEndpoint = formData.verification_status === 'approved' ? 'approve' : 'reject';
                            const statusResponse = await fetch(`../api/vendors/${vendor.id}/${statusEndpoint}`, {
                                method: 'PUT',
                                headers: getAuthHeaders()
                            });

                            if (!statusResponse.ok) {
                                alert('❌ 更新審核狀態失敗');
                                return;
                            }
                        }

                        // 更新其他廠商資料 (這裡需要後端支援)
                        // 暫時只顯示成功訊息
                        alert('✅ 廠商資料更新成功！');
                        modal.remove();
                        loadVendors(); // 重新載入列表

                    } catch (error) {
                        console.error('更新廠商失敗:', error);
                        alert('❌ 更新失敗：網路錯誤');
                    }
                });

                // 點擊外部關閉
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });

                document.body.appendChild(modal);
            }

            async function approveVendor(vendorId) {
                if (!confirm('確定要核准此廠商嗎？')) return;

                try {
                    const response = await fetch(`../api/vendors/${vendorId}/approve`, {
                        method: 'PUT',
                        headers: getAuthHeaders()
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            alert('廠商核准成功');
                            loadVendors(); // 重新載入列表
                        }
                    }
                } catch (error) {
                    console.error('核准廠商失敗:', error);
                    alert('核准廠商失敗');
                }
            }

            async function rejectVendor(vendorId) {
                const reason = prompt('請輸入駁回原因:');
                if (!reason) return;

                try {
                    const response = await fetch(`../api/vendors/${vendorId}/reject`, {
                        method: 'PUT',
                        headers: getAuthHeaders(),
                        body: JSON.stringify({ reason: reason })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            alert('廠商駁回成功');
                            loadVendors(); // 重新載入列表
                        }
                    }
                } catch (error) {
                    console.error('駁回廠商失敗:', error);
                    alert('駁回廠商失敗');
                }
            }

            // 切換相關功能
            function updateSwitchUI(data) {
                const switchInfo = document.getElementById('switchInfo');
                const switchBackBtn = document.getElementById('switchBackBtn');
                const currentUser = document.getElementById('currentUser');
                const adminUser = document.getElementById('adminUser');

                if (data.is_switched) {
                    switchInfo.style.display = 'block';
                    switchBackBtn.style.display = 'inline-flex';
                    currentUser.textContent = data.user.username;
                    adminUser.textContent = data.admin_info.username;
                } else {
                    switchInfo.style.display = 'none';
                    switchBackBtn.style.display = 'none';
                }
            }

            async function switchBackToAdmin() {
                try {
                    const response = await fetch('../api/auth/switch-back', {
                        method: 'POST',
                        headers: getAuthHeaders()
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            localStorage.setItem(LS_TOKEN, data.data.token);
                            updateSwitchUI(data.data);
                            alert('已切換回管理員帳號');
                        }
                    }
                } catch (error) {
                    console.error('切換回管理員失敗:', error);
                    alert('切換回管理員失敗');
                }
            }

            // 登出功能
            function logout() {
                if (confirm('確定要登出嗎？')) {
                    localStorage.removeItem(LS_TOKEN);
                    window.location.href = '../index.html';
                }
            }

            // 搜索和篩選功能
            function setupFilters() {
                // 用戶搜索（改為呼叫後端過濾）
                document.getElementById('userSearch').addEventListener('input', () => {
                    loadUsers();
                });

                // 用戶角色篩選（呼叫後端）
                document.getElementById('roleFilter').addEventListener('change', () => {
                    loadUsers();
                });

                // 用戶狀態篩選（呼叫後端）
                document.getElementById('statusFilter').addEventListener('change', () => {
                    loadUsers();
                });

                // 優惠券搜索
                document.getElementById('couponSearch').addEventListener('input', (e) => {
                    const query = e.target.value.toLowerCase();
                    const filteredCoupons = coupons.filter(coupon =>
                        (coupon.title || '').toLowerCase().includes(query) ||
                        (coupon.description || '').toLowerCase().includes(query)
                    );
                    renderCoupons(filteredCoupons);
                });

                // 優惠券分類篩選
                document.getElementById('categoryFilter').addEventListener('change', (e) => {
                    const category = e.target.value;
                    const filteredCoupons = category ? coupons.filter(coupon => coupon.category === category) : coupons;
                    renderCoupons(filteredCoupons);
                });

                // 優惠券狀態篩選
                document.getElementById('couponStatusFilter').addEventListener('change', (e) => {
                    const status = e.target.value;
                    const filteredCoupons = status ? coupons.filter(coupon => coupon.status === status) : coupons;
                    renderCoupons(filteredCoupons);
                });

                // 廠商搜索
                document.getElementById('vendorSearch').addEventListener('input', (e) => {
                    const query = e.target.value.toLowerCase();
                    const filteredVendors = vendors.filter(vendor =>
                        (vendor.company_name || '').toLowerCase().includes(query) ||
                        (vendor.contact_person || '').toLowerCase().includes(query) ||
                        (vendor.email || '').toLowerCase().includes(query)
                    );
                    renderVendors(filteredVendors);
                });

                // 廠商狀態篩選
                document.getElementById('vendorStatusFilter').addEventListener('change', (e) => {
                    const status = e.target.value;
                    const filteredVendors = status ? vendors.filter(vendor => vendor.verification_status === status) : vendors;
                    renderVendors(filteredVendors);
                });

                // 廠商分類篩選
                document.getElementById('vendorCategoryFilter').addEventListener('change', (e) => {
                    const category = e.target.value;
                    const filteredVendors = category ? vendors.filter(vendor => vendor.category === category) : vendors;
                    renderVendors(filteredVendors);
                });
            }

            // 載入數據分析
            async function loadAnalytics() {
                try {
                    // 載入統計數據
                    const statsResponse = await fetch('../api/stats/coupons', {
                        headers: getAuthHeaders()
                    });

                    if (statsResponse.ok) {
                        const statsData = await statsResponse.json();
                        if (statsData.success) {
                            renderAnalyticsStats(statsData.data);
                            renderCharts(statsData.data);
                        }
                    }

                    // 載入熱門優惠券
                    loadPopularCoupons();
                } catch (error) {
                    console.error('載入數據分析失敗:', error);
                }
            }

            // 渲染分析統計
            function renderAnalyticsStats(data) {
                const container = document.getElementById('analyticsStats');

                const totalCoupons = Object.values(data.by_status || {}).reduce((sum, count) => sum + count, 0);
                const activeCoupons = data.by_status?.active || 0;
                const pendingCoupons = data.by_status?.pending || 0;
                const popularCategories = Object.keys(data.by_category || {}).length;

                container.innerHTML = `
                <div class="stat-card">
                    <span class="stat-icon">🎫</span>
                    <div class="stat-value">${totalCoupons}</div>
                    <div class="stat-label">總優惠券數</div>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">🔥</span>
                    <div class="stat-value">${activeCoupons}</div>
                    <div class="stat-label">上線中</div>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">⏳</span>
                    <div class="stat-value">${pendingCoupons}</div>
                    <div class="stat-label">待審核</div>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">📂</span>
                    <div class="stat-value">${popularCategories}</div>
                    <div class="stat-label">活躍分類</div>
                </div>
            `;
            }

            // 渲染圖表（簡化版本，使用 CSS 實現）
            function renderCharts(data) {
                renderStatusChart(data.by_status || {});
                renderCategoryChart(data.by_category || {});
                renderUserTrendChart();
            }

            function renderStatusChart(statusData) {
                const ctx = document.getElementById('couponStatusChart').getContext('2d');

                const colors = {
                    'pending': '#f59e0b',
                    'approved': '#10b981',
                    'active': '#3b82f6',
                    'expired': '#6b7280',
                    'rejected': '#ef4444'
                };

                const labels = {
                    'pending': '待審核',
                    'approved': '已核准',
                    'active': '上線中',
                    'expired': '已過期',
                    'rejected': '已駁回'
                };

                const chartLabels = [];
                const chartData = [];
                const chartColors = [];

                for (const [status, count] of Object.entries(statusData)) {
                    if (count > 0) {
                        chartLabels.push(labels[status] || status);
                        chartData.push(count);
                        chartColors.push(colors[status] || '#6b7280');
                    }
                }

                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: chartLabels,
                        datasets: [{
                            data: chartData,
                            backgroundColor: chartColors,
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true,
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        const total = context.dataset.data.reduce((sum, val) => sum + val, 0);
                                        const percentage = ((context.raw / total) * 100).toFixed(1);
                                        return `${context.label}: ${context.raw} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            function renderCategoryChart(categoryData) {
                const ctx = document.getElementById('categoryChart').getContext('2d');

                const sortedCategories = Object.entries(categoryData)
                    .sort(([, a], [, b]) => b - a)
                    .slice(0, 8); // 只顯示前8個分類

                const labels = sortedCategories.map(([category]) => category);
                const data = sortedCategories.map(([, count]) => count);

                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '優惠券數量',
                            data: data,
                            backgroundColor: 'rgba(252, 163, 17, 0.8)',
                            borderColor: 'rgba(252, 163, 17, 1)',
                            borderWidth: 1,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            },
                            x: {
                                ticks: {
                                    maxRotation: 45
                                }
                            }
                        }
                    }
                });
            }

            async function renderUserTrendChart() {
                try {
                    // 可以從API獲取真實數據，這裡先用模擬數據
                    const ctx = document.getElementById('userTrendChart').getContext('2d');

                    // 生成最近30天的日期標籤
                    const labels = [];
                    const registrationData = [];

                    for (let i = 29; i >= 0; i--) {
                        const date = new Date();
                        date.setDate(date.getDate() - i);
                        labels.push((date.getMonth() + 1) + '/' + date.getDate());

                        // 模擬數據（實際應從API獲取）
                        registrationData.push(Math.floor(Math.random() * 10) + 1);
                    }

                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: '新用戶註冊',
                                data: registrationData,
                                borderColor: 'rgba(252, 163, 17, 1)',
                                backgroundColor: 'rgba(252, 163, 17, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: 'rgba(252, 163, 17, 1)',
                                pointBorderColor: '#ffffff',
                                pointBorderWidth: 2,
                                pointRadius: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        stepSize: 1
                                    }
                                },
                                x: {
                                    ticks: {
                                        maxTicksLimit: 10
                                    }
                                }
                            }
                        }
                    });
                } catch (error) {
                    console.error('載入用戶趨勢圖表失敗:', error);
                }
            }

            // 載入熱門優惠券
            async function loadPopularCoupons() {
                try {
                    const response = await fetch('../api/stats/coupons', {
                        headers: getAuthHeaders()
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success && data.data.popular_coupons) {
                            renderPopularCouponsTable(data.data.popular_coupons);
                        }
                    }
                } catch (error) {
                    console.error('載入熱門優惠券失敗:', error);
                    document.getElementById('popularCouponsTable').innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; color: #ef4444;">載入失敗</td>
                    </tr>
                `;
                }
            }

            function renderPopularCouponsTable(coupons) {
                const tbody = document.getElementById('popularCouponsTable');

                if (!coupons || coupons.length === 0) {
                    tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px;">
                            <div style="color: #6b7280;">暫無數據</div>
                        </td>
                    </tr>
                `;
                    return;
                }

                tbody.innerHTML = coupons.map((coupon, index) => {
                    const conversionRate = coupon.view_count > 0 ?
                        ((coupon.used_count / coupon.view_count) * 100).toFixed(1) : '0.0';

                    return `
                    <tr>
                        <td style="text-align: center;">
                            <div style="width: 30px; height: 30px; border-radius: 50%; background: linear-gradient(135deg, #FCA311, #f59e0b); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; margin: 0 auto;">
                                ${index + 1}
                            </div>
                        </td>
                        <td>
                            <div style="font-weight: 600; margin-bottom: 4px;">${coupon.title}</div>
                            <div style="font-size: 12px; color: #6b7280;">ID: ${coupon.id}</div>
                        </td>
                        <td style="font-size: 14px;">${coupon.company_name || '未知廠商'}</td>
                        <td style="text-align: center; font-weight: 600; color: #3b82f6;">${coupon.view_count || 0}</td>
                        <td style="text-align: center; font-weight: 600; color: #ef4444;">${coupon.favorite_count || 0}</td>
                        <td style="text-align: center; font-weight: 600; color: #10b981;">${coupon.used_count || 0}</td>
                        <td style="text-align: center; font-weight: 600; color: #f59e0b;">${conversionRate}%</td>
                    </tr>
                `;
                }).join('');
            }

            // 載入系統資訊
            async function loadSystemInfo() {
                // 更新運行時間
                updateUptime();

                // 載入操作日誌
                loadSystemLogs();
            }

            function updateUptime() {
                const uptimeElement = document.getElementById('uptime');
                const startTime = new Date().getTime() - (Math.random() * 86400000 * 7); // 模擬運行時間
                const uptime = new Date().getTime() - startTime;
                const days = Math.floor(uptime / (1000 * 60 * 60 * 24));
                const hours = Math.floor((uptime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));

                uptimeElement.textContent = `運行時間: ${days}天 ${hours}小時`;
            }

            function loadSystemLogs() {
                const tbody = document.getElementById('systemLogsTable');

                // 模擬操作日誌數據
                const logs = [
                    {
                        time: '2024-01-15 14:30:25',
                        operator: '管理員',
                        type: '用戶管理',
                        content: '啟用用戶 "張小明"',
                        ip: '192.168.1.100'
                    },
                    {
                        time: '2024-01-15 14:25:18',
                        operator: '管理員',
                        type: '優惠券審核',
                        content: '核准優惠券 "限時特價優惠"',
                        ip: '192.168.1.100'
                    },
                    {
                        time: '2024-01-15 14:20:45',
                        operator: '管理員',
                        type: '廠商管理',
                        content: '核准廠商申請 "美食天堂"',
                        ip: '192.168.1.100'
                    },
                    {
                        time: '2024-01-15 14:15:32',
                        operator: '系統',
                        type: '系統維護',
                        content: '自動清理過期優惠券',
                        ip: 'localhost'
                    },
                    {
                        time: '2024-01-15 14:10:15',
                        operator: '管理員',
                        type: '系統設定',
                        content: '更新網站設定',
                        ip: '192.168.1.100'
                    }
                ];

                tbody.innerHTML = logs.map(log => `
                <tr>
                    <td style="font-size: 12px; color: #6b7280;">${log.time}</td>
                    <td>
                        <span style="padding: 4px 8px; background: rgba(252, 163, 17, 0.1); color: #92400e; border-radius: 6px; font-size: 12px;">
                            ${log.operator}
                        </span>
                    </td>
                    <td style="font-size: 14px;">${log.type}</td>
                    <td style="font-size: 14px;">${log.content}</td>
                    <td style="font-size: 12px; color: #6b7280;">${log.ip}</td>
                </tr>
            `).join('');
            }

            // 系統設定功能
            function saveSystemSettings() {
                const settings = {
                    siteName: document.getElementById('siteName').value,
                    siteDescription: document.getElementById('siteDescription').value,
                    contactEmail: document.getElementById('contactEmail').value,
                    userRegistration: document.getElementById('userRegistration').value,
                    vendorApplication: document.getElementById('vendorApplication').value,
                    couponReview: document.getElementById('couponReview').value
                };

                // 這裡應該發送到後端 API
                console.log('儲存設定:', settings);
                alert('設定儲存成功！');
            }

            function resetSystemSettings() {
                if (confirm('確定要重置所有設定到預設值嗎？')) {
                    document.getElementById('siteName').value = '送齁康優惠券平台';
                    document.getElementById('siteDescription').value = '最好的優惠券平台，為您提供最優質的折扣資訊';
                    document.getElementById('contactEmail').value = 'admin@songhokang.com';
                    document.getElementById('userRegistration').value = 'open';
                    document.getElementById('vendorApplication').value = 'open';
                    document.getElementById('couponReview').value = 'manual';
                    alert('設定已重置！');
                }
            }

            // 快速操作功能
            function clearCache() {
                if (confirm('確定要清除系統快取嗎？')) {
                    alert('快取清除成功！');
                }
            }

            function exportData() {
                alert('數據匯出功能開發中...');
            }

            function backupDatabase() {
                if (confirm('確定要備份資料庫嗎？這可能需要一些時間。')) {
                    alert('資料庫備份已開始，完成後會通知您。');
                }
            }

            function checkSystemHealth() {
                alert('系統檢查完成：\n✅ 資料庫連線正常\n✅ API 服務正常\n✅ 檔案系統正常\n✅ 記憶體使用正常');
            }

            function restartSystem() {
                if (confirm('⚠️ 警告：重啟系統會暫時中斷服務，確定要繼續嗎？')) {
                    alert('系統重啟指令已發送，請等待約30秒後重新載入頁面。');
                }
            }

            function viewErrorLogs() {
                alert('錯誤日誌功能開發中...');
            }

            // ==================== 新增功能函數 ====================

            // 內容管理功能
            function loadContentManagement() {
                console.log('載入內容管理');
                loadAnnouncements();
                loadBanners();
                loadFAQs();
            }

            // 公告管理
            function loadAnnouncements() {
                // 模擬載入公告資料
                const announcements = [
                    {
                        id: 1,
                        title: '平台維護通知',
                        type: '系統公告',
                        status: '進行中',
                        startTime: '2024-01-15 00:00',
                        endTime: '2024-01-20 23:59'
                    },
                    {
                        id: 2,
                        title: '新功能上線',
                        type: '功能更新',
                        status: '已結束',
                        startTime: '2024-01-10 10:00',
                        endTime: '2024-01-14 18:00'
                    }
                ];

                const tbody = document.getElementById('announcementList');
                if (announcements.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #6b7280; padding: 40px;">暫無公告資料</td></tr>';
                    return;
                }

                tbody.innerHTML = announcements.map(announcement => `
                    <tr>
                        <td style="font-weight: 500;">${announcement.title}</td>
                        <td><span class="badge badge-info">${announcement.type}</span></td>
                        <td><span class="badge ${announcement.status === '進行中' ? 'status-active' : 'status-expired'}">${announcement.status}</span></td>
                        <td style="font-size: 14px;">${announcement.startTime}</td>
                        <td style="font-size: 14px;">${announcement.endTime}</td>
                        <td>
                            <button class="btn secondary" onclick="editAnnouncement(${announcement.id})">編輯</button>
                            <button class="btn danger" onclick="deleteAnnouncement(${announcement.id})">刪除</button>
                        </td>
                    </tr>
                `).join('');
            }

            // 模態窗口管理
            function openModal(modalId) {
                // 先關閉所有其他模態窗口
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('active');
                });

                document.getElementById(modalId).classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            function closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
                document.body.style.overflow = 'auto';

                // 清空表單
                const form = document.querySelector(`#${modalId} form`);
                if (form) form.reset();
            }

            // 點擊模態窗口背景關閉
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    const modalId = e.target.id;
                    if (modalId) {
                        closeModal(modalId);
                    }
                }
            });

            // ESC鍵關閉模態窗口
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    const activeModal = document.querySelector('.modal.active');
                    if (activeModal) {
                        closeModal(activeModal.id);
                    }
                }
            });

            // 公告管理
            let announcements = [
                {
                    id: 1,
                    title: '平台維護通知',
                    type: '系統公告',
                    content: '系統將於今晚進行維護，預計維護時間2小時。',
                    status: 'active',
                    startTime: '2024-01-15 00:00',
                    endTime: '2024-01-20 23:59',
                    createdAt: '2024-01-15 10:00'
                },
                {
                    id: 2,
                    title: '新功能上線',
                    type: '功能更新',
                    content: '新增了優惠券收藏功能，歡迎大家使用！',
                    status: 'expired',
                    startTime: '2024-01-10 10:00',
                    endTime: '2024-01-14 18:00',
                    createdAt: '2024-01-10 09:00'
                }
            ];

            function addAnnouncement() {
                document.getElementById('announcementModal').querySelector('.modal-title').textContent = '新增公告';
                openModal('announcementModal');
            }

            function editAnnouncement(id) {
                const announcement = announcements.find(a => a.id === id);
                if (announcement) {
                    document.getElementById('announcementModal').querySelector('.modal-title').textContent = '編輯公告';
                    document.getElementById('announcementTitle').value = announcement.title;
                    document.getElementById('announcementType').value = announcement.type;
                    document.getElementById('announcementContent').value = announcement.content;
                    document.getElementById('announcementStartTime').value = announcement.startTime.replace(' ', 'T');
                    document.getElementById('announcementEndTime').value = announcement.endTime.replace(' ', 'T');
                    document.getElementById('announcementStatus').value = announcement.status;

                    // 設置編輯模式標記
                    document.getElementById('announcementForm').dataset.editId = id;
                    openModal('announcementModal');
                }
            }

            function deleteAnnouncement(id) {
                if (confirm('確定要刪除這個公告嗎？')) {
                    announcements = announcements.filter(a => a.id !== id);
                    loadAnnouncements();
                    showNotification('公告刪除成功！', 'success');
                }
            }

            function saveAnnouncement() {
                const form = document.getElementById('announcementForm');
                const formData = new FormData(form);

                const title = document.getElementById('announcementTitle').value;
                const type = document.getElementById('announcementType').value;
                const content = document.getElementById('announcementContent').value;
                const startTime = document.getElementById('announcementStartTime').value.replace('T', ' ');
                const endTime = document.getElementById('announcementEndTime').value.replace('T', ' ');
                const status = document.getElementById('announcementStatus').value;

                if (!title || !type || !content || !startTime) {
                    alert('請填寫必填欄位！');
                    return;
                }

                const editId = form.dataset.editId;
                if (editId) {
                    // 編輯模式
                    const announcement = announcements.find(a => a.id == editId);
                    if (announcement) {
                        announcement.title = title;
                        announcement.type = type;
                        announcement.content = content;
                        announcement.startTime = startTime;
                        announcement.endTime = endTime;
                        announcement.status = status;
                    }
                    delete form.dataset.editId;
                    showNotification('公告更新成功！', 'success');
                } else {
                    // 新增模式
                    const newAnnouncement = {
                        id: Math.max(...announcements.map(a => a.id), 0) + 1,
                        title, type, content, status, startTime, endTime,
                        createdAt: new Date().toLocaleString('zh-TW', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        }).replace(/\//g, '-')
                    };
                    announcements.unshift(newAnnouncement);
                    showNotification('公告新增成功！', 'success');
                }

                loadAnnouncements();
                closeModal('announcementModal');
            }

            // 輪播圖管理
            let banners = [
                {
                    id: 1,
                    title: '歡迎使用送嗨康',
                    description: '發現更多優質優惠券',
                    image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDgwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI4MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRkNBMzExIi8+Cjx0ZXh0IHg9IjQwMCIgeT0iMTUwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCIgZmlsbD0id2hpdGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCI+5q2h6L+O5L2/55So6YCB5ZWo5bq3PC90ZXh0Pgo8L3N2Zz4K',
                    link: '#',
                    order: 1,
                    status: 'active'
                },
                {
                    id: 2,
                    title: '新年特惠活動',
                    description: '超值優惠券等你來領',
                    image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDgwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI4MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjZjU5ZTBiIi8+Cjx0ZXh0IHg9IjQwMCIgeT0iMTUwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCIgZmlsbD0id2hpdGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCI+5paw5bm055m55oOg5rS75YuVPC90ZXh0Pgo8L3N2Zz4K',
                    link: '#',
                    order: 2,
                    status: 'active'
                }
            ];

            function loadBanners() {
                const container = document.getElementById('bannerGrid');

                if (banners.length === 0) {
                    container.innerHTML = `
                        <div class="banner-placeholder">
                            <div class="banner-placeholder-content">
                                <span>📷</span>
                                <p>暫無輪播圖</p>
                                <button class="btn primary" onclick="addBanner()">上傳圖片</button>
                            </div>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = banners.map(banner => `
                    <div class="banner-item">
                        <img src="${banner.image}" alt="${banner.title}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDgwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI4MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjZTVlN2ViIi8+Cjx0ZXh0IHg9IjQwMCIgeT0iMTUwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCIgZmlsbD0iIzZiNzI4MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE4Ij7lnJvniYfovInlhaXlpLHmlZc8L3RleHQ+Cjwvc3ZnPgo='">
                        <div class="banner-item-info">
                            <h4 style="margin: 0 0 8px 0; font-size: 16px;">${banner.title}</h4>
                            <p style="margin: 0 0 8px 0; font-size: 14px; color: #6b7280;">${banner.description || '無描述'}</p>
                            <div style="display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: #6b7280;">
                                <span>順序: ${banner.order}</span>
                                <span class="badge ${banner.status === 'active' ? 'status-active' : 'status-inactive'}">${banner.status === 'active' ? '啟用' : '停用'}</span>
                            </div>
                            <div class="banner-item-actions">
                                <button class="btn secondary" onclick="editBanner(${banner.id})" style="flex: 1;">編輯</button>
                                <button class="btn danger" onclick="deleteBanner(${banner.id})" style="flex: 1;">刪除</button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            function addBanner() {
                document.getElementById('bannerModal').querySelector('.modal-title').textContent = '新增輪播圖';
                openModal('bannerModal');
            }

            function editBanner(id) {
                const banner = banners.find(b => b.id === id);
                if (banner) {
                    document.getElementById('bannerModal').querySelector('.modal-title').textContent = '編輯輪播圖';
                    document.getElementById('bannerTitle').value = banner.title;
                    document.getElementById('bannerDescription').value = banner.description || '';
                    document.getElementById('bannerLink').value = banner.link || '';
                    document.getElementById('bannerOrder').value = banner.order;
                    document.getElementById('bannerStatus').value = banner.status;

                    // 設置編輯模式標記
                    document.getElementById('bannerForm').dataset.editId = id;
                    openModal('bannerModal');
                }
            }

            function deleteBanner(id) {
                if (confirm('確定要刪除這個輪播圖嗎？')) {
                    banners = banners.filter(b => b.id !== id);
                    loadBanners();
                    showNotification('輪播圖刪除成功！', 'success');
                }
            }

            function saveBanner() {
                const form = document.getElementById('bannerForm');
                const title = document.getElementById('bannerTitle').value;
                const description = document.getElementById('bannerDescription').value;
                const imageFile = document.getElementById('bannerImage').files[0];
                const link = document.getElementById('bannerLink').value;
                const order = parseInt(document.getElementById('bannerOrder').value);
                const status = document.getElementById('bannerStatus').value;

                if (!title) {
                    alert('請填寫圖片標題！');
                    return;
                }

                const editId = form.dataset.editId;
                if (editId) {
                    // 編輯模式
                    const banner = banners.find(b => b.id == editId);
                    if (banner) {
                        banner.title = title;
                        banner.description = description;
                        banner.link = link;
                        banner.order = order;
                        banner.status = status;

                        // 如果有新圖片，更新圖片（實際應上傳到服務器）
                        if (imageFile) {
                            const reader = new FileReader();
                            reader.onload = function (e) {
                                banner.image = e.target.result;
                                loadBanners();
                            };
                            reader.readAsDataURL(imageFile);
                        }
                    }
                    delete form.dataset.editId;
                    showNotification('輪播圖更新成功！', 'success');
                } else {
                    // 新增模式
                    if (!imageFile) {
                        alert('請選擇圖片檔案！');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const newBanner = {
                            id: Math.max(...banners.map(b => b.id), 0) + 1,
                            title, description, link, order, status,
                            image: e.target.result
                        };
                        banners.unshift(newBanner);
                        loadBanners();
                        showNotification('輪播圖新增成功！', 'success');
                    };
                    reader.readAsDataURL(imageFile);
                }

                closeModal('bannerModal');
            }

            // FAQ管理
            let faqs = [
                {
                    id: 1,
                    category: 'general',
                    question: '如何註冊帳號？',
                    answer: '點擊首頁右上角的「註冊」按鈕，填寫基本資料即可完成註冊。',
                    order: 1,
                    status: 'active'
                },
                {
                    id: 2,
                    category: 'coupon',
                    question: '優惠券如何使用？',
                    answer: '在結帳頁面輸入優惠券代碼，系統會自動計算折扣金額。',
                    order: 2,
                    status: 'active'
                },
                {
                    id: 3,
                    category: 'account',
                    question: '忘記密碼怎麼辦？',
                    answer: '點擊登入頁面的「忘記密碼」連結，輸入註冊郵箱即可重設密碼。',
                    order: 3,
                    status: 'active'
                }
            ];

            function loadFAQs() {
                const container = document.getElementById('faqList');

                if (faqs.length === 0) {
                    container.innerHTML = `
                        <div class="faq-placeholder">
                            <span>❓</span>
                            <p>暫無常見問題</p>
                        </div>
                    `;
                    return;
                }

                const categoryLabels = {
                    'general': '一般問題',
                    'account': '帳戶相關',
                    'coupon': '優惠券使用',
                    'payment': '付款問題',
                    'technical': '技術支援'
                };

                container.innerHTML = faqs.map(faq => `
                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(${faq.id})">
                            <div>
                                <span class="badge badge-info" style="margin-right: 8px; font-size: 10px;">${categoryLabels[faq.category] || faq.category}</span>
                                ${faq.question}
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span class="badge ${faq.status === 'active' ? 'status-active' : 'status-inactive'}" style="font-size: 10px;">${faq.status === 'active' ? '啟用' : '停用'}</span>
                                <button class="btn secondary" onclick="event.stopPropagation(); editFAQ(${faq.id})" style="padding: 4px 8px; font-size: 12px;">編輯</button>
                                <button class="btn danger" onclick="event.stopPropagation(); deleteFAQ(${faq.id})" style="padding: 4px 8px; font-size: 12px;">刪除</button>
                                <span id="faq-toggle-${faq.id}">▼</span>
                            </div>
                        </div>
                        <div class="faq-answer" id="faq-answer-${faq.id}" style="display: none;">
                            ${faq.answer}
                        </div>
                    </div>
                `).join('');
            }

            function toggleFAQ(id) {
                const answer = document.getElementById(`faq-answer-${id}`);
                const toggle = document.getElementById(`faq-toggle-${id}`);

                if (answer.style.display === 'none') {
                    answer.style.display = 'block';
                    toggle.textContent = '▲';
                } else {
                    answer.style.display = 'none';
                    toggle.textContent = '▼';
                }
            }

            function addFAQ() {
                document.getElementById('faqModal').querySelector('.modal-title').textContent = '新增常見問題';
                openModal('faqModal');
            }

            function editFAQ(id) {
                const faq = faqs.find(f => f.id === id);
                if (faq) {
                    document.getElementById('faqModal').querySelector('.modal-title').textContent = '編輯常見問題';
                    document.getElementById('faqCategory').value = faq.category;
                    document.getElementById('faqQuestion').value = faq.question;
                    document.getElementById('faqAnswer').value = faq.answer;
                    document.getElementById('faqOrder').value = faq.order;
                    document.getElementById('faqStatus').value = faq.status;

                    // 設置編輯模式標記
                    document.getElementById('faqForm').dataset.editId = id;
                    openModal('faqModal');
                }
            }

            function deleteFAQ(id) {
                if (confirm('確定要刪除這個常見問題嗎？')) {
                    faqs = faqs.filter(f => f.id !== id);
                    loadFAQs();
                    showNotification('常見問題刪除成功！', 'success');
                }
            }

            function saveFAQ() {
                const form = document.getElementById('faqForm');
                const category = document.getElementById('faqCategory').value;
                const question = document.getElementById('faqQuestion').value;
                const answer = document.getElementById('faqAnswer').value;
                const order = parseInt(document.getElementById('faqOrder').value);
                const status = document.getElementById('faqStatus').value;

                if (!question || !answer) {
                    alert('請填寫問題內容和回答！');
                    return;
                }

                const editId = form.dataset.editId;
                if (editId) {
                    // 編輯模式
                    const faq = faqs.find(f => f.id == editId);
                    if (faq) {
                        faq.category = category;
                        faq.question = question;
                        faq.answer = answer;
                        faq.order = order;
                        faq.status = status;
                    }
                    delete form.dataset.editId;
                    showNotification('常見問題更新成功！', 'success');
                } else {
                    // 新增模式
                    const newFAQ = {
                        id: Math.max(...faqs.map(f => f.id), 0) + 1,
                        category, question, answer, order, status
                    };
                    faqs.unshift(newFAQ);
                    showNotification('常見問題新增成功！', 'success');
                }

                loadFAQs();
                closeModal('faqModal');
            }

            // 通知功能
            function showNotification(message, type = 'info') {
                // 簡單的通知實現
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    z-index: 10000;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                `;
                notification.textContent = message;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }

            // 幫助文檔
            function addHelpDoc() {
                alert('新增幫助文檔功能開發中...');
            }

            function editHelpDoc(type) {
                alert(`編輯${type}功能開發中...`);
            }

            function previewHelpDoc(type) {
                alert(`預覽${type}功能開發中...`);
            }

            // 安全管理功能
            // 安全管理功能
            function loadSecurityManagement() {
                console.log('載入安全管理');
                loadSecurityStats();
                loadLoginLogs();
                loadIPWhitelist();
                loadSecuritySettings();
            }

            // 載入安全統計
            function loadSecurityStats() {
                // 更新安全統計數據
                const stats = {
                    todayLogins: Math.floor(Math.random() * 200) + 50,
                    failedAttempts: Math.floor(Math.random() * 20) + 5,
                    blockedIPs: Math.floor(Math.random() * 10) + 2,
                    activeUsers: Math.floor(Math.random() * 100) + 30
                };

                // 更新統計卡片
                const statCards = document.querySelectorAll('.security-stat-number');
                if (statCards.length >= 4) {
                    statCards[0].textContent = stats.todayLogins;
                    statCards[1].textContent = stats.failedAttempts;
                    statCards[2].textContent = stats.blockedIPs;
                    statCards[3].textContent = stats.activeUsers;
                }
            }

            // 登入日誌管理
            let loginLogs = [
                {
                    id: 1,
                    time: new Date().toLocaleString('zh-TW'),
                    user: 'admin',
                    role: '管理員',
                    ip: '192.168.1.100',
                    location: '台北市',
                    device: 'Chrome 120.0 / Windows 10',
                    status: 'success',
                    riskLevel: 'low'
                },
                {
                    id: 2,
                    time: new Date(Date.now() - 300000).toLocaleString('zh-TW'),
                    user: 'vendor01',
                    role: '廠商',
                    ip: '203.74.123.45',
                    location: '台中市',
                    device: 'Safari 17.0 / macOS',
                    status: 'success',
                    riskLevel: 'low'
                },
                {
                    id: 3,
                    time: new Date(Date.now() - 600000).toLocaleString('zh-TW'),
                    user: 'unknown',
                    role: '未知',
                    ip: '45.123.45.67',
                    location: '未知地區',
                    device: 'Firefox 118.0 / Linux',
                    status: 'failed',
                    riskLevel: 'high'
                },
                {
                    id: 4,
                    time: new Date(Date.now() - 900000).toLocaleString('zh-TW'),
                    user: 'customer01',
                    role: '會員',
                    ip: '114.32.168.92',
                    location: '高雄市',
                    device: 'Chrome 120.0 / Android',
                    status: 'success',
                    riskLevel: 'low'
                },
                {
                    id: 5,
                    time: new Date(Date.now() - 1200000).toLocaleString('zh-TW'),
                    user: 'hacker_attempt',
                    role: '未知',
                    ip: '185.220.101.45',
                    location: '國外',
                    device: 'Unknown / Unknown',
                    status: 'blocked',
                    riskLevel: 'critical'
                }
            ];

            function loadLoginLogs() {
                const tbody = document.getElementById('loginLogsList');
                if (!tbody) return;

                tbody.innerHTML = loginLogs.map(log => `
                    <tr class="${log.riskLevel === 'critical' ? 'risk-critical' : log.riskLevel === 'high' ? 'risk-high' : ''}">
                        <td style="font-size: 12px; color: #6b7280;">${log.time}</td>
                        <td>
                            <div style="display: flex; flex-direction: column; gap: 2px;">
                                <span style="font-weight: 500; font-size: 14px;">${log.user}</span>
                                <span class="badge role-${log.role === '管理員' ? 'admin' : log.role === '廠商' ? 'vendor' : 'customer'}" style="font-size: 10px; width: fit-content;">
                                    ${log.role}
                                </span>
                            </div>
                        </td>
                        <td style="font-family: monospace; font-size: 12px;">${log.ip}</td>
                        <td style="font-size: 12px;">${log.location}</td>
                        <td style="font-size: 11px; color: #6b7280; max-width: 150px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${log.device}</td>
                        <td>
                            <span class="badge ${log.status === 'success' ? 'status-active' : log.status === 'failed' ? 'status-rejected' : 'status-expired'}">
                                ${log.status === 'success' ? '✅ 成功' : log.status === 'failed' ? '❌ 失敗' : '🚫 封鎖'}
                            </span>
                        </td>
                        <td>
                            <div style="display: flex; gap: 4px;">
                                <button class="btn secondary" onclick="viewLogDetail(${log.id})" style="padding: 4px 8px; font-size: 11px;">詳情</button>
                                ${log.status === 'failed' && log.riskLevel !== 'low' ?
                        `<button class="btn danger" onclick="blockIP('${log.ip}')" style="padding: 4px 8px; font-size: 11px;">封鎖</button>` :
                        ''}
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            function exportLoginLogs() {
                // 模擬匯出CSV
                const csvContent = [
                    ['時間', '用戶', '角色', 'IP地址', '位置', '設備', '狀態', '風險等級'],
                    ...loginLogs.map(log => [
                        log.time,
                        log.user,
                        log.role,
                        log.ip,
                        log.location,
                        log.device,
                        log.status,
                        log.riskLevel
                    ])
                ].map(row => row.join(',')).join('\n');

                const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `登入日誌_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                showNotification('登入日誌匯出成功！', 'success');
            }

            function clearOldLogs() {
                if (confirm('確定要清理30天前的舊日誌嗎？此操作無法復原。')) {
                    // 模擬清理操作
                    const oldCount = loginLogs.length;
                    // 這裡應該調用API清理真實數據
                    showNotification(`已清理 ${Math.floor(oldCount * 0.3)} 條舊日誌記錄`, 'success');
                }
            }

            function viewLogDetail(logId) {
                const log = loginLogs.find(l => l.id === logId);
                if (!log) return;

                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 600px;">
                        <div class="modal-header">
                            <h3 class="modal-title">登入日誌詳情</h3>
                            <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
                        </div>
                        <div style="padding: 20px;">
                            <div style="display: grid; grid-template-columns: 120px 1fr; gap: 12px; font-size: 14px;">
                                <strong>登入時間:</strong><span>${log.time}</span>
                                <strong>用戶名稱:</strong><span>${log.user}</span>
                                <strong>用戶角色:</strong><span class="badge role-${log.role === '管理員' ? 'admin' : log.role === '廠商' ? 'vendor' : 'customer'}">${log.role}</span>
                                <strong>IP地址:</strong><span style="font-family: monospace;">${log.ip}</span>
                                <strong>地理位置:</strong><span>${log.location}</span>
                                <strong>設備資訊:</strong><span>${log.device}</span>
                                <strong>登入狀態:</strong><span class="badge ${log.status === 'success' ? 'status-active' : log.status === 'failed' ? 'status-rejected' : 'status-expired'}">${log.status === 'success' ? '成功' : log.status === 'failed' ? '失敗' : '封鎖'}</span>
                                <strong>風險等級:</strong><span class="badge ${log.riskLevel === 'critical' ? 'status-rejected' : log.riskLevel === 'high' ? 'status-pending' : 'status-active'}">${log.riskLevel === 'critical' ? '極高風險' : log.riskLevel === 'high' ? '高風險' : '低風險'}</span>
                            </div>
                            ${log.riskLevel !== 'low' ? `
                                <div style="margin-top: 20px; padding: 12px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 6px;">
                                    <strong style="color: #92400e;">⚠️ 安全提醒:</strong>
                                    <p style="margin: 4px 0 0 0; color: #92400e; font-size: 13px;">
                                        此次登入被標記為${log.riskLevel === 'critical' ? '極高' : '高'}風險，建議進一步檢查。
                                    </p>
                                </div>
                            ` : ''}
                        </div>
                        <div class="modal-footer">
                            ${log.status === 'failed' ? `<button class="btn danger" onclick="blockIP('${log.ip}'); this.closest('.modal').remove();">封鎖此IP</button>` : ''}
                            <button class="btn secondary" onclick="this.closest('.modal').remove()">關閉</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            // IP白名單管理
            let ipWhitelist = [
                { id: 1, ip: '192.168.1.0/24', description: '內網IP段', status: 'active', createdAt: '2024-01-10' },
                { id: 2, ip: '203.74.123.45', description: '辦公室固定IP', status: 'active', createdAt: '2024-01-12' },
                { id: 3, ip: '114.32.0.0/16', description: '合作夥伴IP段', status: 'active', createdAt: '2024-01-13' }
            ];

            function loadIPWhitelist() {
                const container = document.getElementById('ipWhitelistContainer');
                if (!container) return;

                if (ipWhitelist.length === 0) {
                    container.innerHTML = '<div style="text-align: center; padding: 40px; color: #6b7280;">暫無IP白名單</div>';
                    return;
                }

                container.innerHTML = ipWhitelist.map(item => `
                    <div class="ip-whitelist-item" style="display: flex; justify-content: space-between; align-items: center; padding: 16px; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 12px;">
                        <div>
                            <div style="font-weight: 500; font-family: monospace; font-size: 16px; color: #111827;">${item.ip}</div>
                            <div style="font-size: 14px; color: #6b7280; margin-top: 4px;">${item.description}</div>
                            <div style="font-size: 12px; color: #9ca3af; margin-top: 4px;">新增時間: ${item.createdAt}</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span class="badge ${item.status === 'active' ? 'status-active' : 'status-inactive'}">${item.status === 'active' ? '啟用' : '停用'}</span>
                            <button class="btn secondary" onclick="editIPWhitelist(${item.id})" style="padding: 6px 12px; font-size: 12px;">編輯</button>
                            <button class="btn danger" onclick="deleteIPWhitelist(${item.id})" style="padding: 6px 12px; font-size: 12px;">刪除</button>
                        </div>
                    </div>
                `).join('');
            }

            function addIPWhitelist() {
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title">新增IP白名單</h3>
                            <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
                        </div>
                        <form id="ipWhitelistForm">
                            <div class="form-group">
                                <label class="form-label">IP地址或IP段 *</label>
                                <input type="text" class="form-input" id="ipAddress" placeholder="例如: 192.168.1.100 或 192.168.1.0/24" required>
                                <small style="color: #6b7280; font-size: 12px;">支援單一IP或CIDR格式的IP段</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">描述</label>
                                <input type="text" class="form-input" id="ipDescription" placeholder="例如: 辦公室固定IP">
                            </div>
                            <div class="form-group">
                                <label class="form-label">狀態</label>
                                <select class="form-select" id="ipStatus">
                                    <option value="active" selected>啟用</option>
                                    <option value="inactive">停用</option>
                                </select>
                            </div>
                        </form>
                        <div class="modal-footer">
                            <button type="button" class="btn secondary" onclick="this.closest('.modal').remove()">取消</button>
                            <button type="button" class="btn primary" onclick="saveIPWhitelist()">保存</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            function saveIPWhitelist() {
                const ip = document.getElementById('ipAddress').value;
                const description = document.getElementById('ipDescription').value;
                const status = document.getElementById('ipStatus').value;

                if (!ip) {
                    alert('請輸入IP地址！');
                    return;
                }

                // 簡單的IP格式驗證
                const ipPattern = /^(\d{1,3}\.){3}\d{1,3}(\/\d{1,2})?$/;
                if (!ipPattern.test(ip)) {
                    alert('IP地址格式不正確！');
                    return;
                }

                const newItem = {
                    id: Math.max(...ipWhitelist.map(item => item.id), 0) + 1,
                    ip,
                    description: description || '無描述',
                    status,
                    createdAt: new Date().toISOString().split('T')[0]
                };

                ipWhitelist.unshift(newItem);
                loadIPWhitelist();
                showNotification('IP白名單新增成功！', 'success');

                // 關閉模態窗口
                document.querySelector('.modal.active').remove();
            }

            function editIPWhitelist(id) {
                const item = ipWhitelist.find(i => i.id === id);
                if (!item) return;

                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title">編輯IP白名單</h3>
                            <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
                        </div>
                        <form id="editIPForm">
                            <div class="form-group">
                                <label class="form-label">IP地址或IP段 *</label>
                                <input type="text" class="form-input" id="editIPAddress" value="${item.ip}" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">描述</label>
                                <input type="text" class="form-input" id="editIPDescription" value="${item.description}">
                            </div>
                            <div class="form-group">
                                <label class="form-label">狀態</label>
                                <select class="form-select" id="editIPStatus">
                                    <option value="active" ${item.status === 'active' ? 'selected' : ''}>啟用</option>
                                    <option value="inactive" ${item.status === 'inactive' ? 'selected' : ''}>停用</option>
                                </select>
                            </div>
                        </form>
                        <div class="modal-footer">
                            <button type="button" class="btn secondary" onclick="this.closest('.modal').remove()">取消</button>
                            <button type="button" class="btn primary" onclick="updateIPWhitelist(${id})">更新</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            function updateIPWhitelist(id) {
                const ip = document.getElementById('editIPAddress').value;
                const description = document.getElementById('editIPDescription').value;
                const status = document.getElementById('editIPStatus').value;

                if (!ip) {
                    alert('請輸入IP地址！');
                    return;
                }

                const item = ipWhitelist.find(i => i.id === id);
                if (item) {
                    item.ip = ip;
                    item.description = description || '無描述';
                    item.status = status;

                    loadIPWhitelist();
                    showNotification('IP白名單更新成功！', 'success');

                    // 關閉模態窗口
                    document.querySelector('.modal.active').remove();
                }
            }

            function deleteIPWhitelist(id) {
                if (confirm('確定要刪除此IP白名單項目嗎？')) {
                    ipWhitelist = ipWhitelist.filter(item => item.id !== id);
                    loadIPWhitelist();
                    showNotification('IP白名單項目刪除成功！', 'success');
                }
            }

            function blockIP(ip) {
                if (confirm(`確定要封鎖IP地址 ${ip} 嗎？`)) {
                    // 這裡應該調用API封鎖IP
                    showNotification(`IP地址 ${ip} 已被封鎖`, 'success');

                    // 更新登入日誌中的狀態
                    const log = loginLogs.find(l => l.ip === ip);
                    if (log) {
                        log.status = 'blocked';
                        loadLoginLogs();
                    }
                }
            }

            // 安全設定
            function loadSecuritySettings() {
                console.log('載入安全設定');
            }

            function toggleTwoFactorAuth() {
                const checkbox = document.getElementById('twoFactorEnabled');
                if (checkbox.checked) {
                    showNotification('雙重認證已啟用', 'success');
                } else {
                    showNotification('雙重認證已停用', 'info');
                }
            }

            function updateSessionTimeout() {
                const timeout = document.getElementById('sessionTimeout').value;
                showNotification(`會話超時時間已設定為 ${timeout} 分鐘`, 'success');
            }

            function updatePasswordPolicy() {
                showNotification('密碼政策已更新', 'success');
            }

            function editIPRule(ip) {
                alert(`編輯IP規則 ${ip} 功能開發中...`);
            }

            function deleteIPRule(ip) {
                if (confirm(`確定要刪除IP規則 ${ip} 嗎？`)) {
                    alert(`刪除IP規則 ${ip} 功能開發中...`);
                }
            }

            // 通知管理功能
            function loadNotifications() {
                console.log('載入通知管理');
                loadNotificationStats();
                loadRecentNotifications();
            }

            // 載入通知統計
            function loadNotificationStats() {
                const stats = {
                    todayNotifications: Math.floor(Math.random() * 50) + 20,
                    pendingNotifications: Math.floor(Math.random() * 200) + 100,
                    deliveryRate: (Math.random() * 10 + 85).toFixed(1)
                };

                // 更新統計數據
                const statCards = document.querySelectorAll('.notification-stat-number');
                if (statCards.length >= 3) {
                    statCards[0].textContent = stats.todayNotifications;
                    statCards[1].textContent = stats.pendingNotifications;
                    statCards[2].textContent = stats.deliveryRate + '%';
                }
            }

            // 載入最近通知
            function loadRecentNotifications() {
                const container = document.querySelector('.recent-notifications');
                if (!container) return;

                const notifications = [
                    { icon: '🎫', title: '新優惠券待審核', time: '2 分鐘前', status: '已送達' },
                    { icon: '👤', title: '新用戶註冊', time: '5 分鐘前', status: '已送達' },
                    { icon: '🏪', title: '廠商申請審核', time: '10 分鐘前', status: '處理中' },
                    { icon: '⚠️', title: '系統異常警報', time: '15 分鐘前', status: '失敗' }
                ];

                const notificationsList = notifications.map(notification => `
                    <div class="notification-item" style="display: flex; align-items: center; padding: 12px; border-bottom: 1px solid #f3f4f6;">
                        <div class="notification-icon" style="font-size: 24px; margin-right: 12px;">${notification.icon}</div>
                        <div class="notification-content" style="flex: 1;">
                            <div class="notification-title" style="font-weight: 500;">${notification.title}</div>
                            <div class="notification-time" style="font-size: 12px; color: #6b7280;">${notification.time}</div>
                        </div>
                        <div class="notification-status">
                            <span class="badge ${notification.status === '已送達' ? 'status-active' : notification.status === '處理中' ? 'status-pending' : 'status-rejected'}">
                                ${notification.status}
                            </span>
                        </div>
                    </div>
                `).join('');

                container.innerHTML = `
                    <h4 style="margin-bottom: 16px;">最近通知</h4>
                    ${notificationsList}
                `;
            }

            function sendBroadcast() {
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 600px;">
                        <div class="modal-header">
                            <h3 class="modal-title">📢 發送廣播通知</h3>
                            <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
                        </div>
                        <form id="broadcastForm">
                            <div class="form-group">
                                <label class="form-label">通知標題 *</label>
                                <input type="text" class="form-input" id="notificationTitle" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">通知內容 *</label>
                                <textarea class="form-textarea" id="notificationContent" required style="min-height: 120px;"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">接收對象</label>
                                <select class="form-select" id="targetAudience">
                                    <option value="all">所有用戶</option>
                                    <option value="customers">一般會員</option>
                                    <option value="vendors">廠商用戶</option>
                                    <option value="admins">管理員</option>
                                </select>
                            </div>
                        </form>
                        <div class="modal-footer">
                            <button type="button" class="btn secondary" onclick="this.closest('.modal').remove()">取消</button>
                            <button type="button" class="btn primary" onclick="sendBroadcastNotification()">發送通知</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            function sendBroadcastNotification() {
                const title = document.getElementById('notificationTitle').value;
                const content = document.getElementById('notificationContent').value;
                const audience = document.getElementById('targetAudience').value;

                if (!title || !content) {
                    alert('請填寫標題和內容！');
                    return;
                }

                if (confirm(`確認發送廣播通知給${audience === 'all' ? '所有用戶' : audience === 'customers' ? '一般會員' : audience === 'vendors' ? '廠商用戶' : '管理員'}？`)) {
                    showNotification('廣播通知發送成功！', 'success');
                    document.querySelector('.modal.active').remove();
                    loadRecentNotifications();
                    loadNotificationStats();
                }
            }

            function createEmailTemplate() {
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 700px;">
                        <div class="modal-header">
                            <h3 class="modal-title">新增郵件模板</h3>
                            <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
                        </div>
                        <form id="emailTemplateForm">
                            <div class="form-group">
                                <label class="form-label">模板名稱 *</label>
                                <input type="text" class="form-input" id="templateName" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">郵件主旨 *</label>
                                <input type="text" class="form-input" id="templateSubject" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">郵件內容 *</label>
                                <textarea class="form-textarea" id="templateContent" required style="min-height: 200px;"></textarea>
                            </div>
                        </form>
                        <div class="modal-footer">
                            <button type="button" class="btn secondary" onclick="this.closest('.modal').remove()">取消</button>
                            <button type="button" class="btn primary" onclick="saveEmailTemplate()">保存模板</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            function saveEmailTemplate() {
                const name = document.getElementById('templateName').value;
                const subject = document.getElementById('templateSubject').value;
                const content = document.getElementById('templateContent').value;

                if (!name || !subject || !content) {
                    alert('請填寫所有欄位！');
                    return;
                }

                showNotification('郵件模板新增成功！', 'success');
                document.querySelector('.modal.active').remove();
            }

            function editEmailTemplate(type) {
                const templates = {
                    'welcome': { name: '歡迎郵件', subject: '歡迎加入送嗨康！', content: '親愛的用戶，歡迎加入我們的平台...' },
                    'password-reset': { name: '密碼重置', subject: '密碼重置確認', content: '請點擊連結重置您的密碼...' },
                    'coupon-notify': { name: '優惠券通知', subject: '新優惠券上線了！', content: '我們為您推薦新的優惠券...' }
                };

                const template = templates[type];
                if (!template) return;

                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 700px;">
                        <div class="modal-header">
                            <h3 class="modal-title">編輯 ${template.name}</h3>
                            <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
                        </div>
                        <form>
                            <div class="form-group">
                                <label class="form-label">郵件主旨</label>
                                <input type="text" class="form-input" value="${template.subject}">
                            </div>
                            <div class="form-group">
                                <label class="form-label">郵件內容</label>
                                <textarea class="form-textarea" style="min-height: 200px;">${template.content}</textarea>
                            </div>
                        </form>
                        <div class="modal-footer">
                            <button type="button" class="btn secondary" onclick="previewEmailModal('${type}')">預覽</button>
                            <button type="button" class="btn secondary" onclick="this.closest('.modal').remove()">取消</button>
                            <button type="button" class="btn primary" onclick="updateEmailTemplate('${type}')">更新</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            function updateEmailTemplate(type) {
                showNotification('郵件模板更新成功！', 'success');
                document.querySelector('.modal.active').remove();
            }

            function previewEmail(type) {
                const templates = {
                    'welcome': '歡迎加入送嗨康！感謝您的註冊...',
                    'password-reset': '請點擊以下連結重置您的密碼...',
                    'coupon-notify': '新優惠券上線了！快來看看吧...'
                };

                alert(`預覽 ${type} 郵件模板：\n\n${templates[type]}`);
            }

            function previewEmailModal(type) {
                const templates = {
                    'welcome': { subject: '歡迎加入送嗨康！', content: '親愛的用戶，<br>歡迎加入我們的平台！<br>您現在可以開始探索各種優惠券了。' },
                    'password-reset': { subject: '密碼重置確認', content: '親愛的用戶，<br>請點擊以下連結重置您的密碼：<br><a href="#">重置密碼</a>' },
                    'coupon-notify': { subject: '新優惠券上線了！', content: '親愛的用戶，<br>我們為您推薦新的優惠券：<br>美食餐廳85折優惠' }
                };

                const template = templates[type];
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 600px;">
                        <div class="modal-header">
                            <h3 class="modal-title">郵件預覽</h3>
                            <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
                        </div>
                        <div style="padding: 20px;">
                            <div style="margin-bottom: 16px; padding: 12px; background: #f9fafb; border-radius: 6px;">
                                <strong>主旨：</strong>${template.subject}
                            </div>
                            <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px; background: white;">
                                ${template.content}
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn secondary" onclick="this.closest('.modal').remove()">關閉</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            // 外觀設定功能
            let currentTheme = 'default';
            let logoFile = null;
            let websiteSettings = {
                siteName: '送嗨康',
                siteDescription: '最優質的優惠券平台',
                siteKeywords: '優惠券,折扣,促銷,購物',
                contactEmail: 'contact@example.com',
                socialMedia: {
                    facebook: '',
                    instagram: '',
                    twitter: '',
                    youtube: ''
                },
                seo: {
                    googleAnalytics: '',
                    facebookPixel: '',
                    metaTitle: '送嗨康 - 最優質的優惠券平台',
                    metaDescription: '發現最新、最優質的優惠券，讓您的購物更划算！'
                }
            };

            function loadAppearanceSettings() {
                console.log('載入外觀設定');
                updateColorInputs();
                loadWebsiteSettings();
                loadThemeSettings();
                // 載入全站 Logo
                (async () => {
                    try {
                        const res = await fetch('../api/settings?keys=site_logo', { headers: getAuthHeaders() });
                        const data = await res.json();
                        if (data.success && data.data && data.data.site_logo) {
                            const url = data.data.site_logo;
                            const img = document.getElementById('logoPreview');
                            if (img && url) { img.src = url.startsWith('http') ? url : ('..' + (url.startsWith('/') ? '' : '/') + url); }
                        }
                    } catch (e) { /* 忽略失敗 */ }
                })();
            }

            // 主題管理
            const themes = {
                'default': {
                    name: '預設主題',
                    primaryColor: '#FCA311',
                    secondaryColor: '#14213D',
                    backgroundColor: '#F8F7F6',
                    textColor: '#333333',
                    description: '經典的橙色主題，溫暖友好'
                },
                'blue': {
                    name: '藍色主題',
                    primaryColor: '#3B82F6',
                    secondaryColor: '#1E40AF',
                    backgroundColor: '#F8FAFC',
                    textColor: '#1F2937',
                    description: '專業的藍色主題，商務感十足'
                },
                'green': {
                    name: '綠色主題',
                    primaryColor: '#10B981',
                    secondaryColor: '#059669',
                    backgroundColor: '#F0FDF4',
                    textColor: '#1F2937',
                    description: '清新的綠色主題，自然舒適'
                },
                'purple': {
                    name: '紫色主題',
                    primaryColor: '#8B5CF6',
                    secondaryColor: '#7C3AED',
                    backgroundColor: '#FAF5FF',
                    textColor: '#1F2937',
                    description: '優雅的紫色主題，時尚現代'
                }
            };

            function loadThemeSettings() {
                // 確保預設主題被選中
                const defaultThemeOption = document.querySelector('.theme-option[onclick*="default"]');
                if (defaultThemeOption && !document.querySelector('.theme-option.active')) {
                    defaultThemeOption.classList.add('active');
                }
            }

            function selectTheme(theme) {
                // 移除所有主題的active類
                document.querySelectorAll('.theme-option').forEach(option => {
                    option.classList.remove('active');
                });

                // 添加選中主題的active類
                event.target.closest('.theme-option').classList.add('active');

                currentTheme = theme;
                const themeData = themes[theme];

                if (themeData) {
                    // 更新顏色輸入框
                    document.getElementById('primaryColor').value = themeData.primaryColor;
                    document.getElementById('secondaryColor').value = themeData.secondaryColor;
                    document.getElementById('backgroundColor').value = themeData.backgroundColor;
                    document.getElementById('textColor').value = themeData.textColor;

                    // 更新對應的文字輸入框
                    document.getElementById('primaryColor').nextElementSibling.value = themeData.primaryColor;
                    document.getElementById('secondaryColor').nextElementSibling.value = themeData.secondaryColor;
                    document.getElementById('backgroundColor').nextElementSibling.value = themeData.backgroundColor;
                    document.getElementById('textColor').nextElementSibling.value = themeData.textColor;

                    // 更新預覽
                    updateColorPreview();

                    showNotification(`已選擇 ${themeData.name}`, 'success');
                }
            }

            // Logo管理
            function uploadLogo(input) {
                if (input.files && input.files[0]) {
                    const file = input.files[0];

                    // 檢查檔案類型
                    if (!file.type.startsWith('image/')) {
                        alert('請選擇圖片檔案！');
                        return;
                    }

                    // 檢查檔案大小 (2MB)
                    if (file.size > 2 * 1024 * 1024) {
                        alert('檔案大小不能超過 2MB！');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function (e) {
                        document.getElementById('logoPreview').src = e.target.result;
                        logoFile = file;
                        showNotification('Logo預覽已更新，請點擊"保存Logo"以套用', 'info');
                    };
                    reader.readAsDataURL(file);
                }
            }

            async function saveLogo() {
                if (!logoFile) { alert('請先選擇Logo檔案！'); return; }
                const tip = document.createElement('div');
                tip.style.cssText = 'position:fixed;top:20px;right:20px;background:#fff;padding:12px 16px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.15);z-index:10000';
                tip.innerHTML = '<div style="display:flex;align-items:center;gap:10px;"><div class="loading" style="width:20px;height:20px;"></div><span>正在上傳 Logo...</span></div>';
                document.body.appendChild(tip);
                try {
                    // 1) 上傳圖片
                    const form = new FormData();
                    form.append('file', logoFile);
                    form.append('type', 'logo');
                    const upRes = await fetch('../api/upload/image', { method: 'POST', headers: { 'Authorization': `Bearer ${getAuthToken()}` }, body: form });
                    const upJson = await upRes.json();
                    if (!upJson.success) { alert(upJson.message || '上傳失敗'); return; }
                    const url = upJson.data?.url;

                    // 2) 寫入系統設定 site_logo
                    const setRes = await fetch('../api/settings', { method: 'PUT', headers: getAuthHeaders(), body: JSON.stringify({ site_logo: url }) });
                    const setJson = await setRes.json();
                    if (!setJson.success) { alert(setJson.message || '保存設定失敗'); return; }

                    showNotification('Logo 已上傳並儲存為全站 Logo', 'success');
                    logoFile = null;
                } catch (e) {
                    alert('上傳或保存失敗：' + e.message);
                } finally { tip.remove(); }
            }

            function resetLogo() {
                if (confirm('確定要重置Logo為預設嗎？')) {
                    document.getElementById('logoPreview').src = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiByeD0iMTAiIGZpbGw9IiNGQ0EzMTEiLz4KPHRleHQgeD0iNTAiIHk9IjU1IiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMzAiIGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+U0g8L3RleHQ+Cjwvc3ZnPg==";
                    logoFile = null;
                    showNotification('Logo已重置為預設', 'success');
                }
            }

            // 色彩方案管理
            function updateColorInputs() {
                // 同步顏色選擇器和文字輸入框
                const colorInputs = document.querySelectorAll('input[type="color"]');
                colorInputs.forEach(input => {
                    const textInput = input.nextElementSibling;
                    if (textInput && textInput.type === 'text') {
                        input.addEventListener('change', function () {
                            textInput.value = this.value.toUpperCase();
                            updateColorPreview();
                        });

                        textInput.addEventListener('input', function () {
                            if (/^#[0-9A-F]{6}$/i.test(this.value)) {
                                input.value = this.value;
                                updateColorPreview();
                            }
                        });
                    }
                });

                // 初始化預覽
                setTimeout(updateColorPreview, 100);
            }

            function updateColorPreview() {
                const primaryColor = document.getElementById('primaryColor').value;
                const secondaryColor = document.getElementById('secondaryColor').value;
                const backgroundColor = document.getElementById('backgroundColor').value;
                const textColor = document.getElementById('textColor').value;

                const previewHeader = document.querySelector('.preview-header');
                const previewContent = document.querySelector('.preview-content');
                const previewText = document.querySelector('.preview-content p');
                const previewButton = document.querySelector('.preview-content button');

                if (previewHeader) previewHeader.style.background = primaryColor;
                if (previewContent) previewContent.style.background = backgroundColor;
                if (previewText) previewText.style.color = textColor;
                if (previewButton) {
                    previewButton.style.background = secondaryColor;
                    previewButton.style.color = 'white';
                }
            }

            function applyColorScheme() {
                const primaryColor = document.getElementById('primaryColor').value;
                const secondaryColor = document.getElementById('secondaryColor').value;
                const backgroundColor = document.getElementById('backgroundColor').value;
                const textColor = document.getElementById('textColor').value;

                if (confirm('確定要套用新的色彩方案嗎？這將影響整個網站的外觀。')) {
                    // 模擬套用過程
                    const applyProgress = document.createElement('div');
                    applyProgress.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: white;
                        padding: 24px;
                        border-radius: 12px;
                        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                        z-index: 10000;
                        text-align: center;
                    `;
                    applyProgress.innerHTML = `
                        <div class="loading" style="margin: 0 auto 16px;"></div>
                        <div>正在套用色彩方案...</div>
                        <div style="font-size: 12px; color: #6b7280; margin-top: 8px;">請稍候</div>
                    `;
                    document.body.appendChild(applyProgress);

                    setTimeout(() => {
                        applyProgress.remove();
                        showNotification('色彩方案套用成功！', 'success');

                        // 實際應用中，這裡會調用API保存設定
                        console.log('套用色彩方案:', {
                            primary: primaryColor,
                            secondary: secondaryColor,
                            background: backgroundColor,
                            text: textColor
                        });
                    }, 2000);
                }
            }

            function resetColorScheme() {
                if (confirm('確定要重置色彩方案為預設值嗎？')) {
                    const defaultTheme = themes['default'];
                    document.getElementById('primaryColor').value = defaultTheme.primaryColor;
                    document.getElementById('secondaryColor').value = defaultTheme.secondaryColor;
                    document.getElementById('backgroundColor').value = defaultTheme.backgroundColor;
                    document.getElementById('textColor').value = defaultTheme.textColor;

                    // 更新文字輸入框
                    document.getElementById('primaryColor').nextElementSibling.value = defaultTheme.primaryColor;
                    document.getElementById('secondaryColor').nextElementSibling.value = defaultTheme.secondaryColor;
                    document.getElementById('backgroundColor').nextElementSibling.value = defaultTheme.backgroundColor;
                    document.getElementById('textColor').nextElementSibling.value = defaultTheme.textColor;

                    updateColorPreview();
                    showNotification('色彩方案已重置為預設值', 'success');
                }
            }

            // 網站設定管理
            function loadWebsiteSettings() {
                // 載入現有設定到表單中
                const settingElements = {
                    'siteName': document.getElementById('siteName'),
                    'siteDescription': document.getElementById('siteDescription'),
                    'siteKeywords': document.getElementById('siteKeywords'),
                    'contactEmail': document.getElementById('contactEmail'),
                    'facebookUrl': document.getElementById('facebookUrl'),
                    'instagramUrl': document.getElementById('instagramUrl'),
                    'twitterUrl': document.getElementById('twitterUrl'),
                    'youtubeUrl': document.getElementById('youtubeUrl'),
                    'googleAnalytics': document.getElementById('googleAnalytics'),
                    'facebookPixel': document.getElementById('facebookPixel'),
                    'metaTitle': document.getElementById('metaTitle'),
                    'metaDescription': document.getElementById('metaDescription')
                };

                // 設定預設值
                if (settingElements.siteName) settingElements.siteName.value = websiteSettings.siteName;
                if (settingElements.siteDescription) settingElements.siteDescription.value = websiteSettings.siteDescription;
                if (settingElements.siteKeywords) settingElements.siteKeywords.value = websiteSettings.siteKeywords;
                if (settingElements.contactEmail) settingElements.contactEmail.value = websiteSettings.contactEmail;
                if (settingElements.metaTitle) settingElements.metaTitle.value = websiteSettings.seo.metaTitle;
                if (settingElements.metaDescription) settingElements.metaDescription.value = websiteSettings.seo.metaDescription;
            }

            function saveWebsiteSettings() {
                const formData = {
                    siteName: document.getElementById('siteName')?.value || '',
                    siteDescription: document.getElementById('siteDescription')?.value || '',
                    siteKeywords: document.getElementById('siteKeywords')?.value || '',
                    contactEmail: document.getElementById('contactEmail')?.value || '',
                    socialMedia: {
                        facebook: document.getElementById('facebookUrl')?.value || '',
                        instagram: document.getElementById('instagramUrl')?.value || '',
                        twitter: document.getElementById('twitterUrl')?.value || '',
                        youtube: document.getElementById('youtubeUrl')?.value || ''
                    },
                    seo: {
                        googleAnalytics: document.getElementById('googleAnalytics')?.value || '',
                        facebookPixel: document.getElementById('facebookPixel')?.value || '',
                        metaTitle: document.getElementById('metaTitle')?.value || '',
                        metaDescription: document.getElementById('metaDescription')?.value || ''
                    }
                };

                // 基本驗證
                if (!formData.siteName) {
                    alert('請填寫網站名稱！');
                    return;
                }

                if (formData.contactEmail && !formData.contactEmail.includes('@')) {
                    alert('請填寫有效的聯絡郵箱！');
                    return;
                }

                // 模擬保存過程
                const saveProgress = document.createElement('div');
                saveProgress.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: white;
                    padding: 16px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    z-index: 10000;
                `;
                saveProgress.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div class="loading" style="width: 20px; height: 20px;"></div>
                        <span>正在保存設定...</span>
                    </div>
                `;
                document.body.appendChild(saveProgress);

                setTimeout(() => {
                    websiteSettings = { ...websiteSettings, ...formData };
                    saveProgress.remove();
                    showNotification('網站設定保存成功！', 'success');

                    console.log('保存的網站設定:', websiteSettings);
                }, 1500);
            }

            function resetWebsiteSettings() {
                if (confirm('確定要重置所有網站設定為預設值嗎？')) {
                    // 重置為預設值
                    websiteSettings = {
                        siteName: '送嗨康',
                        siteDescription: '最優質的優惠券平台',
                        siteKeywords: '優惠券,折扣,促銷,購物',
                        contactEmail: 'contact@example.com',
                        socialMedia: {
                            facebook: '',
                            instagram: '',
                            twitter: '',
                            youtube: ''
                        },
                        seo: {
                            googleAnalytics: '',
                            facebookPixel: '',
                            metaTitle: '送嗨康 - 最優質的優惠券平台',
                            metaDescription: '發現最新、最優質的優惠券，讓您的購物更划算！'
                        }
                    };

                    loadWebsiteSettings();
                    showNotification('網站設定已重置為預設值', 'success');
                }
            }

            // 自定義CSS
            function saveCustomCSS() {
                const customCSS = document.getElementById('customCSS')?.value || '';

                if (customCSS.length > 10000) {
                    alert('自定義CSS長度不能超過10,000字符！');
                    return;
                }

                // 模擬保存
                showNotification('自定義CSS保存成功！', 'success');
                console.log('保存的自定義CSS:', customCSS);
            }

            function resetCustomCSS() {
                if (confirm('確定要清空所有自定義CSS嗎？')) {
                    const cssTextarea = document.getElementById('customCSS');
                    if (cssTextarea) {
                        cssTextarea.value = '';
                        showNotification('自定義CSS已清空', 'success');
                    }
                }
            }

            function previewCustomCSS() {
                const customCSS = document.getElementById('customCSS')?.value || '';

                if (!customCSS.trim()) {
                    alert('請先輸入自定義CSS！');
                    return;
                }

                // 創建預覽窗口
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 700px;">
                        <div class="modal-header">
                            <h3 class="modal-title">CSS預覽</h3>
                            <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
                        </div>
                        <div style="padding: 20px;">
                            <div style="margin-bottom: 16px;">
                                <strong>⚠️ 注意：</strong>這只是語法預覽，實際效果需要套用後才能看到。
                            </div>
                            <div style="background: #f8f9fa; border-radius: 8px; padding: 16px; font-family: monospace; font-size: 12px; max-height: 400px; overflow-y: auto; border: 1px solid #e9ecef;">
                                ${customCSS.replace(/\n/g, '<br>').replace(/\s/g, '&nbsp;')}
                            </div>
                            <div style="margin-top: 16px; font-size: 12px; color: #6b7280;">
                                字符數：${customCSS.length} / 10,000
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn secondary" onclick="this.closest('.modal').remove()">關閉</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            // 批量操作增強功能
            function enableBulkOperations() {
                // 為用戶管理表格添加批量選擇功能
                const userTable = document.querySelector('#users-section .table');
                if (userTable && !userTable.querySelector('.bulk-checkbox')) {
                    addBulkCheckboxes('users');
                }

                // 為優惠券管理表格添加批量選擇功能
                const couponTable = document.querySelector('#coupons-section .table');
                if (couponTable && !couponTable.querySelector('.bulk-checkbox')) {
                    addBulkCheckboxes('coupons');
                }
            }

            function addBulkCheckboxes(type) {
                const table = document.querySelector(`#${type}-section .table`);
                if (!table) return;

                // 添加表頭的全選框
                const thead = table.querySelector('thead tr');
                if (thead && !thead.querySelector('.bulk-checkbox')) {
                    const th = document.createElement('th');
                    th.innerHTML = '<input type="checkbox" class="bulk-checkbox bulk-select-all" onchange="toggleSelectAll(this, \'' + type + '\')">';
                    thead.insertBefore(th, thead.firstChild);
                }

                // 為每一行添加選擇框
                const tbody = table.querySelector('tbody');
                const rows = tbody.querySelectorAll('tr');
                rows.forEach((row, index) => {
                    if (!row.querySelector('.bulk-checkbox')) {
                        const td = document.createElement('td');
                        td.innerHTML = `<input type="checkbox" class="bulk-checkbox bulk-item" data-type="${type}" data-id="${index}">`;
                        row.insertBefore(td, row.firstChild);
                    }
                });

                // 添加批量操作按鈕
                addBulkActionButtons(type);
            }

            function addBulkActionButtons(type) {
                const section = document.getElementById(`${type}-section`);
                const cardHeader = section.querySelector('.card-header');

                if (cardHeader && !cardHeader.querySelector('.bulk-actions')) {
                    const bulkActions = document.createElement('div');
                    bulkActions.className = 'bulk-actions';
                    bulkActions.style.display = 'none';
                    bulkActions.innerHTML = `
                        <span class="selected-count">已選擇 0 項</span>
                        <button class="btn secondary" onclick="bulkApprove('${type}')">批量核准</button>
                        <button class="btn secondary" onclick="bulkReject('${type}')">批量拒絕</button>
                        <button class="btn secondary" onclick="bulkExport('${type}')">批量匯出</button>
                        <button class="btn danger" onclick="bulkDelete('${type}')">批量刪除</button>
                    `;
                    cardHeader.appendChild(bulkActions);
                }
            }

            function toggleSelectAll(checkbox, type) {
                const checkboxes = document.querySelectorAll(`input[data-type="${type}"]`);
                checkboxes.forEach(cb => cb.checked = checkbox.checked);
                updateBulkActionButtons(type);
            }

            function updateBulkActionButtons(type) {
                const selectedItems = document.querySelectorAll(`input[data-type="${type}"]:checked`);
                const bulkActions = document.querySelector(`#${type}-section .bulk-actions`);
                const selectedCount = bulkActions.querySelector('.selected-count');

                if (selectedItems.length > 0) {
                    bulkActions.style.display = 'flex';
                    selectedCount.textContent = `已選擇 ${selectedItems.length} 項`;
                } else {
                    bulkActions.style.display = 'none';
                }
            }

            function bulkApprove(type) {
                const selectedItems = document.querySelectorAll(`input[data-type="${type}"]:checked`);
                if (selectedItems.length === 0) {
                    alert('請先選擇要核准的項目');
                    return;
                }
                if (confirm(`確定要批量核准 ${selectedItems.length} 個項目嗎？`)) {
                    alert(`批量核准${type}功能開發中...`);
                }
            }

            function bulkReject(type) {
                const selectedItems = document.querySelectorAll(`input[data-type="${type}"]:checked`);
                if (selectedItems.length === 0) {
                    alert('請先選擇要拒絕的項目');
                    return;
                }
                if (confirm(`確定要批量拒絕 ${selectedItems.length} 個項目嗎？`)) {
                    alert(`批量拒絕${type}功能開發中...`);
                }
            }

            function bulkExport(type) {
                const selectedItems = document.querySelectorAll(`input[data-type="${type}"]:checked`);
                if (selectedItems.length === 0) {
                    alert('請先選擇要匯出的項目');
                    return;
                }
                alert(`批量匯出${selectedItems.length}個${type}功能開發中...`);
            }

            function bulkDelete(type) {
                const selectedItems = document.querySelectorAll(`input[data-type="${type}"]:checked`);
                if (selectedItems.length === 0) {
                    alert('請先選擇要刪除的項目');
                    return;
                }
                if (confirm(`⚠️ 警告：確定要批量刪除 ${selectedItems.length} 個項目嗎？此操作無法復原！`)) {
                    alert(`批量刪除${type}功能開發中...`);
                }
            }

            // 進階報表分析功能
            function generateAdvancedReports() {
                console.log('生成進階報表');

                // 模擬生成營收分析報表
                const revenueData = {
                    thisMonth: 125000,
                    lastMonth: 98000,
                    growth: 27.6,
                    topCategories: [
                        { name: '美食餐飲', revenue: 45000, percentage: 36 },
                        { name: '購物消費', revenue: 32000, percentage: 25.6 },
                        { name: '休閒娛樂', revenue: 28000, percentage: 22.4 },
                        { name: '交通運輸', revenue: 20000, percentage: 16 }
                    ]
                };

                // 模擬用戶行為分析
                const userBehaviorData = {
                    avgSessionDuration: '8分32秒',
                    bounceRate: '23.5%',
                    conversionRate: '12.8%',
                    topPages: [
                        { page: '首頁', views: 15420, duration: '5分12秒' },
                        { page: '優惠券列表', views: 12800, duration: '7分45秒' },
                        { page: '個人中心', views: 8900, duration: '4分20秒' }
                    ]
                };

                console.log('營收分析:', revenueData);
                console.log('用戶行為分析:', userBehaviorData);
            }

            // ==================== 功能函數結束 ====================

            // 全局錯誤處理
            window.addEventListener('error', function (e) {
                console.error('JavaScript錯誤:', e.error);
                console.error('錯誤位置:', e.filename, '行號:', e.lineno);

                // 如果是模態窗口相關錯誤，強制修復
                if (e.error && e.error.message && e.error.message.includes('closeModal')) {
                    console.log('檢測到模態窗口錯誤，執行修復...');
                    setTimeout(() => {
                        fixLayoutIssues();
                    }, 500);
                }
            });

            // 事件監聽器
            document.addEventListener('DOMContentLoaded', async () => {
                console.log('頁面載入開始...');

                try {
                    // 強制重設頁面樣式
                    document.body.style.overflow = 'auto';
                    document.body.style.position = 'static';
                    document.body.style.height = 'auto';

                    // 確保所有模態窗口都被關閉
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.classList.remove('active');
                        modal.style.display = 'none';
                    });

                    // 確保主要佈局元素正常顯示
                    const layout = document.querySelector('.layout');
                    const mainContent = document.querySelector('.main-content');
                    const content = document.querySelector('.content');

                    if (layout) {
                        layout.style.display = 'flex';
                        layout.style.position = 'static';
                    }
                    if (mainContent) {
                        mainContent.style.display = 'block';
                        mainContent.style.position = 'static';
                    }
                    if (content) {
                        content.style.display = 'block';
                        content.style.position = 'static';
                    }

                    // 檢查認證
                    const isAuthenticated = await checkAuth();
                    if (!isAuthenticated) return;

                    // 設置導航
                    document.querySelectorAll('.nav-link').forEach(link => {
                        link.addEventListener('click', (e) => {
                            const section = link.getAttribute('data-section');
                            if (section) {
                                e.preventDefault();
                                showSection(section);
                            } else {
                                // 非內嵌分頁（例如外連管理頁），讓預設行為生效
                                // 若 target="_blank" 會自動新開分頁
                            }
                        });
                    });

                    // 設置篩選器
                    setupFilters();

                    // 載入初始數據
                    loadDashboardData();

                    // 啟用批量操作功能
                    setTimeout(() => {
                        enableBulkOperations();
                    }, 1000);

                    // 最終檢查和修復佈局
                    setTimeout(() => {
                        fixLayoutIssues();
                    }, 2000);

                    console.log('頁面載入完成');
                } catch (error) {
                    console.error('頁面載入錯誤:', error);
                    // 強制修復佈局
                    setTimeout(() => {
                        fixLayoutIssues();
                    }, 1000);
                }
            });

            // 修復佈局問題的函數
            function fixLayoutIssues() {
                console.log('執行佈局修復檢查...');

                // 強制關閉所有模態窗口
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('active');
                    modal.style.display = 'none';
                });

                // 重設body樣式
                document.body.style.overflow = 'auto';
                document.body.style.position = 'static';
                document.body.style.height = 'auto';

                // 確保主要佈局正常
                const layout = document.querySelector('.layout');
                const mainContent = document.querySelector('.main-content');

                if (layout) {
                    layout.style.display = 'flex';
                    layout.style.position = 'static';
                    layout.style.zIndex = 'auto';
                }

                if (mainContent) {
                    mainContent.style.display = 'block';
                    mainContent.style.position = 'static';
                    mainContent.style.zIndex = 'auto';
                }

                console.log('佈局修復完成');
            }

            // ---- API helpers ----
            async function apiGet(url) {
                const r = await fetch(url, { headers: getAuthHeaders() });
                try { return await r.json(); } catch { return {}; }
            }
            async function apiPut(url, body) {
                const r = await fetch(url, { method: 'PUT', headers: getAuthHeaders(), body: JSON.stringify(body || {}) });
                try { return await r.json(); } catch { return {}; }
            }

            // ---- 右側抽屜：行內快速編輯 ----
            function ensureSideDrawer() {
                if (document.getElementById('sideDrawer')) return;
                const drawer = document.createElement('div');
                drawer.id = 'sideDrawer';
                drawer.style.cssText = `position:fixed;top:0;right:0;bottom:0;width:380px;background:#fff;border-left:1px solid #e5e7eb;box-shadow:-8px 0 24px rgba(0,0,0,.08);transform:translateX(100%);transition:transform .25s ease;z-index:10000;display:flex;flex-direction:column;`;
                drawer.innerHTML = `
                    <div style="padding:14px 16px;border-bottom:1px solid #f3f4f6;display:flex;justify-content:space-between;align-items:center;">
                        <div id="drawerTitle" style="font-weight:700;">快速編輯</div>
                        <button onclick="closeDrawer()" style="background:none;border:none;font-size:20px;cursor:pointer;color:#6b7280;">×</button>
                    </div>
                    <div id="drawerBody" style="padding:14px 16px;overflow-y:auto;"></div>
                    <div style="padding:12px 16px;border-top:1px solid #f3f4f6;display:flex;gap:8px;justify-content:flex-end;">
                        <button class="btn secondary" onclick="closeDrawer()">取消</button>
                        <button class="btn primary" id="drawerSaveBtn">儲存</button>
                    </div>`;
                document.body.appendChild(drawer);
            }
            function openDrawer(title, bodyHtml, onSave) {
                ensureSideDrawer();
                document.getElementById('drawerTitle').textContent = title || '快速編輯';
                document.getElementById('drawerBody').innerHTML = bodyHtml || '';
                const btn = document.getElementById('drawerSaveBtn');
                btn.onclick = onSave || null;
                document.getElementById('sideDrawer').style.transform = 'translateX(0)';
            }
            function closeDrawer() { const d = document.getElementById('sideDrawer'); if (d) d.style.transform = 'translateX(100%)'; }

            async function openTagDrawer(couponId) {
                const tags = await apiGet('../api/tags?active=1');
                const all = Array.isArray(tags?.data) ? tags.data : (tags?.data?.items || []);
                const current = await apiGet(`../api/coupons/${couponId}/tags`);
                const selected = new Set(((current?.data) || []).map(x => (x.slug || '').toLowerCase()));
                const body = `<div style=\"margin-bottom:8px;color:#6b7280;\">優惠券 #${couponId}</div><div style=\"display:flex;flex-wrap:wrap;gap:8px;\">${all.map(t => `<label class=\\"chip\\"><input type=\\"checkbox\\" name=\\"drawer_tag\\" value=\\"${t.slug}\\" ${selected.has((t.slug || '').toLowerCase()) ? 'checked' : ''}><span>${t.icon || ''}</span>${t.name}</label>`).join('')}</div>`;
                openDrawer('設定標籤', body, async () => {
                    const tag_slugs = Array.from(document.querySelectorAll('input[name="drawer_tag"]:checked')).map(cb => cb.value);
                    const res = await apiPut(`../api/coupons/${couponId}/tags`, { tag_slugs });
                    closeDrawer();
                    showSuccessMessage(res?.message || '標籤已保存');
                });
            }
            async function openRegionDrawer(couponId) {
                const regions = await apiGet('../api/regions?active=1');
                const all = (Array.isArray(regions?.data) ? regions.data : (regions?.data?.items || [])).filter(r => (r.level || 1) === 1);
                const current = await apiGet(`../api/coupons/${couponId}/regions`);
                const selected = new Set(((current?.data) || []).map(x => (x.slug || '').toLowerCase()));
                const body = `<div style=\"margin-bottom:8px;color:#6b7280;\">優惠券 #${couponId}</div><div style=\"display:flex;flex-wrap:wrap;gap:8px;\">${all.map(r => `<label class=\\"chip\\"><input type=\\"checkbox\\" name=\\"drawer_region\\" value=\\"${r.slug}\\" ${selected.has((r.slug || '').toLowerCase()) ? 'checked' : ''}><span>📍</span>${r.name}</label>`).join('')}</div>`;
                openDrawer('設定地區', body, async () => {
                    const region_slugs = Array.from(document.querySelectorAll('input[name="drawer_region"]:checked')).map(cb => cb.value);
                    const res = await apiPut(`../api/coupons/${couponId}/regions`, { region_slugs });
                    closeDrawer();
                    showSuccessMessage(res?.message || '地區已保存');
                });
            }
            // === 覆寫：抽屜改用 checkbox DOM 方式繪製 ===
            function renderChips(container, items, selectedSet, name, prefixIcon) {
                container.innerHTML = '';
                items.forEach(function (it) {
                    var lab = document.createElement('label');
                    lab.className = 'chip';
                    lab.style.cssText = 'border:1px solid #d1d5db;padding:6px 10px;border-radius:14px;display:inline-flex;align-items:center;gap:6px;';
                    var cb = document.createElement('input');
                    cb.type = 'checkbox';
                    cb.name = name;
                    cb.value = it.slug;
                    cb.checked = selectedSet.has((it.slug || '').toLowerCase());
                    lab.appendChild(cb);
                    var span = document.createElement('span');
                    span.textContent = (prefixIcon ? (prefixIcon + ' ') : '') + (it.icon ? (it.icon + ' ') : '') + (it.name || '');
                    lab.appendChild(span);
                    container.appendChild(lab);
                });
            }

            async function openTagDrawer(couponId) {
                try {
                    ensureSideDrawer();
                    document.getElementById('drawerTitle').textContent = '設定標籤';
                    var bodyEl = document.getElementById('drawerBody');
                    bodyEl.innerHTML = '';
                    var header = document.createElement('div');
                    header.style.cssText = 'margin-bottom:8px;color:#6b7280;';
                    header.textContent = '優惠券 #' + couponId;
                    bodyEl.appendChild(header);
                    var chips = document.createElement('div');
                    chips.style.cssText = 'display:flex;flex-wrap:wrap;gap:8px;';
                    bodyEl.appendChild(chips);

                    var tags = await apiGet('../api/tags?active=1');
                    var all = Array.isArray(tags && tags.data) ? tags.data : ((tags && tags.data && tags.data.items) || []);
                    var current = await apiGet('../api/coupons/' + couponId + '/tags');
                    var selected = new Set(((current && current.data) || []).map(function (x) { return (x.slug || '').toLowerCase(); }));

                    renderChips(chips, all, selected, 'drawer_tag', '');

                    var saveBtn = document.getElementById('drawerSaveBtn');
                    saveBtn.onclick = async function () {
                        var tag_slugs = Array.from(document.querySelectorAll('input[name="drawer_tag"]:checked')).map(function (cb) { return cb.value; });
                        var res = await apiPut('../api/coupons/' + couponId + '/tags', { tag_slugs: tag_slugs });
                        closeDrawer();
                        showSuccessMessage((res && res.message) || '標籤已保存');
                    };
                    document.getElementById('sideDrawer').style.transform = 'translateX(0)';
                } catch (e) {
                    console.error('openTagDrawer error:', e);
                }
            }

            async function openRegionDrawer(couponId) {
                try {
                    ensureSideDrawer();
                    document.getElementById('drawerTitle').textContent = '設定地區';
                    var bodyEl = document.getElementById('drawerBody');
                    bodyEl.innerHTML = '';
                    var header = document.createElement('div');
                    header.style.cssText = 'margin-bottom:8px;color:#6b7280;';
                    header.textContent = '優惠券 #' + couponId;
                    bodyEl.appendChild(header);
                    var chips = document.createElement('div');
                    chips.style.cssText = 'display:flex;flex-wrap:wrap;gap:8px;';
                    bodyEl.appendChild(chips);

                    var regions = await apiGet('../api/regions?active=1');
                    var all = Array.isArray(regions && regions.data) ? regions.data : ((regions && regions.data && regions.data.items) || []);
                    all = all.filter(function (r) { return (r.level || 1) === 1; });
                    var current = await apiGet('../api/coupons/' + couponId + '/regions');
                    var selected = new Set(((current && current.data) || []).map(function (x) { return (x.slug || '').toLowerCase(); }));

                    renderChips(chips, all, selected, 'drawer_region', '📍');

                    var saveBtn = document.getElementById('drawerSaveBtn');
                    saveBtn.onclick = async function () {
                        var region_slugs = Array.from(document.querySelectorAll('input[name="drawer_region"]:checked')).map(function (cb) { return cb.value; });
                        var res = await apiPut('../api/coupons/' + couponId + '/regions', { region_slugs: region_slugs });
                        closeDrawer();
                        showSuccessMessage((res && res.message) || '地區已保存');
                    };
                    document.getElementById('sideDrawer').style.transform = 'translateX(0)';
                } catch (e) {
                    console.error('openRegionDrawer error:', e);
                }
            }
        </script>

        <!-- 模態窗口 -->
        <!-- 公告管理模態窗口 -->
        <div id="announcementModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">新增公告</h3>
                    <button class="modal-close" onclick="closeModal('announcementModal')">&times;</button>
                </div>
                <form id="announcementForm">
                    <div class="form-group">
                        <label class="form-label">公告標題 *</label>
                        <input type="text" class="form-input" id="announcementTitle" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">公告類型 *</label>
                        <select class="form-select" id="announcementType" required>
                            <option value="">請選擇類型</option>
                            <option value="系統公告">系統公告</option>
                            <option value="功能更新">功能更新</option>
                            <option value="維護通知">維護通知</option>
                            <option value="活動公告">活動公告</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">公告內容 *</label>
                        <textarea class="form-textarea" id="announcementContent" required></textarea>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label class="form-label">開始時間 *</label>
                            <input type="datetime-local" class="form-input" id="announcementStartTime" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">結束時間</label>
                            <input type="datetime-local" class="form-input" id="announcementEndTime">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">狀態</label>
                        <select class="form-select" id="announcementStatus">
                            <option value="draft">草稿</option>
                            <option value="active" selected>啟用</option>
                            <option value="inactive">停用</option>
                        </select>
                    </div>
                </form>
                <div class="modal-footer">
                    <button type="button" class="btn secondary" onclick="closeModal('announcementModal')">取消</button>
                    <button type="button" class="btn primary" onclick="saveAnnouncement()">保存</button>
                </div>
            </div>
        </div>

        <!-- 輪播圖管理模態窗口 -->
        <div id="bannerModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">新增輪播圖</h3>
                    <button class="modal-close" onclick="closeModal('bannerModal')">&times;</button>
                </div>
                <form id="bannerForm">
                    <div class="form-group">
                        <label class="form-label">圖片標題 *</label>
                        <input type="text" class="form-input" id="bannerTitle" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">圖片描述</label>
                        <input type="text" class="form-input" id="bannerDescription">
                    </div>
                    <div class="form-group">
                        <label class="form-label">圖片檔案 *</label>
                        <input type="file" class="form-input" id="bannerImage" accept="image/*" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">連結網址</label>
                        <input type="url" class="form-input" id="bannerLink" placeholder="https://">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label class="form-label">排序順序</label>
                            <input type="number" class="form-input" id="bannerOrder" value="1" min="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">狀態</label>
                            <select class="form-select" id="bannerStatus">
                                <option value="active" selected>啟用</option>
                                <option value="inactive">停用</option>
                            </select>
                        </div>
                    </div>
                </form>
                <div class="modal-footer">
                    <button type="button" class="btn secondary" onclick="closeModal('bannerModal')">取消</button>
                    <button type="button" class="btn primary" onclick="saveBanner()">保存</button>
                </div>
            </div>
        </div>

        <!-- FAQ管理模態窗口 -->
        <div id="faqModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">新增常見問題</h3>
                    <button class="modal-close" onclick="closeModal('faqModal')">&times;</button>
                </div>
                <form id="faqForm">
                    <div class="form-group">
                        <label class="form-label">問題分類</label>
                        <select class="form-select" id="faqCategory">
                            <option value="general">一般問題</option>
                            <option value="account">帳戶相關</option>
                            <option value="coupon">優惠券使用</option>
                            <option value="payment">付款問題</option>
                            <option value="technical">技術支援</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">問題內容 *</label>
                        <textarea class="form-textarea" id="faqQuestion" required placeholder="請輸入常見問題..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">回答內容 *</label>
                        <textarea class="form-textarea" id="faqAnswer" required placeholder="請輸入問題回答..."
                            style="min-height: 120px;"></textarea>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label class="form-label">排序順序</label>
                            <input type="number" class="form-input" id="faqOrder" value="1" min="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">狀態</label>
                            <select class="form-select" id="faqStatus">
                                <option value="active" selected>啟用</option>
                                <option value="inactive">停用</option>
                            </select>
                        </div>
                    </div>
                </form>
                <div class="modal-footer">
                    <button type="button" class="btn secondary" onclick="closeModal('faqModal')">取消</button>
                    <button type="button" class="btn primary" onclick="saveFAQ()">保存</button>
                </div>
            </div>
        </div>

</body>

</html>